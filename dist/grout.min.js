function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _get=function(e,t,n){for(var r=!0;r;){var o=e,i=t,c=n;r=!1,null===o&&(o=Function.prototype);var a=Object.getOwnPropertyDescriptor(o,i);if(void 0!==a){if("value"in a)return a.value;var s=a.get;if(void 0===s)return;return s.call(c)}var u=Object.getPrototypeOf(o);if(null===u)return;e=u,t=i,n=c,r=!0,a=u=void 0}},_createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("kyper-matter"),require("lodash"),require("firepad"),require("firebase"),require("aws-sdk")):"function"==typeof define&&define.amd?define(["kyper-matter","lodash","firepad","firebase","aws-sdk"],t):e.Grout=t(e.Matter,e._,e.Firepad,e.Firebase,e.AWS)}(this,function(e,t,n,r,o){"use strict";function i(){o.config.update({credentials:new o.CognitoIdentityCredentials({IdentityPoolId:p.aws.cognito.poolId}),region:p.aws.region})}function c(){o.config.update({credentials:new o.CognitoIdentityCredentials({IdentityPoolId:p.aws.cognito.poolId}),region:p.aws.region})}function a(e){var t=e.map(function(e){return s(e)});return u(t)}function s(e){var n;t.has(e,"path")?n=e.path.split("/"):(n=e.Key.split("/"),e=t.pick(e,"Key"),e.path=e.Key,e.name=e.Key);var r=e;if(1==n.length)return r.name=n[0],t.has(r,"type")||(r.type="file"),r.path=n[0],r;var o={};return t.each(n,function(i,c,a){c!=a.length-1?(r.name=i,r.path=t.take(a,c+1).join("/"),r.type="folder",r.children=[{}],0==c&&(o=r),r=r.children[0]):(r.type="file",r.name=i,r.path=n.join("/"),e.$id&&(r.$id=e.$id))}),o}function u(e){var n=[],r=[];return t.each(e,function(o){if(-1==n.indexOf(o.name))n.push(o.name),r.push(o);else{var i=t.findWhere(e,{name:o.name});i.children=t.union(o.children,i.children),i.children=u(i.children)}}),r}e="default"in e?e["default"]:e,t="default"in t?t["default"]:t,n="default"in n?n["default"]:n,r="default"in r?r["default"]:r,o="default"in o?o["default"]:o;var p={serverUrl:"http://tessellate.elasticbeanstalk.com",tokenName:"grout",fbUrl:"https://kyper-tech.firebaseio.com/tessellate",appName:"tessellate",matterOptions:{localServer:!1},aws:{region:"us-east-1",cognito:{poolId:"us-east-1:72a20ffd-c638-48b0-b234-3312b3e64b2e",params:{AuthRoleArn:"arn:aws:iam::823322155619:role/Cognito_TessellateUnauth_Role",UnauthRoleArn:"arn:aws:iam::823322155619:role/Cognito_TessellateAuth_Role"}}}},l=new e(p.appName,p.matterOptions),d=l.utils.request,f=l.utils.logger,g=function(){function e(n){if(_classCallCheck(this,e),n&&t.isObject(n)&&(t.has(n,"directoryName")||t.has(n,"name")))this.name=n.directoryName||n.name,t.has(n,"appName")&&(this.appName=n.appName);else{if(!n||!t.isString(n))throw f.error({description:"Action data object with name is required to start a Directory Action.",func:"constructor",obj:"Directory"}),new Error("Directory Data object with name is required to start a Directory action.");this.name=n}}return _createClass(e,[{key:"get",value:function(){return d.get(this.directoryEndpoint).then(function(e){return f.info({description:"Directory data loaded successfully.",response:e,func:"get",obj:"Directory"}),e})["catch"](function(e){return f.info({description:"Error getting directory.",error:e,func:"get",obj:"Directory"}),Promise.reject(e)})}},{key:"update",value:function(e){return f.debug({description:"Directory updated called.",directoryData:e,func:"update",obj:"Directory"}),l.utils.request.put(this.directoryEndpoint,e).then(function(t){return f.info({description:"Directory updated successfully.",directoryData:e,response:t,func:"update",obj:"Directory"}),t})["catch"](function(t){return f.error({description:"Error updating directory.",directoryData:e,error:t,func:"update",obj:"Directory"}),Promise.reject(t)})}},{key:"del",value:function(e){return f.debug({description:"Delete directory called.",directoryData:e,func:"del",obj:"Directory"}),d["delete"](this.directoryEndpoint,e).then(function(t){return f.info({description:"Directory deleted successfully.",directoryData:e,func:"del",obj:"Directory"}),t})["catch"](function(e){return f.error({description:"Error deleting directory.",error:e,func:"del",obj:"Directory"}),Promise.reject(e)})}},{key:"directoryEndpoint",get:function(){var e=[l.endpoint,"directories",this.name];t.has(this,"app")&&t.has(this.app,"name")&&e.splice(1,0,"apps",this.app.name);var n=e.join("/");return f.log({description:"Directory endpoint built.",endpoint:n,func:"directoryEndpoint",obj:"Directory"}),n}}]),e}(),h=l.utils.request,b=l.utils.logger,j=function(){function e(n){_classCallCheck(this,e),n&&t.isObject(n)&&t.has(n,"app")?(this.app=n.app,b.log({description:"Provided app data set to app parameter.",action:this,providedData:n,func:"constructor",obj:"DirectoriesAction"})):n&&t.isString(n)&&(this.app={name:n},b.log({description:"App name provided as string was set.",action:this,providedData:n,func:"constructor",obj:"DirectoriesAction"})),b.info({description:"New directories action.",action:this,providedData:n,func:"constructor",obj:"DirectoriesAction"})}return _createClass(e,[{key:"get",value:function(){return b.debug({description:"Directories get called.",action:this,func:"get",obj:"DirectoriesAction"}),h.get(this.directoriesEndpoint).then(function(e){return b.info({descrption:"Directories loaded successfully.",response:e,func:"get",obj:"DirectoriesAction"}),e})["catch"](function(e){return b.error({descrption:"error getting users",error:e,func:"get",obj:"DirectoriesAction"}),Promise.reject(e)})}},{key:"add",value:function(e){return b.debug({description:"Add directory called.",action:this,appData:e,func:"get",obj:"DirectoriesAction"}),h.post(this.directoriesEndpoint,e).then(function(e){return b.log({description:"Application added successfully.",response:e,func:"add",obj:"DirectoriesAction"}),e})["catch"](function(e){return b.error({description:"Error adding group.",error:e,func:"add",obj:"DirectoriesAction"}),Promise.reject(e)})}},{key:"search",value:function(e){var n=this.directoriesEndpoint+"/search/";return e&&t.isString(e)&&(n+=e),e&&""!=e?h.get(n).then(function(e){return b.log({description:"Found directories based on search.",response:e,func:"search",obj:"DirectoriesAction"}),e})["catch"](function(e){return b.error({description:"Error searching directories.",error:e,func:"search",obj:"DirectoriesAction"}),Promise.reject(e)}):(b.debug({description:"Null query, returning empty array.",func:"search",obj:"DirectoriesAction"}),Promise.resolve([]))}},{key:"directoriesEndpoint",get:function(){var e=[l.endpoint,"directories"];t.has(this,"app")&&t.has(this.app,"name")&&e.splice(1,0,"apps",this.app.name);var n=e.join("/");return b.log({description:"Directories endpoint built.",endpoint:n,func:"directoriesEndpoint",obj:"DirectoriesAction"}),n}}]),e}(),y=l.utils.request,m=l.utils.logger,A=function(){function e(n){if(_classCallCheck(this,e),n&&t.isObject(n)&&t.has(n,"groupData"))this.name=t.isObject(n.groupData)?n.groupData.name:n.groupData,t.has(n,"app")&&(this.app=n.app);else{if(!n||!t.isString(n))throw m.error({description:"Action data is required to start a Group Action.",func:"constructor",obj:"Group"}),new Error("Username is required to start an Group");this.name=n}}return _createClass(e,[{key:"get",value:function(){return y.get(this.groupEndpoint).then(function(e){return m.info({description:"Group data loaded successfully.",response:e,func:"get",obj:"Group"}),e})["catch"](function(e){return m.info({description:"Error getting group.",error:e,func:"get",obj:"Group"}),Promise.reject(e.response.text||e.response)})}},{key:"update",value:function(e){return m.log({description:"Group updated called.",groupData:e,func:"update",obj:"Group"}),l.utils.request.put(this.groupEndpoint,e).then(function(t){return m.info({description:"Group updated successfully.",groupData:e,response:t,func:"update",obj:"Group"}),t})["catch"](function(t){return m.error({description:"Error updating group.",groupData:e,error:t,func:"update",obj:"Group"}),Promise.reject(t.response.text||t.response)})}},{key:"del",value:function(e){return m.log({description:"Delete group called.",groupData:e,func:"del",obj:"Group"}),y.del(this.groupEndpoint,{}).then(function(t){return m.info({description:"Group deleted successfully.",groupData:e,func:"del",obj:"Group"}),t})["catch"](function(t){return m.error({description:"Error deleting group.",error:t,text:t.response.text,groupData:e,func:"del",obj:"Group"}),Promise.reject(t.response.text||t.response)})}},{key:"addAccounts",value:function(e){m.log({description:"Group updated called.",accountsData:e,func:"update",obj:"Group"});var n=e;return t.isString(e)&&(n=e.split(",")),t.isString(n[0])?(m.error({description:"Accounts array only currently supports account._id not account.username.",accountsData:e,func:"update",obj:"Group"}),Promise.reject({message:"Accounts array only currently supports account._id not account.username."})):(m.log({description:"Updating group with accounts array.",accountsArray:n,func:"update",obj:"Group"}),this.update({accounts:n}).then(function(e){return m.info({description:"Account(s) added to group successfully.",response:e,func:"addAccounts",obj:"Group"}),e})["catch"](function(e){return m.error({description:"Error addAccountseting group.",error:e,func:"addAccounts",obj:"Group"}),Promise.reject(e.response.text||e.response)}))}},{key:"groupEndpoint",get:function(){var e=[l.endpoint,"groups",this.name];t.has(this,"app")&&t.has(this.app,"name")&&e.splice(1,0,"apps",this.app.name);var n=e.join("/");return m.log({description:"Group Endpoint built.",endpoint:n,func:"groupEndpoint",obj:"Group"}),n}}]),e}(),v=l.utils.request,k=l.utils.logger,D=function(){function e(n){_classCallCheck(this,e),n&&t.isObject(n)&&t.has(n,"app")?(this.app=n.app,k.log({description:"Provided app data set to app parameter.",action:this,providedData:n,func:"constructor",obj:"GroupsAction"})):n&&t.isString(n)&&(this.app={name:n},k.log({description:"App name provided as string was set.",action:this,providedData:n,func:"constructor",obj:"GroupsAction"})),k.info({description:"New Groups action.",action:this,providedData:n,func:"constructor",obj:"GroupsAction"})}return _createClass(e,[{key:"get",value:function(){return k.log({description:"Get group called.",func:"get",obj:"GroupsAction"}),v.get(this.groupsEndpoint).then(function(e){return k.info({description:"Groups loaded successfully.",response:e,func:"get",obj:"GroupsAction"}),e})["catch"](function(e){return k.info({description:"Error getting groups.",error:e,func:"get",obj:"GroupsAction"}),Promise.reject(e)})}},{key:"add",value:function(e){var n=e;return k.debug({description:"Add group called.",groupData:e,func:"add",obj:"GroupsAction"}),t.isString(e)&&(n={name:e}),k.debug({description:"Add group called.",newGroupData:n,func:"add",obj:"GroupsAction"}),v.post(this.groupsEndpoint,n).then(function(e){return k.log({description:"Group added to application successfully.",response:e,func:"add",obj:"GroupsAction"}),e})["catch"](function(e){return k.error({description:"Error adding group.",error:e,func:"add",obj:"GroupsAction"}),Promise.reject(e)})}},{key:"search",value:function(e){if(k.debug({description:"Search groups called.",query:e,func:"search",obj:"GroupsAction"}),!e||""==e||!t.isString(e))return k.log({description:"Null or invalid query, returning empty array.",func:"search",obj:"GroupsAction"}),Promise.resolve([]);var n=this.groupsEndpoint+"/search/"+e;return k.debug({description:"Search endpoint created.",endpoint:n,func:"search",obj:"GroupsAction"}),v.get(n).then(function(e){return k.log({description:"Found groups based on search.",response:e,func:"search",obj:"GroupsAction"}),e})["catch"](function(e){return k.error({description:"Error searching groups.",error:e,func:"search",obj:"GroupsAction"}),Promise.reject(e)})}},{key:"groupsEndpoint",get:function(){var e=[l.endpoint,"groups"];t.has(this,"app")&&t.has(this.app,"name")&&e.splice(1,0,"apps",this.app.name);var n=e.join("/");return k.log({description:"Groups Endpoint built.",endpoint:n,func:"groupsEndpoint",obj:"GroupsAction"}),n}}]),e}(),w=l.utils.request,E=l.utils.logger,F=function(){function e(n){if(_classCallCheck(this,e),n&&t.isObject(n)&&t.has(n,"username"))t.extend(this,n);else{if(!n||!t.isString(n))throw E.error({description:"AccountData is required to start an AccountAction",func:"constructor",obj:"Account"}),new Error("username is required to start an AccountAction");this.username=n}}return _createClass(e,[{key:"get",value:function(){return E.debug({description:"Account data loaded successfully.",func:"get",obj:"Account"}),w.get(this.accountEndpoint).then(function(t){return E.info({description:"Account data loaded successfully.",response:t,func:"get",obj:"Account"}),new e(t)})["catch"](function(e){return E.error({description:"Error getting user.",error:e,func:"get",obj:"Account"}),Promise.reject(e)})}},{key:"update",value:function(t){return E.debug({description:"Update user called.",accountData:t,func:"update",obj:"Account"}),w.put(this.accountEndpoint,t).then(function(t){return E.info({description:"Account updated successfully.",func:"update",obj:"Account"}),new e(t)})["catch"](function(e){return E.error({description:"Error updating user.",func:"update",obj:"Account"}),Promise.reject(e)})}},{key:"del",value:function(t){return E.debug({description:"Delete user called.",func:"del",obj:"Account"}),w.del(this.accountEndpoint,t).then(function(t){return E.info({description:"Delete user successful.",response:t,func:"del",obj:"Account"}),new e(t)})["catch"](function(e){return E.error({description:"Error deleting user.",accountData:t,error:e,func:"del",obj:"Account"}),Promise.reject(e)})}},{key:"accountEndpoint",get:function(){var e=[l.endpoint,"accounts",this.username];t.has(this,"app")&&t.has(this.app,"name")&&e.splice(1,0,"apps",this.app.name);var n=e.join("/");return E.log({description:"Account Endpoint built.",endpoint:n,func:"accountEndpoint",obj:"Account"}),n}}]),e}(),G=l.utils.logger,P=function(){function e(n){_classCallCheck(this,e),n&&t.isObject(n)&&t.has(n,"app")?(this.app=n.app,G.log({description:"Provided app data set to app parameter.",action:this,providedData:n,func:"constructor",obj:"AccountsAction"})):n&&t.isString(n)&&(this.app={name:n},G.log({description:"App name provided as string was set.",action:this,providedData:n,func:"constructor",obj:"AccountsAction"})),G.info({description:"New Accounts action.",action:this,providedData:n,func:"constructor",obj:"AccountsAction"})}return _createClass(e,[{key:"get",value:function(){return G.log({description:"Accounts get called.",func:"get",obj:"AccountsAction"}),l.utils.request.get(this.accountsEndpoint).then(function(e){return G.info({description:"Accounts loaded successfully.",func:"get",obj:"AccountsAction"}),e})["catch"](function(e){return G.info({description:"Error getting accounts.",error:e,func:"get",obj:"AccountsAction"}),Promise.reject(e.message||"Error getting accounts.")})}},{key:"add",value:function(e){return G.info({description:"Account add called.",accountData:e,func:"add",obj:"AccountsAction"}),this.utils.request.post(this.accountsEndpoint,e).then(function(e){return G.info({description:"Account added successfully.",response:e,newAccount:new F(e),func:"add",obj:"AccountsAction"}),new F(e)})["catch"](function(t){return G.error({description:"Account add called.",error:t,accountData:e,func:"add",obj:"AccountsAction"}),Promise.reject(t.message||"Error adding account.")})}},{key:"search",value:function(e){G.log({description:"Accounts search called.",query:e,func:"search",obj:"AccountsAction"});var n=this.accountsEndpoint+"/search/";return e&&t.isString(e)&&(n+=e),e&&""!=e?l.utils.request.get(n).then(function(t){return G.log({description:"Accounts search responded.",response:t,query:e,func:"search",obj:"AccountsAction"}),t})["catch"](function(t){return G.error({description:"Error searching Accounts.",error:t,query:e,func:"search",obj:"AccountsAction"}),Promise.reject(t.message||"Error searching accounts.")}):(G.log({description:"Null query, returning empty array.",func:"search",obj:"AccountsAction"}),Promise.resolve([]))}},{key:"accountsEndpoint",get:function(){var e=[l.endpoint,"accounts"];t.has(this,"app")&&t.has(this.app,"name")&&e.splice(1,0,"apps",this.app.name);var n=e.join("/");return G.log({description:"Accounts Endpoint built.",endpoint:n,func:"accountsEndpoint",obj:"AccountsAction"}),n}}]),e}(),C=l.utils.request,T=l.utils.logger,S=function(){function e(n){if(_classCallCheck(this,e),!n||!t.isString(n))throw T.error({description:"Template data is required to start a Template action.",func:"constructor",obj:"Template"}),new Error("Template data is required to start a Template action.");this.name=n}return _createClass(e,[{key:"get",value:function(){return T.log({description:"Get template called.",name:this.name,func:"get",obj:"Template"}),C.get(this.templateEndpoint).then(function(e){return T.log({description:"Get template responded.",response:e,func:"get",obj:"Template"}),e})["catch"](function(e){return T.error({description:"Error getting template.",error:e,func:"get",obj:"Template"}),Promise.reject(e)})}},{key:"update",value:function(e){return T.log({description:"Update template called.",templateData:e,func:"update",obj:"Template"}),C.put(this.templateEndpoint,e).then(function(t){return T.log({description:"Update template responded.",response:t,templateData:e,func:"update",obj:"Template"}),t})["catch"](function(e){return T.error({description:"Error updating template.",error:e,func:"update",obj:"Template"}),Promise.reject(e)})}},{key:"del",value:function(e){return T.log({description:"Delete template called.",templateData:e,func:"del",obj:"Template"}),C["delete"](this.endpoint,e).then(function(e){return T.log({description:"Template deleted successfully.",response:e,func:"del",obj:"Template"}),e})["catch"](function(e){return T.error({description:"Error deleting template.",error:e,func:"del",obj:"Template"}),Promise.reject(e)})}},{key:"templateEndpoint",get:function(){return l.endpoint+"/templates/"+this.name}}]),e}(),q=l.utils.logger,_=l.utils.request,O=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"get",value:function(){return q.log({description:"Get template called.",func:"get",obj:"TemplatesAction"}),_.get(this.templatesEndpoint).then(function(e){return q.log({description:"Templates loaded.",response:e,func:"get",obj:"TemplatesAction"}),e})["catch"](function(e){return q.error({description:"Error getting templates.",error:e,func:"get",obj:"TemplatesAction"}),Promise.reject(e)})}},{key:"add",value:function(e){return q.log({description:"Add template called.",func:"add",obj:"TemplatesAction"}),_.post(this.templatesEndpoint,e).then(function(e){return q.log({description:"Templates added successfully.",func:"add",obj:"TemplatesAction"}),e})["catch"](function(e){return q.error({description:"Error adding template.",error:e,func:"add",obj:"TemplatesAction"}),Promise.reject(e)})}},{key:"search",value:function(e){q.log({description:"Search template called.",query:e,func:"search",obj:"TemplatesAction"});var n=this.templatesEndpoint+"/search/";return e&&t.isString(e)&&(n+=e),q.log({description:"Search endpoint created.",endpoint:n,func:"search",obj:"TemplatesAction"}),_.get(n).then(function(e){return q.log({description:"Template(s) found successfully.",response:e,endpoint:n,func:"search",obj:"TemplatesAction"}),e})["catch"](function(t){return q.log({description:"Error searching for templates.",query:e,error:t,endpoint:n,func:"search",obj:"TemplatesAction"}),Promise.reject(t)})}},{key:"templatesEndpoint",get:function(){var e=[l.endpoint,"templates"];t.has(this,"app")&&t.has(this.app,"name")&&q.log({description:"Templates action is not currently supported for a specific application.",func:"accountsEndpoint",obj:"AccountsAction"});var n=e.join("/");return q.log({description:"Templates endpoint built.",endpoint:n,func:"templatesEndpoint",obj:"TemplatesAction"}),n}}]),e}(),x=l.utils.logger,U=function(){function e(n){if(_classCallCheck(this,e),!(n&&t.isObject(n)&&t.has(n,"fileData")&&t.has(n,"app")))throw n&&!t.isObject(n)?(x.error({description:"File data is not an object. File data must be an object that includes path and appName.",func:"constructor",obj:"File"}),new Error("File data must be an object that includes path and appName.")):(x.error({description:"File data that includes path and app is needed to create a File action.",func:"constructor",obj:"File"}),new Error("File data with path and app is needed to create file action."));t.extend(this,n.fileData),this.app=n.app,this.pathArray=this.path.split("/"),this.name=t.has(n.fileData,"name")?n.fileData.name:this.pathArray[this.pathArray.length-1],this.type="file",x.debug({description:"File object constructed.",file:this,func:"constructor",obj:"File"})}return _createClass(e,[{key:"get",value:function(){var e=this;if(!this.app||!this.app.frontend)return x.log({description:"Application Frontend data not available. Calling applicaiton get.",func:"get",obj:"File"}),this.app.get().then(function(t){return e.app=t,x.log({description:"Application get successful. Getting file.",app:t,func:"get",obj:"File"}),e.get()},function(e){return x.error({description:"Application Frontend data not available.",error:e,func:"get",obj:"File"}),Promise.reject({message:"Front end data is required to get file."})});var n=function(){"undefined"!=typeof o.config.credentials&&o.config.credentials||(x.log({description:"AWS creds do not exist, so they are being set.",func:"publish",obj:"File"}),i());var n=new o.S3,r={Bucket:e.app.frontend.bucketName,Key:e.path};e.contentType&&(r.ContentType=e.contentType),x.debug({description:"File get params built.",getData:r,file:e,func:"get",obj:"File"});var c=e;return{v:new Promise(function(e,o){n.getObject(r,function(n,r){return n?(x.error({description:"Error loading file from S3.",error:n,func:"get",obj:"File"}),o(n)):(x.info({description:"File loaded successfully.",data:r,func:"get",obj:"File"}),void(t.has(r,"Body")?(x.info({description:"File has content.",content:r.Body.toString(),metaData:r.Metadata.toString(),func:"get",obj:"File"}),c.content=r.Body.toString(),x.info({description:"File content has been added to file.",file:c,func:"get",obj:"File"}),e(c)):e(r)))})})}}();return"object"==typeof n?n.v:void 0}},{key:"open",value:function(){return this.get()}},{key:"publish",value:function(e){var n=this;if(x.debug({description:"File publish called.",file:this,fileData:e,func:"publish",obj:"File"}),!this.app.frontend)return x.error({description:"Application Frontend data not available. Make sure to call .get().",func:"publish",obj:"File"}),Promise.reject({message:"Front end data is required to publish file."});var r=function(){if(!t.has(e,["content","path"]))return x.error({description:"File data including path and content required to publish.",func:"publish",obj:"File"}),{v:Promise.reject({message:"File data including path and content required to publish."})};var r={Bucket:n.app.frontend.bucketName,Key:e.path,Body:e.content,ACL:"public-read"};n.contentType&&(r.ContentType=n.contentType),"undefined"!=typeof o.config.credentials&&o.config.credentials||(x.debug({description:"AWS creds do not exist, so they are being set.",func:"publish",obj:"File"}),i());var c=new o.S3;return x.debug({description:"File publish params built.",saveParams:r,fileData:n,func:"publish",obj:"File"}),{v:new Promise(function(e,t){c.putObject(r,function(n,r){n?(x.error({description:"Error saving file to S3.",error:n,func:"publish",obj:"File"}),t(n)):(x.log({description:"File saved successfully.",response:r,func:"publish",obj:"File"}),e(r))})})}}();return"object"==typeof r?r.v:void 0}},{key:"del",value:function(){var e=this;if(!this.app||!this.app.frontend)return x.log({description:"Application Frontend data not available. Calling applicaiton get.",func:"get",obj:"File"}),this.app.get().then(function(t){return e.app=t,x.log({description:"Application get successful. Getting file.",app:t,func:"get",obj:"File"}),e.get()},function(e){return x.error({description:"Application Frontend data not available. Make sure to call .get().",error:e,func:"get",obj:"File"}),Promise.reject({message:"Front end data is required to get file."})});var n=function(){"undefined"!=typeof o.config.credentials&&o.config.credentials||(x.debug({description:"AWS creds do not exist, so they are being set.",func:"publish",obj:"File"}),i());var n=new o.S3,r={Bucket:e.app.frontend.bucketName,Key:e.path};return e.contentType&&(r.ContentType=e.contentType),x.debug({description:"File get params built.",saveParams:r,file:e,func:"get",obj:"File"}),{v:new Promise(function(e,o){n.deleteObject(r,function(n,r){return n?(x.error({description:"Error loading file from S3.",error:n,func:"get",obj:"File"}),o(n)):(x.info({description:"File loaded successfully.",fileData:r,func:"get",obj:"File"}),void(t.has(r,"Body")?(x.info({description:"File has content.",fileData:r.Body.toString(),func:"get",obj:"File"}),e(r.Body.toString())):e(r)))})})}}();return"object"==typeof n?n.v:void 0}},{key:"openInFirepad",value:function(e){var t=this;return new Promise(function(n,r){t.get().then(function(t){x.log({description:"File contents loaded. Opening firepad.",editor:e,file:t,func:"openInFirepad",obj:"File"});var r=t.firepadFromAce(e);r.on("ready",function(){n(t)})},function(t){x.error({description:"Valid ace editor instance required to create firepad.",func:"openInFirepad",obj:"File",editor:e}),r(t)})})}},{key:"firepadFromAce",value:function(e){if(!e||"function"!=typeof e.setTheme)return void x.error({description:"Valid ace editor instance required to create firepad.",func:"fbRef",obj:"File",editor:e});if("function"!=typeof n.fromACE)return void x.error({description:"Firepad does not have fromACE method.",firepad:n,func:"fbRef",obj:"File"});var t={};return this.content&&(t.defaultText=this.content),l.isLoggedIn&&l.currentUser&&(t.userId=l.currentUser.username||l.currentUser.name),x.log({description:"Creating firepad from ace.",settings:t,func:"fbRef",obj:"File"}),n.fromACE(this.fbRef,e,t)}},{key:"getConnectedUsers",value:function(){var e=this;return new Promise(function(t,n){e.fbRef.child("users").on("value",function(e){null===e.val()?t([]):!function(){var n=[];e.forEach(function(e){var t=e.val();t.username=e.key(),n.push(t)}),x.log({description:"Connected users array built.",users:n,func:"connectedUsers",obj:"File"}),t(n)}()},function(e){x.error({description:"Error loading connected users.",error:e,func:"connectedUsers",obj:"File"}),n(e)})})}},{key:"getDefaultContent",value:function(){}},{key:"fileType",get:function(){return"js"==this.ext?"javascript":this.ext}},{key:"ext",get:function(){var e=/(?:\.([^.]+))?$/;return e.exec(this.name)[1]}},{key:"safePathArray",get:function(){var e=this.pathArray.map(function(e){return e.replace(/[.]/g,":").replace(/[#$\[\]]/g,"--")});return x.log({description:"Safe path array created.",safeArray:e,func:"safePathArray",obj:"File"}),e}},{key:"safePath",get:function(){return this.safePathArray.join("/")}},{key:"fbUrl",get:function(){var e=[p.fbUrl,"files",this.app.name,this.safePath].join("/");return x.log({description:"File ref url generated",url:e,func:"fbRef",obj:"File"}),e}},{key:"fbRef",get:function(){return x.log({description:"Fb ref generatating.",url:this.fbUrl,func:"fbRef",obj:"File"}),new r(this.fbUrl)}}]),e}(),N=l.utils.logger,I=function(){function e(n){if(_classCallCheck(this,e),n&&t.isObject(n)&&t.has(n,"app"))this.app=n.app;else{if(!n||!t.isString(n))throw n&&t.isArray(n)?(N.error({description:"Action data object with name is required to start a Files Action.",func:"constructor",obj:"Files"}),new Error("Files Data object with application is required to start a Files action.")):(N.error({description:"Action data object with name is required to start a Files Action.",func:"constructor",obj:"Files"}),new Error("Files Data object with name is required to start a Files action."));this.app={name:n}}N.debug({description:"Files object constructed.",func:"constructor",obj:"Files"})}return _createClass(e,[{key:"publish",value:function(){}},{key:"get",value:function(){var e=this;if(!this.app.frontend||!this.app.frontend.bucketName)return N.warn({description:"Application Frontend data not available. Calling .get().",app:this.app,func:"get",obj:"Files"}),this.app.get().then(function(n){return N.log({description:"Application get returned.",data:n,func:"get",obj:"Files"}),e.app=n,t.has(n,"frontend")?e.get():(N.error({description:"Application does not have Frontend to get files from.",func:"get",obj:"Files"}),Promise.reject({message:"Application does not have frontend to get files from."}))},function(e){return N.error({description:"Application Frontend data not available. Make sure to call .get().",error:e,func:"get",obj:"Files"}),Promise.reject({message:"Bucket name required to get objects"})});var n=function(){"undefined"!=typeof o.config.credentials&&o.config.credentials||c();var t=new o.S3,n={Bucket:e.app.frontend.bucketName};return{v:new Promise(function(e,r){t.listObjects(n,function(t,n){return t?(N.error({description:"Error getting files from S3.",error:t,func:"get",obj:"Files"}),r(t)):(N.info({description:"Files list loaded.",filesData:n,func:"get",obj:"Files"}),e(n.Contents))})})}}();return"object"==typeof n?n.v:void 0}},{key:"add",value:function(){}},{key:"del",value:function(){}},{key:"buildStructure",value:function(){return N.debug({description:"Build Structure called.",func:"buildStructure",obj:"Application"}),this.get().then(function(e){var t=a(e);return N.log({description:"Child struct from array.",childStructure:t,func:"buildStructure",obj:"Application"}),t},function(e){return N.error({description:"Error getting application files.",error:e,func:"buildStructure",obj:"Application"}),Promise.reject({message:"Error getting files.",error:e})})}}]),e}(),B=l.utils.request,R=l.utils.logger,K=function(){function e(n){_classCallCheck(this,e),n&&t.isObject(n)?t.extend(this,n):n&&t.isString(n)&&(this.name=n),r&&t.has(p,"fbUrl")&&t.has(this,"name")&&(this.fbRef=new r(p.fbUrl+this.name))}return _createClass(e,[{key:"get",value:function(){return R.debug({description:"Application get called.",func:"get",obj:"Application"}),B.get(this.appEndpoint).then(function(t){return R.info({description:"Application loaded successfully.",response:t,application:new e(t),func:"get",obj:"Application"}),new e(t)})["catch"](function(e){return R.error({description:"Error getting Application.",message:e.response.text,error:e,func:"get",obj:"Application"}),Promise.reject(e.response.text||e.response)})}},{key:"update",value:function(t){return R.debug({description:"Application update called.",func:"update",obj:"Application"}),B.put(this.appEndpoint,t).then(function(t){return R.info({description:"Application updated successfully.",response:t,func:"update",obj:"Application"}),new e(t)})["catch"](function(e){return R.error({description:"Error updating application.",error:e,func:"update",obj:"Application"}),Promise.reject(e.response.text||e.response)})}},{key:"addStorage",value:function(){return R.debug({description:"Application add storage called.",application:this,func:"addStorage",obj:"Application"}),B.post(this.appEndpoint+"/storage",{}).then(function(t){return R.info({description:"Storage successfully added to application.",response:t,application:new e(t),func:"addStorage",obj:"Application"}),new e(t)})["catch"](function(e){return R.error({description:"Error adding storage to application.",error:e,
func:"addStorage",obj:"Application"}),Promise.reject(e.response.text||e.response)})}},{key:"applyTemplate",value:function(){var t=this;return R.error({description:"Applying templates to existing applications is not currently supported.",func:"applyTemplate",obj:"Application"}),B.post(this.appEndpoint,{}).then(function(n){return R.info({description:"Template successfully applied to application.",response:n,application:t,func:"applyTemplate",obj:"Application"}),new e(n)})["catch"](function(e){return R.error({description:"Error applying template to application.",error:e,application:t,func:"applyTemplate",obj:"Application"}),Promise.reject(e.response.text||e.response)})}},{key:"File",value:function(e){return R.debug({description:"Applications file action called.",fileData:e,application:this,func:"file",obj:"Application"}),new U({app:this,fileData:e})}},{key:"User",value:function(e){return R.debug({description:"Applications user action called.",userData:e,application:this,func:"user",obj:"Application"}),new F({app:this,userData:e})}},{key:"Account",value:function(e){return R.debug({description:"Applications account action called.",userData:e,application:this,func:"user",obj:"Application"}),new F({app:this,userData:e})}},{key:"Group",value:function(e){return R.debug({description:"Applications group action called.",groupData:e,application:this,func:"group",obj:"Application"}),new A({app:this,groupData:e})}},{key:"Directory",value:function(e){return R.debug({description:"Applications directory action called.",directoryData:e,application:this,func:"directory",obj:"Application"}),new g({app:this,directoryData:e})}},{key:"appEndpoint",get:function(){return l.endpoint+"/apps/"+this.name}},{key:"Files",get:function(){return R.debug({description:"Applications files action called.",application:this,func:"files",obj:"Application"}),new I({app:this})}},{key:"Users",get:function(){return R.debug({description:"Applications users action called.",application:this,func:"user",obj:"Application"}),new P({app:this})}},{key:"Accounts",get:function(){return R.debug({description:"Applications account action called.",application:this,func:"user",obj:"Application"}),new P({app:this})}},{key:"Groups",get:function(){return R.debug({description:"Applications groups action called.",application:this,func:"groups",obj:"Application"}),new D({app:this})}},{key:"Directories",get:function(){return R.debug({description:"Applications directories action called.",application:this,func:"directories",obj:"Application"}),new j({app:this})}}]),e}(),M=l.utils.request,W=l.utils.logger,$=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"get",value:function(){return W.debug({description:"Apps get called.",action:this,func:"get",obj:"AppsAction"}),M.get(this.appsEndpoint).then(function(e){return W.info({description:"Apps data loaded successfully.",response:e,func:"get",obj:"AppsAction"}),e})["catch"](function(e){return W.error({description:"Error getting apps data.",error:e,func:"get",obj:"AppsAction"}),Promise.reject(e)})}},{key:"add",value:function(e){return W.debug({description:"Application add called.",appData:e,func:"add",obj:"AppsAction"}),l.utils.request.post(this.appsEndpoint,e).then(function(e){return W.info({description:"Application added successfully.",response:e,func:"add",obj:"AppsAction"}),e})["catch"](function(e){return W.error({description:"Error adding app.",error:e,func:"add",obj:"AppsAction"}),Promise.reject(e)})}},{key:"appsEndpoint",get:function(){return l.endpoint+"/apps"}}]),e}(),L=function(e){function t(){_classCallCheck(this,t),_get(Object.getPrototypeOf(t.prototype),"constructor",this).call(this,p.appName,p.matterOptions)}return _inherits(t,e),_createClass(t,[{key:"App",value:function(e){return this.utils.logger.debug({description:"Application action called.",appName:e,template:new K(e),func:"App",obj:"Grout"}),new K(e)}},{key:"Template",value:function(e){return this.utils.logger.debug({description:"Template Action called.",templateData:e,template:new S(e),func:"Template",obj:"Grout"}),new S(e)}},{key:"Account",value:function(e){return this.utils.logger.debug({description:"Account Action called.",userData:e,user:new F(e),func:"user",obj:"Grout"}),new F(e)}},{key:"User",value:function(e){return this.utils.logger.debug({description:"Account Action called.",userData:e,user:new F(e),func:"user",obj:"Grout"}),new F(e)}},{key:"Group",value:function(e){return this.utils.logger.debug({description:"Group Action called.",groupData:e,action:new A({app:this,groupData:e}),func:"group",obj:"Grout"}),new A(e)}},{key:"Directory",value:function(e){return this.utils.logger.debug({description:"Directory Action called.",directoryData:e,action:new g(e),func:"directory",obj:"Grout"}),new g(e)}},{key:"Apps",get:function(){return this.utils.logger.debug({description:"Apps Action called.",action:new $,func:"Apps",obj:"Grout"}),new $}},{key:"Templates",get:function(){return this.utils.logger.debug({description:"Templates Action called.",action:new O,func:"Templates",obj:"Grout"}),new O}},{key:"Accounts",get:function(){return this.utils.logger.debug({description:"Account Action called.",action:new P,func:"users",obj:"Grout"}),new P}},{key:"Users",get:function(){return this.utils.logger.debug({description:"Accounts Action called.",action:new P,func:"Users",obj:"Grout"}),new P}},{key:"Groups",get:function(){return this.utils.logger.debug({description:"Groups Action called.",action:new D,func:"groups",obj:"Grout"}),new D}},{key:"Directories",get:function(){return this.utils.logger.debug({description:"Directories Action called.",action:new j,func:"directories",obj:"Grout"}),new j}}]),t}(e);return L});
//# sourceMappingURL=grout.min.js.map
