function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _get=function(e,t,n){for(var r=!0;r;){var o=e,i=t,s=n;a=u=c=void 0,r=!1,null===o&&(o=Function.prototype);var a=Object.getOwnPropertyDescriptor(o,i);if(void 0!==a){if("value"in a)return a.value;var c=a.get;return void 0===c?void 0:c.call(s)}var u=Object.getPrototypeOf(o);if(null===u)return void 0;e=u,t=i,n=s,r=!0}},_createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("lodash"),require("jwt-decode"),require("superagent"),require("firebase")):"function"==typeof define&&define.amd?define(["lodash","jwt-decode","superagent","firebase"],t):e.Grout=t(e._,e.jwtDecode,e.superagent,e.Firebase)}(this,function(e,t,n,r){"use strict";function o(t){var n="",r={};e.isObject(t)?(e.has(t,"func")&&(n+=e.has(t,"obj")?"["+t.obj+"."+t.func+"()] ":e.has(t,"file")?"["+t.file+" > "+t.func+"()] ":"["+t.func+"()] "),e.each(e.omit(e.keys(t)),function(o,i,s){"func"!=o&&"obj"!=o&&("description"==o||"message"==o?n+=t[o]:e.isString(t[o])?r[o]=t[o]:r[o]=t[o])}),n+="\n"):e.isString(t)&&(n=t);var o=[n,r];return o}function i(e){var n=void 0;if(e&&""!=e)try{n=t(e)}catch(r){throw h.error({description:"Error decoding token.",data:n,error:r,func:"decodeToken",file:"token"}),new Error("Invalid token string.")}return n}function s(e){return new Promise(function(t,n){e.end(function(e,r){return e?(401==e.status&&h.warn("Unauthorized. You must be signed into make this request."),n(e)):t(r.body)})})}function a(e){return k.string&&(e=e.set("Authorization","Bearer "+k.string),h.info({message:"Set auth header",func:"addAuthHeader",file:"request"})),e}function c(e){return new Promise(function(t,n){e.end(function(e,r){return e?(401==e.status&&console.warn("Unauthorized. You must be signed into make this request."),n(e)):t(r.body)})})}function u(e){return j.getItem(w.tokenName)&&(e=e.set("Authorization","Bearer "+j.getItem(w.tokenName)),console.log("Set auth header")),e}function l(){AWS.config.update({credentials:new AWS.CognitoIdentityCredentials({IdentityPoolId:w.aws.cognito.poolId}),region:w.aws.region})}function p(e){var t=e.map(function(e){return f(e)});return d(t)}function f(t){var n;e.has(t,"path")?n=t.path.split("/"):(n=t.Key.split("/"),t=e.pick(t,"Key"),t.path=t.Key,t.name=t.Key);var r=t;if(1==n.length)return r.name=n[0],e.has(r,"type")||(r.type="file"),r.path=n[0],r;var o={};return e.each(n,function(i,s,a){s!=a.length-1?(r.name=i,r.path=e.first(a,s+1).join("/"),r.type="folder",r.children=[{}],0==s&&(o=r),r=r.children[0]):(r.type="file",r.name=i,r.path=n.join("/"),t.$id&&(r.$id=t.$id))}),o}function d(t){var n=[],r=[];return e.each(t,function(o,i,s){if(-1==n.indexOf(o.name))n.push(o.name),r.push(o);else{var a=e.findWhere(t,{name:o.name});a.children=e.union(o.children,a.children),a.children=d(a.children)}}),r}e="default"in e?e["default"]:e,t="default"in t?t["default"]:t,n="default"in n?n["default"]:n,r="default"in r?r["default"]:r;var g={serverUrl:"http://tessellate.elasticbeanstalk.com",tokenName:"tessellate",tokenDataName:"tessellate-tokenData"},h={log:function(e){var t=o(e);"local"==g.envName?console.log(e):console.log.apply(console,t)},info:function(e){var t=o(e);"local"==g.envName?console.info(e):console.info.apply(console,t)},warn:function(e){var t=o(e);"local"==g.envName?console.warn(e):console.warn.apply(console,t)},debug:function(e){var t=o(e);"local"==g.envName?console.log(e):console.log.apply(console,t)},error:function(e){var t=o(e);"local"==g.envName?console.error(e):console.error.apply(console,t)}},m={},v=Object.defineProperties({item:function(e,t){return this.setItem(e,t)},setItem:function(e,t){m[e]=t,this.localExists&&window.sessionStorage.setItem(e,t)},getItem:function(e){return m[e]?m[e]:this.localExists?window.sessionStorage.getItem(e):null},removeItem:function(e){if(m[e]&&(m[e]=null),this.localExists)try{window.sessionStorage.removeItem(e)}catch(t){h.error({description:"Error removing item from session storage",error:t,obj:"storage",func:"removeItem"})}},clear:function(){if(m={},this.localExists)try{window.sessionStorage.clear()}catch(e){h.warn("Session storage could not be cleared.",e)}}},{localExists:{get:function(){var e="test";if("undefined"==typeof window||"undefined"==typeof window.sessionStorage)return!1;try{return window.sessionStorage.setItem(e,"1"),window.sessionStorage.removeItem(e),!0}catch(t){return h.error({description:"Error saving to session storage",error:t,obj:"storage",func:"localExists"}),!1}},configurable:!0,enumerable:!0}}),k=Object.defineProperties({save:function(e){this.string=e},"delete":function(){v.removeItem(g.tokenName),h.log({description:"Token was removed.",func:"delete",obj:"token"})}},{string:{get:function(){return v.getItem(g.tokenName)},set:function(e){h.log({description:"Token was set.",token:e,func:"string",obj:"token"}),this.data=t(e),v.setItem(g.tokenName,e)},configurable:!0,enumerable:!0},data:{get:function(){return v.getItem(g.tokenDataName)?v.getItem(g.tokenDataName):i(this.string)},set:function(t){if(e.isString(t)){var n=t;t=i(n),h.info({description:"Token data was set as string. Decoding token.",token:n,tokenData:t,func:"data",obj:"token"})}else h.log({description:"Token data was set.",data:t,func:"data",obj:"token"}),v.setItem(g.tokenDataName,t)},configurable:!0,enumerable:!0}}),y={get:function(e,t){var r=n.get(e);return t&&r.query(t),r=a(r),s(r)},post:function(e,t){var r=n.post(e).send(t);return r=a(r),s(r)},put:function(e,t){var r=n.put(e).send(t);return r=a(r),s(r)},del:function(e,t){var r=n.put(e).send(t);return r=a(r),s(r)}},b=function(){function t(e,n){if(_classCallCheck(this,t),!e)throw h.error({description:"Application name requires to use Matter.",func:"constructor",obj:"Matter"}),new Error("Application name is required to use Matter");this.name=e,n&&(this.options=n)}return _createClass(t,[{key:"signup",value:function(t){return y.post(this.endpoint+"/signup",t).then(function(n){return h.log({description:"Account request successful.",signupData:t,response:n,func:"signup",obj:"Matter"}),e.has(n,"account")?n.account:(h.warn({description:"Account was not contained in signup response.",signupData:t,response:n,func:"signup",obj:"Matter"}),n)})["catch"](function(e){return h.error({description:"Error requesting signup.",signupData:t,error:e,func:"signup",obj:"Matter"}),Promise.reject(e)})}},{key:"login",value:function(t){var n=this;return t&&t.password&&t.username?y.put(this.endpoint+"/login",t).then(function(t){return e.has(t,"data")&&e.has(t.data,"status")&&409==t.data.status?(h.warn({description:"Account not found.",response:t,func:"login",obj:"Matter"}),Promise.reject(t.data)):(h.log({description:"Successful login.",response:t,func:"login",obj:"Matter"}),e.has(t,"token")&&(n.token.string=t.token),e.has(t,"account")&&n.storage.setItem("currentUser"),t.account)})["catch"](function(e){return h.error({description:"Error requesting login.",error:e,status:e.status,func:"login",obj:"Matter"}),(409==e.status||400==e.status)&&(e=e.response.text),Promise.reject(e)}):(h.error({description:"Username/Email and Password are required to login",func:"login",obj:"Matter"}),Promise.reject({message:"Username/Email and Password are required to login"}))}},{key:"logout",value:function(){var e=this;return y.put(this.endpoint+"/logout").then(function(t){return h.log({description:"Logout successful.",response:t,func:"logout",obj:"Matter"}),e.storage.removeItem("currentUser"),e.token["delete"](),t})["catch"](function(t){return h.error({description:"Error requesting log out: ",error:t,func:"logout",obj:"Matter"}),e.storage.removeItem("currentUser"),e.token["delete"](),Promise.reject(t)})}},{key:"endpoint",get:function(){var t=g.serverUrl;return e.has(this,"options")&&this.options.localServer&&(t="http://localhost:4000",h.info({description:"LocalServer option was set to true. Now server url is local server.",url:t,func:"endpoint",obj:"Matter"})),"tessellate"==this.name?window&&e.has(window,"location")&&window.location.host==t&&(t="",h.info({description:"Host is Server, serverUrl simplified!",url:t,func:"endpoint",obj:"Matter"})):(t=g.serverUrl+"/apps/"+this.name,h.info({description:"Server url set.",url:t,func:"endpoint",obj:"Matter"})),t}},{key:"currentUser",get:function(){var e=this;return this.storage.item("currentUser")?Promise.resove(this.storage.item("currentUser")):y.get(this.endpoint+"/user").then(function(t){return h.log({description:"Current User Request responded.",responseData:t.data,func:"currentUser",obj:"Matter"}),e.currentUser=t.data,t.data})["catch"](function(e){return h.error({description:"Error requesting current user.",error:e,func:"currentUser",obj:"Matter"}),Promise.reject(e)})}},{key:"storage",get:function(){return v}},{key:"token",get:function(){return k}},{key:"isLoggedIn",get:function(){return this.token.string?!0:!1}}]),t}(),w={serverUrl:"http://tessellate.elasticbeanstalk.com",tokenName:"grout",fbUrl:"https://pruvit.firebaseio.com/",aws:{region:"us-east-1",cognito:{poolId:"us-east-1:72a20ffd-c638-48b0-b234-3312b3e64b2e",params:{AuthRoleArn:"arn:aws:iam::823322155619:role/Cognito_TessellateUnauth_Role",UnauthRoleArn:"arn:aws:iam::823322155619:role/Cognito_TessellateAuth_Role"}}}},j=new b("tesselate").storage,A={get:function(e,t){var r=n.get(e);return t&&r.query(t),r=u(r),c(r)},post:function(e,t){var r=n.post(e).send(t);return r=u(r),c(r)},put:function(e,t){var r=n.put(e).send(t);return r=u(r),c(r)},del:function(e,t){var r=n.put(e).send(t);return r=u(r),c(r)}},C=function(){function e(t){_classCallCheck(this,e),this.name=t.name,this.owner=t.owner||null,this.collaborators=t.collaborators||[],this.createdAt=t.createdAt,this.updatedAt=t.updatedAt,this.frontend=t.frontend||{},this.backend=t.backend||{},r&&(this.fbRef=new r(w.fbUrl+t.name))}return _createClass(e,[{key:"getStructure",value:function(){return this.getFiles().then(function(e){var t=p(e);return console.log("Child struct from array:",t),t},function(e){return console.error("[Application.getStructure] Error getting files: ",e),Promise.reject({message:"Error getting files.",error:e})})}},{key:"getFiles",value:function(){if(this.frontend&&this.frontend.bucketName){"undefined"!=typeof AWS.config.credentials&&AWS.config.credentials||l();var e=new AWS.S3,t={Bucket:this.frontend.bucketName};return new Promise(function(n,r){e.listObjects(t,function(e,t){return e?(console.error("[Application.getObjects()] Error listing objects:",e),r(e)):(console.log("[Application.getObjects()] listObjects returned:",t),n(t.Contents))})})}return console.error("[Applicaiton.getFiles] Attempting to get objects for bucket without name."),Promise.reject({message:"Bucket name required to get objects"})}},{key:"publishFile",value:function(e){if(!this.frontend)return console.error("Frontend data not available. Make sure to call .get()."),Promise.reject({message:"Front end data is required to publish file."});var t={Bucket:this.frontent.bucketName,Key:e.key,Body:e.content,ACL:"public-read"};return e.contentType&&(t.ContentType=e.contentType),s3.putObject(t,function(e,t){return e?(console.error("[Application.publishFile()] Error saving file:",e),Promise.reject(e)):(console.log("[Application.publishFile()] file saved successfully. Returning:",t),t)})}},{key:"addStorage",value:function(){var t=w.serverUrl+"/apps/"+this.name+"/storage";return A.post(t,appData).then(function(t){return console.log("[Application.addStorage()] Apps:",t),new e(t)})["catch"](function(e){return console.error("[Application.addStorage()] Error getting apps list: ",e),Promise.reject(e)})}},{key:"applyTemplate",value:function(){w.serverUrl+"/apps/"+this.name+"/template";console.log("Applying templates to existing")}}]),e}(),M=function(){function e(t){if(_classCallCheck(this,e),!t)throw console.error("Application name is required to start an AppAction"),new Error("Application name is required to start an AppAction");this.name=t,this.endpoint=w.serverUrl+"/apps/"+this.name}return _createClass(e,[{key:"get",value:function(){return A.get(this.endpoint).then(function(e){return console.log("[MatterClient.app().get()] App(s) data loaded:",e),new C(e)})["catch"](function(e){return console.error("[MatterClient.app().get()] Error getting apps list: ",e),Promise.reject(e)})}},{key:"update",value:function(e){return A.put(this.endpoint,e).then(function(e){return console.log("[MatterClient.apps().update()] App:",e),new C(e)})["catch"](function(e){return console.error("[MatterClient.apps().update()] Error updating app: ",e),Promise.reject(e)})}},{key:"del",value:function(e){return A["delete"](this.endpoint,e).then(function(e){return console.log("[MatterClient.apps().del()] Apps:",e),new C(e)})["catch"](function(e){return console.error("[MatterClient.apps().del()] Error deleting app: ",e),Promise.reject(e)})}},{key:"getFiles",value:function(){return this.get().then(function(e){e.getFiles().then(function(e){return e})["catch"](function(e){return console.error("[MatterClient.app().getFiles()] Error getting application files: ",e),Promise.reject(e)})})["catch"](function(e){return console.error("[MatterClient.app().getFiles()] Error getting application: ",e),Promise.reject(e)})}},{key:"getStructure",value:function(){return this.get().then(function(e){return e.getStructure().then(function(e){return console.log("Structure loaded: ",e),e})["catch"](function(e){return console.error("[MatterClient.app().getStructure()] Error getting application structure: ",e),Promise.reject(e)})})["catch"](function(e){return console.error("[MatterClient.app().getStructure()] Error getting application: ",e),Promise.reject(e)})}}]),e}(),E=function(){function e(){_classCallCheck(this,e),this.endpoint=w.serverUrl+"/apps"}return _createClass(e,[{key:"get",value:function(){return A.get(this.endpoint).then(function(e){return console.log("[MatterClient.apps().get()] App(s) data loaded:",e),e})["catch"](function(e){return console.error("[MatterClient.apps().get()] Error getting apps list: ",e),Promise.reject(e)})}},{key:"add",value:function(e){return A.post(this.endpoint,e).then(function(e){return console.log("[MatterClient.apps().add()] Application added successfully: ",e),new Application(e)})["catch"](function(e){return console.error("[MatterClient.getApps()] Error adding application: ",e),Promise.reject(e)})}}]),e}(),P=function(){function e(t){_classCallCheck(this,e),this.name=t.name,this.username=t.username,this.createdAt=t.createdAt,this.updatedAt=t.updatedAt}return _createClass(e,[{key:"app",value:function(e){return new M(e)}},{key:"apps",get:function(){return new E}}]),e}(),S=function(){function e(t){if(_classCallCheck(this,e),!t)throw console.error("Username is required to start an UserAction"),new Error("Username is required to start an UserAction");this.name=t,this.endpoint=w.serverUrl+"/users/"+this.name}return _createClass(e,[{key:"get",value:function(){return A.get(this.endpoint).then(function(e){return console.log("[MatterClient.user().get()] App(s) data loaded:",e),new P(e)})["catch"](function(e){return console.error("[MatterClient.user().get()] Error getting users list: ",e),Promise.reject(e)})}},{key:"update",value:function(e){return A.put(this.endpoint,e).then(function(e){return console.log("[MatterClient.users().update()] App:",e),new P(e)})["catch"](function(e){return console.error("[MatterClient.users().update()] Error updating user: ",e),Promise.reject(e)})}},{key:"del",value:function(e){console.error("Deleting a user is currently disabled.")}}]),e}(),U=function(){function t(){_classCallCheck(this,t),this.endpoint=w.serverUrl+"/users"}return _createClass(t,[{key:"get",value:function(t){var n=this.endpoint;if(t&&!e.isString(t)){var r="Get only handles username as a string";return console.error(r),Promise.reject({message:r})}return t&&(n=n+"/"+t),A.get(n).then(function(e){return console.log("[MatterClient.apps().get()] App(s) data loaded:",e),e})["catch"](function(e){return console.error("[MatterClient.apps().get()] Error getting apps list: ",e),Promise.reject(e)})}},{key:"add",value:function(e){return A.post(this.endpoint,e).then(function(e){return console.log("[MatterClient.apps().add()] Application added successfully: ",e),new Application(e)})["catch"](function(e){return console.error("[MatterClient.getApps()] Error adding application: ",e),Promise.reject(e)})}},{key:"search",value:function(t){console.log("search called:",t);var n=this.endpoint+"/search/";return t&&e.isString(t)&&(n+=t),console.log("searchEndpoint:",n),A.get(n).then(function(e){return console.log("[MatterClient.users().search()] Users(s) data loaded:",e),e})["catch"](function(e){return console.error("[MatterClient.users().search()] Error getting apps list: ",e),Promise.reject(e)})}}]),t}(),_=function(e){function t(){_classCallCheck(this,t),_get(Object.getPrototypeOf(t.prototype),"constructor",this).call(this,"tessellate",{localServer:!0})}return _inherits(t,e),_createClass(t,[{key:"app",value:function(e){return console.log("New AppAction:",new M(e)),new M(e)}},{key:"user",value:function(e){return new S(e)}},{key:"apps",get:function(){return console.log("New AppsAction:",new E),new E}},{key:"users",get:function(){return new U}}]),t}(b);return _});
//# sourceMappingURL=grout.min.js.map