function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _get=function(e,t,n){for(var r=!0;r;){var o=e,i=t,c=n;r=!1,null===o&&(o=Function.prototype);var a=Object.getOwnPropertyDescriptor(o,i);if(void 0!==a){if("value"in a)return a.value;var s=a.get;return void 0===s?void 0:s.call(c)}var u=Object.getPrototypeOf(o);if(null===u)return void 0;e=u,t=i,n=c,r=!0,a=u=void 0}},_createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("kyper-matter"),require("lodash"),require("firebase"),require("aws-sdk")):"function"==typeof define&&define.amd?define(["kyper-matter","lodash","firebase","aws-sdk"],t):e.Grout=t(e.Matter,e._,e.Firebase,e.AWS)}(this,function(e,t,n,r){"use strict";function o(){r.config.update({credentials:new r.CognitoIdentityCredentials({IdentityPoolId:u.aws.cognito.poolId}),region:u.aws.region})}function i(){r.config.update({credentials:new r.CognitoIdentityCredentials({IdentityPoolId:u.aws.cognito.poolId}),region:u.aws.region})}function c(e){var t=e.map(function(e){return a(e)});return s(t)}function a(e){var n;t.has(e,"path")?n=e.path.split("/"):(n=e.Key.split("/"),e=t.pick(e,"Key"),e.path=e.Key,e.name=e.Key);var r=e;if(1==n.length)return r.name=n[0],t.has(r,"type")||(r.type="file"),r.path=n[0],r;var o={};return t.each(n,function(i,c,a){c!=a.length-1?(r.name=i,r.path=t.take(a,c+1).join("/"),r.type="folder",r.children=[{}],0==c&&(o=r),r=r.children[0]):(r.type="file",r.name=i,r.path=n.join("/"),e.$id&&(r.$id=e.$id))}),o}function s(e){var n=[],r=[];return t.each(e,function(o){if(-1==n.indexOf(o.name))n.push(o.name),r.push(o);else{var i=t.findWhere(e,{name:o.name});i.children=t.union(o.children,i.children),i.children=s(i.children)}}),r}e="default"in e?e["default"]:e,t="default"in t?t["default"]:t,n="default"in n?n["default"]:n,r="default"in r?r["default"]:r;var u={serverUrl:"http://tessellate.elasticbeanstalk.com",tokenName:"grout",fbUrl:"https://kyper-tech.firebaseio.com/tessellate",appName:"tessellate",matterOptions:{localServer:!1},aws:{region:"us-east-1",cognito:{poolId:"us-east-1:72a20ffd-c638-48b0-b234-3312b3e64b2e",params:{AuthRoleArn:"arn:aws:iam::823322155619:role/Cognito_TessellateUnauth_Role",UnauthRoleArn:"arn:aws:iam::823322155619:role/Cognito_TessellateAuth_Role"}}}},p=new e(u.appName,u.matterOptions),l=p.utils.request,d=p.utils.logger,f=function(){function e(n){if(_classCallCheck(this,e),n&&t.isObject(n)&&(t.has(n,"directoryName")||t.has(n,"name")))this.name=n.directoryName||n.name,t.has(n,"appName")&&(this.appName=n.appName);else{if(!n||!t.isString(n))throw d.error({description:"Action data object with name is required to start a Directory Action.",func:"constructor",obj:"Directory"}),new Error("Directory Data object with name is required to start a Directory action.");this.name=n}}return _createClass(e,[{key:"get",value:function(){return l.get(this.directoryEndpoint).then(function(e){return d.info({description:"Directory data loaded successfully.",response:e,func:"get",obj:"Directory"}),e})["catch"](function(e){return d.info({description:"Error getting directory.",error:e,func:"get",obj:"Directory"}),Promise.reject(e)})}},{key:"update",value:function(e){return d.debug({description:"Directory updated called.",directoryData:e,func:"update",obj:"Directory"}),p.utils.request.put(this.directoryEndpoint,e).then(function(t){return d.info({description:"Directory updated successfully.",directoryData:e,response:t,func:"update",obj:"Directory"}),t})["catch"](function(t){return d.error({description:"Error updating directory.",directoryData:e,error:t,func:"update",obj:"Directory"}),Promise.reject(t)})}},{key:"del",value:function(e){return d.debug({description:"Delete directory called.",directoryData:e,func:"del",obj:"Directory"}),l["delete"](this.directoryEndpoint,e).then(function(t){return d.info({description:"Directory deleted successfully.",directoryData:e,func:"del",obj:"Directory"}),t})["catch"](function(e){return d.error({description:"Error deleting directory.",error:e,func:"del",obj:"Directory"}),Promise.reject(e)})}},{key:"directoryEndpoint",get:function(){var e=[p.endpoint,"directories",this.name];t.has(this,"app")&&t.has(this.app,"name")&&e.splice(1,0,"apps",this.app.name);var n=e.join("/");return d.log({description:"Directory endpoint built.",endpoint:n,func:"directoryEndpoint",obj:"Directory"}),n}}]),e}(),g=p.utils.request,h=p.utils.logger,b=function(){function e(n){_classCallCheck(this,e),n&&t.isObject(n)&&t.has(n,"app")?(this.app=n.app,h.log({description:"Provided app data set to app parameter.",action:this,providedData:n,func:"constructor",obj:"DirectoriesAction"})):n&&t.isString(n)&&(this.app={name:n},h.log({description:"App name provided as string was set.",action:this,providedData:n,func:"constructor",obj:"DirectoriesAction"})),h.info({description:"New directories action.",action:this,providedData:n,func:"constructor",obj:"DirectoriesAction"})}return _createClass(e,[{key:"get",value:function(){return h.debug({description:"Directories get called.",action:this,func:"get",obj:"DirectoriesAction"}),g.get(this.directoriesEndpoint).then(function(e){return h.info({descrption:"Directories loaded successfully.",response:e,func:"get",obj:"DirectoriesAction"}),e})["catch"](function(e){return h.error({descrption:"error getting users",error:e,func:"get",obj:"DirectoriesAction"}),Promise.reject(e)})}},{key:"add",value:function(e){return h.debug({description:"Add directory called.",action:this,appData:e,func:"get",obj:"DirectoriesAction"}),g.post(this.directoriesEndpoint,e).then(function(e){return h.log({description:"Application added successfully.",response:e,func:"add",obj:"DirectoriesAction"}),e})["catch"](function(e){return h.error({description:"Error adding group.",error:e,func:"add",obj:"DirectoriesAction"}),Promise.reject(e)})}},{key:"search",value:function(e){var n=this.directoriesEndpoint+"/search/";return e&&t.isString(e)&&(n+=e),e&&""!=e?g.get(n).then(function(e){return h.log({description:"Found directories based on search.",response:e,func:"search",obj:"DirectoriesAction"}),e})["catch"](function(e){return h.error({description:"Error searching directories.",error:e,func:"search",obj:"DirectoriesAction"}),Promise.reject(e)}):(h.debug({description:"Null query, returning empty array.",func:"search",obj:"DirectoriesAction"}),Promise.resolve([]))}},{key:"directoriesEndpoint",get:function(){var e=[p.endpoint,"directories"];t.has(this,"app")&&t.has(this.app,"name")&&e.splice(1,0,"apps",this.app.name);var n=e.join("/");return h.log({description:"Directories endpoint built.",endpoint:n,func:"directoriesEndpoint",obj:"DirectoriesAction"}),n}}]),e}(),j=p.utils.request,y=p.utils.logger,m=function(){function e(n){if(_classCallCheck(this,e),n&&t.isObject(n)&&t.has(n,"groupData"))this.name=t.isObject(n.groupData)?n.groupData.name:n.groupData,t.has(n,"app")&&(this.app=n.app);else{if(!n||!t.isString(n))throw y.error({description:"Action data is required to start a Group Action.",func:"constructor",obj:"Group"}),new Error("Username is required to start an Group");this.name=n}}return _createClass(e,[{key:"get",value:function(){return j.get(this.groupEndpoint).then(function(e){return y.info({description:"Group data loaded successfully.",response:e,func:"get",obj:"Group"}),e})["catch"](function(e){return y.info({description:"Error getting group.",error:e,func:"get",obj:"Group"}),Promise.reject(e.response.text||e.response)})}},{key:"update",value:function(e){return y.log({description:"Group updated called.",groupData:e,func:"update",obj:"Group"}),p.utils.request.put(this.groupEndpoint,e).then(function(t){return y.info({description:"Group updated successfully.",groupData:e,response:t,func:"update",obj:"Group"}),t})["catch"](function(t){return y.error({description:"Error updating group.",groupData:e,error:t,func:"update",obj:"Group"}),Promise.reject(t.response.text||t.response)})}},{key:"del",value:function(e){return y.log({description:"Delete group called.",groupData:e,func:"del",obj:"Group"}),j.del(this.groupEndpoint,{}).then(function(t){return y.info({description:"Group deleted successfully.",groupData:e,func:"del",obj:"Group"}),t})["catch"](function(t){return y.error({description:"Error deleting group.",error:t,text:t.response.text,groupData:e,func:"del",obj:"Group"}),Promise.reject(t.response.text||t.response)})}},{key:"addAccounts",value:function(e){y.log({description:"Group updated called.",accountsData:e,func:"update",obj:"Group"});var n=e;return t.isString(e)&&(n=e.split(",")),t.isString(n[0])?(y.error({description:"Accounts array only currently supports account._id not account.username.",accountsData:e,func:"update",obj:"Group"}),Promise.reject({message:"Accounts array only currently supports account._id not account.username."})):(y.log({description:"Updating group with accounts array.",accountsArray:n,func:"update",obj:"Group"}),this.update({accounts:n}).then(function(e){return y.info({description:"Account(s) added to group successfully.",response:e,func:"addAccounts",obj:"Group"}),e})["catch"](function(e){return y.error({description:"Error addAccountseting group.",error:e,func:"addAccounts",obj:"Group"}),Promise.reject(e.response.text||e.response)}))}},{key:"groupEndpoint",get:function(){var e=[p.endpoint,"groups",this.name];t.has(this,"app")&&t.has(this.app,"name")&&e.splice(1,0,"apps",this.app.name);var n=e.join("/");return y.log({description:"Group Endpoint built.",endpoint:n,func:"groupEndpoint",obj:"Group"}),n}}]),e}(),A=p.utils.request,v=p.utils.logger,D=function(){function e(n){_classCallCheck(this,e),n&&t.isObject(n)&&t.has(n,"app")?(this.app=n.app,v.log({description:"Provided app data set to app parameter.",action:this,providedData:n,func:"constructor",obj:"GroupsAction"})):n&&t.isString(n)&&(this.app={name:n},v.log({description:"App name provided as string was set.",action:this,providedData:n,func:"constructor",obj:"GroupsAction"})),v.info({description:"New Groups action.",action:this,providedData:n,func:"constructor",obj:"GroupsAction"})}return _createClass(e,[{key:"get",value:function(){return v.log({description:"Get group called.",func:"get",obj:"GroupsAction"}),A.get(this.groupsEndpoint).then(function(e){return v.info({description:"Groups loaded successfully.",response:e,func:"get",obj:"GroupsAction"}),e})["catch"](function(e){return v.info({description:"Error getting groups.",error:e,func:"get",obj:"GroupsAction"}),Promise.reject(e)})}},{key:"add",value:function(e){var n=e;return v.debug({description:"Add group called.",groupData:e,func:"add",obj:"GroupsAction"}),t.isString(e)&&(n={name:e}),v.debug({description:"Add group called.",newGroupData:n,func:"add",obj:"GroupsAction"}),A.post(this.groupsEndpoint,n).then(function(e){return v.log({description:"Group added to application successfully.",response:e,func:"add",obj:"GroupsAction"}),e})["catch"](function(e){return v.error({description:"Error adding group.",error:e,func:"add",obj:"GroupsAction"}),Promise.reject(e)})}},{key:"search",value:function(e){if(v.debug({description:"Search groups called.",query:e,func:"search",obj:"GroupsAction"}),!e||""==e||!t.isString(e))return v.log({description:"Null or invalid query, returning empty array.",func:"search",obj:"GroupsAction"}),Promise.resolve([]);var n=this.groupsEndpoint+"/search/"+e;return v.debug({description:"Search endpoint created.",endpoint:n,func:"search",obj:"GroupsAction"}),A.get(n).then(function(e){return v.log({description:"Found groups based on search.",response:e,func:"search",obj:"GroupsAction"}),e})["catch"](function(e){return v.error({description:"Error searching groups.",error:e,func:"search",obj:"GroupsAction"}),Promise.reject(e)})}},{key:"groupsEndpoint",get:function(){var e=[p.endpoint,"groups"];t.has(this,"app")&&t.has(this.app,"name")&&e.splice(1,0,"apps",this.app.name);var n=e.join("/");return v.log({description:"Groups Endpoint built.",endpoint:n,func:"groupsEndpoint",obj:"GroupsAction"}),n}}]),e}(),k=p.utils.request,w=p.utils.logger,E=function(){function e(n){if(_classCallCheck(this,e),n&&t.isObject(n)&&t.has(n,"username"))t.extend(this,n);else{if(!n||!t.isString(n))throw w.error({description:"AccountData is required to start an AccountAction",func:"constructor",obj:"Account"}),new Error("username is required to start an AccountAction");this.username=n}}return _createClass(e,[{key:"get",value:function(){return w.debug({description:"Account data loaded successfully.",func:"get",obj:"Account"}),k.get(this.accountEndpoint).then(function(t){return w.info({description:"Account data loaded successfully.",response:t,func:"get",obj:"Account"}),new e(t)})["catch"](function(e){return w.error({description:"Error getting user.",error:e,func:"get",obj:"Account"}),Promise.reject(e)})}},{key:"update",value:function(t){return w.debug({description:"Update user called.",accountData:t,func:"update",obj:"Account"}),k.put(this.accountEndpoint,t).then(function(t){return w.info({description:"Account updated successfully.",func:"update",obj:"Account"}),new e(t)})["catch"](function(e){return w.error({description:"Error updating user.",func:"update",obj:"Account"}),Promise.reject(e)})}},{key:"del",value:function(t){return w.debug({description:"Delete user called.",func:"del",obj:"Account"}),k.del(this.accountEndpoint,t).then(function(t){return w.info({description:"Delete user successful.",response:t,func:"del",obj:"Account"}),new e(t)})["catch"](function(e){return w.error({description:"Error deleting user.",accountData:t,error:e,func:"del",obj:"Account"}),Promise.reject(e)})}},{key:"accountEndpoint",get:function(){var e=[p.endpoint,"accounts",this.username];t.has(this,"app")&&t.has(this.app,"name")&&e.splice(1,0,"apps",this.app.name);var n=e.join("/");return w.log({description:"Account Endpoint built.",endpoint:n,func:"accountEndpoint",obj:"Account"}),n}}]),e}(),F=p.utils.logger,G=function(){function e(n){_classCallCheck(this,e),n&&t.isObject(n)&&t.has(n,"app")?(this.app=n.app,F.log({description:"Provided app data set to app parameter.",action:this,providedData:n,func:"constructor",obj:"AccountsAction"})):n&&t.isString(n)&&(this.app={name:n},F.log({description:"App name provided as string was set.",action:this,providedData:n,func:"constructor",obj:"AccountsAction"})),F.info({description:"New Accounts action.",action:this,providedData:n,func:"constructor",obj:"AccountsAction"})}return _createClass(e,[{key:"get",value:function(){return F.log({description:"Accounts get called.",func:"get",obj:"AccountsAction"}),p.utils.request.get(this.accountsEndpoint).then(function(e){return F.info({description:"Accounts loaded successfully.",func:"get",obj:"AccountsAction"}),e})["catch"](function(e){return F.info({description:"Error getting accounts.",error:e,func:"get",obj:"AccountsAction"}),Promise.reject(e.message||"Error getting accounts.")})}},{key:"add",value:function(e){return F.info({description:"Account add called.",accountData:e,func:"add",obj:"AccountsAction"}),this.utils.request.post(this.accountsEndpoint,e).then(function(e){return F.info({description:"Account added successfully.",response:e,newAccount:new E(e),func:"add",obj:"AccountsAction"}),new E(e)})["catch"](function(t){return F.error({description:"Account add called.",error:t,accountData:e,func:"add",obj:"AccountsAction"}),Promise.reject(t.message||"Error adding account.")})}},{key:"search",value:function(e){F.log({description:"Accounts search called.",query:e,func:"search",obj:"AccountsAction"});var n=this.accountsEndpoint+"/search/";return e&&t.isString(e)&&(n+=e),e&&""!=e?p.utils.request.get(n).then(function(t){return F.log({description:"Accounts search responded.",response:t,query:e,func:"search",obj:"AccountsAction"}),t})["catch"](function(t){return F.error({description:"Error searching Accounts.",error:t,query:e,func:"search",obj:"AccountsAction"}),Promise.reject(t.message||"Error searching accounts.")}):(F.log({description:"Null query, returning empty array.",func:"search",obj:"AccountsAction"}),Promise.resolve([]))}},{key:"accountsEndpoint",get:function(){var e=[p.endpoint,"accounts"];t.has(this,"app")&&t.has(this.app,"name")&&e.splice(1,0,"apps",this.app.name);var n=e.join("/");return F.log({description:"Accounts Endpoint built.",endpoint:n,func:"accountsEndpoint",obj:"AccountsAction"}),n}}]),e}(),C=p.utils.request,P=p.utils.logger,T=function(){function e(n){if(_classCallCheck(this,e),!n||!t.isString(n))throw P.error({description:"Template data is required to start a Template action.",func:"constructor",obj:"Template"}),new Error("Template data is required to start a Template action.");this.name=n}return _createClass(e,[{key:"get",value:function(){return P.log({description:"Get template called.",name:this.name,func:"get",obj:"Template"}),C.get(this.templateEndpoint).then(function(e){return P.log({description:"Get template responded.",response:e,func:"get",obj:"Template"}),e})["catch"](function(e){return P.error({description:"Error getting template.",error:e,func:"get",obj:"Template"}),Promise.reject(e)})}},{key:"update",value:function(e){return P.log({description:"Update template called.",templateData:e,func:"update",obj:"Template"}),C.put(this.templateEndpoint,e).then(function(t){return P.log({description:"Update template responded.",response:t,templateData:e,func:"update",obj:"Template"}),t})["catch"](function(e){return P.error({description:"Error updating template.",error:e,func:"update",obj:"Template"}),Promise.reject(e)})}},{key:"del",value:function(e){return P.log({description:"Delete template called.",templateData:e,func:"del",obj:"Template"}),C["delete"](this.endpoint,e).then(function(e){return P.log({description:"Template deleted successfully.",response:e,func:"del",obj:"Template"}),e})["catch"](function(e){return P.error({description:"Error deleting template.",error:e,func:"del",obj:"Template"}),Promise.reject(e)})}},{key:"templateEndpoint",get:function(){return p.endpoint+"/templates/"+this.name}}]),e}(),S=p.utils.logger,q=p.utils.request,_=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"get",value:function(){return S.log({description:"Get template called.",func:"get",obj:"TemplatesAction"}),q.get(this.templatesEndpoint).then(function(e){return S.log({description:"Templates loaded.",response:e,func:"get",obj:"TemplatesAction"}),e})["catch"](function(e){return S.error({description:"Error getting templates.",error:e,func:"get",obj:"TemplatesAction"}),Promise.reject(e)})}},{key:"add",value:function(e){return S.log({description:"Add template called.",func:"add",obj:"TemplatesAction"}),q.post(this.templatesEndpoint,e).then(function(e){return S.log({description:"Templates added successfully.",func:"add",obj:"TemplatesAction"}),e})["catch"](function(e){return S.error({description:"Error adding template.",error:e,func:"add",obj:"TemplatesAction"}),Promise.reject(e)})}},{key:"search",value:function(e){S.log({description:"Search template called.",query:e,func:"search",obj:"TemplatesAction"});var n=this.templatesEndpoint+"/search/";return e&&t.isString(e)&&(n+=e),S.log({description:"Search endpoint created.",endpoint:n,func:"search",obj:"TemplatesAction"}),q.get(n).then(function(e){return S.log({description:"Template(s) found successfully.",response:e,endpoint:n,func:"search",obj:"TemplatesAction"}),e})["catch"](function(t){return S.log({description:"Error searching for templates.",query:e,error:t,endpoint:n,func:"search",obj:"TemplatesAction"}),Promise.reject(t)})}},{key:"templatesEndpoint",get:function(){var e=[p.endpoint,"templates"];t.has(this,"app")&&t.has(this.app,"name")&&S.log({description:"Templates action is not currently supported for a specific application.",func:"accountsEndpoint",obj:"AccountsAction"});var n=e.join("/");return S.log({description:"Templates endpoint built.",endpoint:n,func:"templatesEndpoint",obj:"TemplatesAction"}),n}}]),e}(),O=p.utils.logger,x=function(){function e(n){if(_classCallCheck(this,e),!(n&&t.isObject(n)&&t.has(n,"fileData")&&t.has(n,"app")))throw n&&!t.isObject(n)?(O.error({description:"File data is not an object. File data must be an object that includes path and appName.",func:"constructor",obj:"File"}),new Error("File data must be an object that includes path and appName.")):(O.error({description:"File data that includes path and app is needed to create a File action.",func:"constructor",obj:"File"}),new Error("File data with path and app is needed to create file action."));t.extend(this,n.fileData),this.app=n.app,this.pathArray=this.path.split("/"),this.name=t.has(n.fileData,"name")?n.fileData.name:this.pathArray[this.pathArray.length-1],this.type="file",O.debug({description:"File object constructed.",file:this,func:"constructor",obj:"File"})}return _createClass(e,[{key:"get",value:function(){var e=this;if(!this.app||!this.app.frontend)return O.log({description:"Application Frontend data not available. Calling applicaiton get.",func:"get",obj:"File"}),this.app.get().then(function(t){return e.app=t,O.log({description:"Application get successful. Getting file.",app:t,func:"get",obj:"File"}),e.get()},function(e){return O.error({description:"Application Frontend data not available.",error:e,func:"get",obj:"File"}),Promise.reject({message:"Front end data is required to get file."})});var n=function(){"undefined"!=typeof r.config.credentials&&r.config.credentials||(O.log({description:"AWS creds do not exist, so they are being set.",func:"publish",obj:"File"}),o());var n=new r.S3,i={Bucket:e.app.frontend.bucketName,Key:e.path};e.contentType&&(i.ContentType=e.contentType),O.debug({description:"File get params built.",getData:i,file:e,func:"get",obj:"File"});var c=e;return{v:new Promise(function(e,r){n.getObject(i,function(n,o){return n?(O.error({description:"Error loading file from S3.",error:n,func:"get",obj:"File"}),r(n)):(O.info({description:"File loaded successfully.",data:o,func:"get",obj:"File"}),void(t.has(o,"Body")?(O.info({description:"File has content.",content:o.Body.toString(),metaData:o.Metadata.toString(),func:"get",obj:"File"}),c.content=o.Body.toString(),O.info({description:"File content has been added to file.",file:c,func:"get",obj:"File"}),e(c)):e(o)))})})}}();return"object"==typeof n?n.v:void 0}},{key:"open",value:function(){return this.get()}},{key:"publish",value:function(e){var n=this;if(O.debug({description:"File publish called.",file:this,fileData:e,func:"publish",obj:"File"}),!this.app.frontend)return O.error({description:"Application Frontend data not available. Make sure to call .get().",func:"publish",obj:"File"}),Promise.reject({message:"Front end data is required to publish file."});var i=function(){if(!t.has(e,["content","path"]))return O.error({description:"File data including path and content required to publish.",func:"publish",obj:"File"}),{v:Promise.reject({message:"File data including path and content required to publish."})};var i={Bucket:n.app.frontend.bucketName,Key:e.path,Body:e.content,ACL:"public-read"};n.contentType&&(i.ContentType=n.contentType),"undefined"!=typeof r.config.credentials&&r.config.credentials||(O.debug({description:"AWS creds do not exist, so they are being set.",func:"publish",obj:"File"}),o());var c=new r.S3;return O.debug({description:"File publish params built.",saveParams:i,fileData:n,func:"publish",obj:"File"}),{v:new Promise(function(e,t){c.putObject(i,function(n,r){n?(O.error({description:"Error saving file to S3.",error:n,func:"publish",obj:"File"}),t(n)):(O.log({description:"File saved successfully.",response:r,func:"publish",obj:"File"}),e(r))})})}}();return"object"==typeof i?i.v:void 0}},{key:"del",value:function(){var e=this;if(!this.app||!this.app.frontend)return O.log({description:"Application Frontend data not available. Calling applicaiton get.",func:"get",obj:"File"}),this.app.get().then(function(t){return e.app=t,O.log({description:"Application get successful. Getting file.",app:t,func:"get",obj:"File"}),e.get()},function(e){return O.error({description:"Application Frontend data not available. Make sure to call .get().",error:e,func:"get",obj:"File"}),Promise.reject({message:"Front end data is required to get file."})});var n=function(){"undefined"!=typeof r.config.credentials&&r.config.credentials||(O.debug({description:"AWS creds do not exist, so they are being set.",func:"publish",obj:"File"}),o());var n=new r.S3,i={Bucket:e.app.frontend.bucketName,Key:e.path};return e.contentType&&(i.ContentType=e.contentType),O.debug({description:"File get params built.",saveParams:i,file:e,func:"get",obj:"File"}),{v:new Promise(function(e,r){n.deleteObject(i,function(n,o){return n?(O.error({description:"Error loading file from S3.",error:n,func:"get",obj:"File"}),r(n)):(O.info({description:"File loaded successfully.",fileData:o,func:"get",obj:"File"}),void(t.has(o,"Body")?(O.info({description:"File has content.",fileData:o.Body.toString(),func:"get",obj:"File"}),e(o.Body.toString())):e(o)))})})}}();return"object"==typeof n?n.v:void 0}},{key:"openWithFirepad",value:function(){}},{key:"getDefaultContent",value:function(){}},{key:"fileType",get:function(){return"js"==this.ext?"javascript":this.ext}},{key:"ext",get:function(){var e=/(?:\.([^.]+))?$/;return e.exec(this.name)[1]}},{key:"fbRef",get:function(){var e=[u.fbUrl,this.app.name,this.pathArray].join("/");return O.log({description:"File ref url generated",url:e,func:"fbRef",obj:"File"}),new n(e)}}]),e}(),N=p.utils.logger,U=function(){function e(n){if(_classCallCheck(this,e),n&&t.isObject(n)&&t.has(n,"app"))this.app=n.app;else{if(!n||!t.isString(n))throw n&&t.isArray(n)?(N.error({description:"Action data object with name is required to start a Files Action.",func:"constructor",obj:"Files"}),new Error("Files Data object with application is required to start a Files action.")):(N.error({description:"Action data object with name is required to start a Files Action.",func:"constructor",obj:"Files"}),new Error("Files Data object with name is required to start a Files action."));this.app={name:n}}N.debug({description:"Files object constructed.",func:"constructor",obj:"Files"})}return _createClass(e,[{key:"publish",value:function(){}},{key:"get",value:function(){var e=this;if(!this.app.frontend||!this.app.frontend.bucketName)return N.warn({description:"Application Frontend data not available. Calling .get().",app:this.app,func:"get",obj:"Files"}),this.app.get().then(function(n){return N.log({description:"Application get returned.",data:n,func:"get",obj:"Files"}),e.app=n,t.has(n,"frontend")?e.get():(N.error({description:"Application does not have Frontend to get files from.",func:"get",obj:"Files"}),Promise.reject({message:"Application does not have frontend to get files from."}))},function(e){return N.error({description:"Application Frontend data not available. Make sure to call .get().",error:e,func:"get",obj:"Files"}),Promise.reject({message:"Bucket name required to get objects"})});var n=function(){"undefined"!=typeof r.config.credentials&&r.config.credentials||i();var t=new r.S3,n={Bucket:e.app.frontend.bucketName};return{v:new Promise(function(e,r){t.listObjects(n,function(t,n){return t?(N.error({description:"Error getting files from S3.",error:t,func:"get",obj:"Files"}),r(t)):(N.info({description:"Files list loaded.",filesData:n,func:"get",obj:"Files"}),e(n.Contents))})})}}();return"object"==typeof n?n.v:void 0}},{key:"add",value:function(){}},{key:"del",value:function(){}},{key:"buildStructure",value:function(){return N.debug({description:"Build Structure called.",func:"buildStructure",obj:"Application"}),this.get().then(function(e){var t=c(e);return N.log({description:"Child struct from array.",childStructure:t,func:"buildStructure",obj:"Application"}),t},function(e){return N.error({description:"Error getting application files.",error:e,func:"buildStructure",obj:"Application"}),Promise.reject({message:"Error getting files.",error:e})})}}]),e}(),B=p.utils.request,I=p.utils.logger,K=function(){function e(r){_classCallCheck(this,e),r&&t.isObject(r)?t.extend(this,r):r&&t.isString(r)&&(this.name=r),n&&t.has(u,"fbUrl")&&t.has(this,"name")&&(this.fbRef=new n(u.fbUrl+this.name))}return _createClass(e,[{key:"get",value:function(){return I.debug({description:"Application get called.",func:"get",obj:"Application"}),B.get(this.appEndpoint).then(function(t){return I.info({description:"Application loaded successfully.",response:t,application:new e(t),func:"get",obj:"Application"}),new e(t)})["catch"](function(e){return I.error({description:"Error getting Application.",message:e.response.text,error:e,func:"get",obj:"Application"}),Promise.reject(e.response.text||e.response)})}},{key:"update",value:function(t){return I.debug({description:"Application update called.",func:"update",obj:"Application"}),B.put(this.appEndpoint,t).then(function(t){return I.info({description:"Application updated successfully.",response:t,func:"update",obj:"Application"}),new e(t)})["catch"](function(e){return I.error({description:"Error updating application.",error:e,func:"update",obj:"Application"}),Promise.reject(e.response.text||e.response)})}},{key:"addStorage",value:function(){return I.debug({description:"Application add storage called.",application:this,func:"addStorage",obj:"Application"}),B.post(this.appEndpoint+"/storage",{}).then(function(t){return I.info({description:"Storage successfully added to application.",response:t,application:new e(t),func:"addStorage",obj:"Application"}),new e(t)})["catch"](function(e){return I.error({description:"Error adding storage to application.",error:e,func:"addStorage",obj:"Application"}),Promise.reject(e.response.text||e.response)})}},{key:"applyTemplate",value:function(){var t=this;return I.error({description:"Applying templates to existing applications is not currently supported.",func:"applyTemplate",obj:"Application"}),B.post(this.appEndpoint,{}).then(function(n){return I.info({description:"Template successfully applied to application.",response:n,application:t,func:"applyTemplate",obj:"Application"}),new e(n)})["catch"](function(e){return I.error({description:"Error applying template to application.",error:e,application:t,func:"applyTemplate",obj:"Application"}),Promise.reject(e.response.text||e.response)})}},{key:"File",value:function(e){return I.debug({description:"Applications file action called.",fileData:e,application:this,func:"file",obj:"Application"}),new x({app:this,fileData:e})}},{key:"User",value:function(e){return I.debug({description:"Applications user action called.",userData:e,application:this,func:"user",obj:"Application"}),new E({app:this,userData:e})}},{key:"Account",value:function(e){return I.debug({description:"Applications account action called.",userData:e,application:this,func:"user",obj:"Application"}),new E({app:this,userData:e})}},{key:"Group",value:function(e){return I.debug({description:"Applications group action called.",groupData:e,application:this,func:"group",obj:"Application"}),new m({app:this,groupData:e})}},{key:"Directory",value:function(e){return I.debug({description:"Applications directory action called.",directoryData:e,application:this,func:"directory",obj:"Application"}),new f({app:this,directoryData:e})}},{key:"appEndpoint",get:function(){return p.endpoint+"/apps/"+this.name}},{key:"Files",get:function(){return I.debug({description:"Applications files action called.",application:this,func:"files",obj:"Application"}),new U({app:this})}},{key:"Users",get:function(){return I.debug({description:"Applications users action called.",
application:this,func:"user",obj:"Application"}),new G({app:this})}},{key:"Accounts",get:function(){return I.debug({description:"Applications account action called.",application:this,func:"user",obj:"Application"}),new G({app:this})}},{key:"Groups",get:function(){return I.debug({description:"Applications groups action called.",application:this,func:"groups",obj:"Application"}),new D({app:this})}},{key:"Directories",get:function(){return I.debug({description:"Applications directories action called.",application:this,func:"directories",obj:"Application"}),new b({app:this})}}]),e}(),R=p.utils.request,W=p.utils.logger,M=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"get",value:function(){return W.debug({description:"Apps get called.",action:this,func:"get",obj:"AppsAction"}),R.get(this.appsEndpoint).then(function(e){return W.info({description:"Apps data loaded successfully.",response:e,func:"get",obj:"AppsAction"}),e})["catch"](function(e){return W.error({description:"Error getting apps data.",error:e,func:"get",obj:"AppsAction"}),Promise.reject(e)})}},{key:"add",value:function(e){return W.debug({description:"Application add called.",appData:e,func:"add",obj:"AppsAction"}),p.utils.request.post(this.appsEndpoint,e).then(function(e){return W.info({description:"Application added successfully.",response:e,func:"add",obj:"AppsAction"}),e})["catch"](function(e){return W.error({description:"Error adding app.",error:e,func:"add",obj:"AppsAction"}),Promise.reject(e)})}},{key:"appsEndpoint",get:function(){return p.endpoint+"/apps"}}]),e}(),$=function(e){function t(){_classCallCheck(this,t),_get(Object.getPrototypeOf(t.prototype),"constructor",this).call(this,u.appName,u.matterOptions)}return _inherits(t,e),_createClass(t,[{key:"App",value:function(e){return this.utils.logger.debug({description:"Application action called.",appName:e,template:new K(e),func:"App",obj:"Grout"}),new K(e)}},{key:"Template",value:function(e){return this.utils.logger.debug({description:"Template Action called.",templateData:e,template:new T(e),func:"Template",obj:"Grout"}),new T(e)}},{key:"Account",value:function(e){return this.utils.logger.debug({description:"Account Action called.",userData:e,user:new E(e),func:"user",obj:"Grout"}),new E(e)}},{key:"User",value:function(e){return this.utils.logger.debug({description:"Account Action called.",userData:e,user:new E(e),func:"user",obj:"Grout"}),new E(e)}},{key:"Group",value:function(e){return this.utils.logger.debug({description:"Group Action called.",groupData:e,action:new m({app:this,groupData:e}),func:"group",obj:"Grout"}),new m(e)}},{key:"Directory",value:function(e){return this.utils.logger.debug({description:"Directory Action called.",directoryData:e,action:new f(e),func:"directory",obj:"Grout"}),new f(e)}},{key:"Apps",get:function(){return this.utils.logger.debug({description:"Apps Action called.",action:new M,func:"Apps",obj:"Grout"}),new M}},{key:"Templates",get:function(){return this.utils.logger.debug({description:"Templates Action called.",action:new _,func:"Templates",obj:"Grout"}),new _}},{key:"Accounts",get:function(){return this.utils.logger.debug({description:"Account Action called.",action:new G,func:"users",obj:"Grout"}),new G}},{key:"Users",get:function(){return this.utils.logger.debug({description:"Accounts Action called.",action:new G,func:"Users",obj:"Grout"}),new G}},{key:"Groups",get:function(){return this.utils.logger.debug({description:"Groups Action called.",action:new D,func:"groups",obj:"Grout"}),new D}},{key:"Directories",get:function(){return this.utils.logger.debug({description:"Directories Action called.",action:new b,func:"directories",obj:"Grout"}),new b}}]),t}(e);return $});
//# sourceMappingURL=grout.min.js.map
