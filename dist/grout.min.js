function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _get=function(e,t,n){for(var r=!0;r;){var i=e,o=t,c=n;r=!1,null===i&&(i=Function.prototype);var a=Object.getOwnPropertyDescriptor(i,o);if(void 0!==a){if("value"in a)return a.value;var s=a.get;if(void 0===s)return;return s.call(c)}var u=Object.getPrototypeOf(i);if(null===u)return;e=u,t=o,n=c,r=!0,a=u=void 0}},_createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("kyper-matter"),require("lodash"),require("firepad"),require("aws-sdk"),require("firebase")):"function"==typeof define&&define.amd?define(["kyper-matter","lodash","firepad","aws-sdk","firebase"],t):e.Grout=t(e.Matter,e._,e.Firepad,e.AWS,e.Firebase)}(this,function(e,t,n,r,i){"use strict";function o(){r.config.update({credentials:new r.CognitoIdentityCredentials({IdentityPoolId:p.aws.cognito.poolId}),region:p.aws.region})}function c(){r.config.update({credentials:new r.CognitoIdentityCredentials({IdentityPoolId:p.aws.cognito.poolId}),region:p.aws.region})}function a(e){var t=e.map(function(e){return s(e)});return u(t)}function s(e){var n;t.has(e,"path")?n=e.path.split("/"):t.has(e,"Key")?(n=e.Key.split("/"),e=t.pick(e,"Key"),e.path=e.Key,e.name=e.Key):console.error("Invalid file.",e);var r=e;if(1==n.length)return r.name=n[0],t.has(r,"type")||(r.type="file"),r.path=n[0],r;var i={};return t.each(n,function(o,c,a){c!=a.length-1?(r.name=o,r.path=t.take(a,c+1).join("/"),r.type="folder",r.children=[{}],0==c&&(i=r),r=r.children[0]):(r.type="file",r.name=o,r.path=n.join("/"),e.$id&&(r.$id=e.$id))}),i}function u(e){var n=[],r=[];return t.each(e,function(i){if(-1==n.indexOf(i.name))n.push(i.name),r.push(i);else{var o=t.findWhere(e,{name:i.name});o.children=t.union(i.children,o.children),o.children=u(o.children)}}),r}e="default"in e?e["default"]:e,t="default"in t?t["default"]:t,n="default"in n?n["default"]:n,r="default"in r?r["default"]:r,i="default"in i?i["default"]:i;var p={serverUrl:"http://tessellate.elasticbeanstalk.com",tokenName:"grout",fbUrl:"https://kyper-tech.firebaseio.com/tessellate",appName:"tessellate",matterOptions:{localServer:!1,logLevel:"trace"},aws:{region:"us-east-1",cognito:{poolId:"us-east-1:72a20ffd-c638-48b0-b234-3312b3e64b2e",params:{AuthRoleArn:"arn:aws:iam::823322155619:role/Cognito_TessellateUnauth_Role",UnauthRoleArn:"arn:aws:iam::823322155619:role/Cognito_TessellateAuth_Role"}}}},l=new e(p.appName,p.matterOptions),d=l.utils.request,f=l.utils.logger,g=function(){function e(n){if(_classCallCheck(this,e),n&&t.isObject(n)&&(t.has(n,"directoryName")||t.has(n,"name")))this.name=n.directoryName||n.name,t.has(n,"appName")&&(this.appName=n.appName);else{if(!n||!t.isString(n))throw f.error({description:"Action data object with name is required to start a Directory Action.",func:"constructor",obj:"Directory"}),new Error("Directory Data object with name is required to start a Directory action.");this.name=n}}return _createClass(e,[{key:"get",value:function(){return d.get(this.directoryEndpoint).then(function(e){return f.info({description:"Directory data loaded successfully.",response:e,func:"get",obj:"Directory"}),e})["catch"](function(e){return f.info({description:"Error getting directory.",error:e,func:"get",obj:"Directory"}),Promise.reject(e)})}},{key:"update",value:function(e){return f.debug({description:"Directory updated called.",directoryData:e,func:"update",obj:"Directory"}),l.utils.request.put(this.directoryEndpoint,e).then(function(t){return f.info({description:"Directory updated successfully.",directoryData:e,response:t,func:"update",obj:"Directory"}),t})["catch"](function(t){return f.error({description:"Error updating directory.",directoryData:e,error:t,func:"update",obj:"Directory"}),Promise.reject(t)})}},{key:"del",value:function(e){return f.debug({description:"Delete directory called.",directoryData:e,func:"del",obj:"Directory"}),d["delete"](this.directoryEndpoint,e).then(function(t){return f.info({description:"Directory deleted successfully.",directoryData:e,func:"del",obj:"Directory"}),t})["catch"](function(e){return f.error({description:"Error deleting directory.",error:e,func:"del",obj:"Directory"}),Promise.reject(e)})}},{key:"directoryEndpoint",get:function(){var e=[l.endpoint,"directories",this.name];t.has(this,"app")&&t.has(this.app,"name")&&e.splice(1,0,"apps",this.app.name);var n=e.join("/");return f.log({description:"Directory endpoint built.",endpoint:n,func:"directoryEndpoint",obj:"Directory"}),n}}]),e}(),h=l.utils.request,b=l.utils.logger,m=function(){function e(n){_classCallCheck(this,e),n&&t.isObject(n)&&t.has(n,"app")?(this.app=n.app,b.log({description:"Provided app data set to app parameter.",action:this,providedData:n,func:"constructor",obj:"DirectoriesAction"})):n&&t.isString(n)&&(this.app={name:n},b.log({description:"App name provided as string was set.",action:this,providedData:n,func:"constructor",obj:"DirectoriesAction"})),b.info({description:"New directories action.",action:this,providedData:n,func:"constructor",obj:"DirectoriesAction"})}return _createClass(e,[{key:"get",value:function(){return b.debug({description:"Directories get called.",action:this,func:"get",obj:"DirectoriesAction"}),h.get(this.directoriesEndpoint).then(function(e){return b.info({descrption:"Directories loaded successfully.",response:e,func:"get",obj:"DirectoriesAction"}),e})["catch"](function(e){return b.error({descrption:"error getting users",error:e,func:"get",obj:"DirectoriesAction"}),Promise.reject(e)})}},{key:"add",value:function(e){return b.debug({description:"Add directory called.",action:this,appData:e,func:"get",obj:"DirectoriesAction"}),h.post(this.directoriesEndpoint,e).then(function(e){return b.log({description:"Application added successfully.",response:e,func:"add",obj:"DirectoriesAction"}),e})["catch"](function(e){return b.error({description:"Error adding group.",error:e,func:"add",obj:"DirectoriesAction"}),Promise.reject(e)})}},{key:"search",value:function(e){var n=this.directoriesEndpoint+"/search/";return e&&t.isString(e)&&(n+=e),e&&""!=e?h.get(n).then(function(e){return b.log({description:"Found directories based on search.",response:e,func:"search",obj:"DirectoriesAction"}),e})["catch"](function(e){return b.error({description:"Error searching directories.",error:e,func:"search",obj:"DirectoriesAction"}),Promise.reject(e)}):(b.debug({description:"Null query, returning empty array.",func:"search",obj:"DirectoriesAction"}),Promise.resolve([]))}},{key:"directoriesEndpoint",get:function(){var e=[l.endpoint,"directories"];t.has(this,"app")&&t.has(this.app,"name")&&e.splice(1,0,"apps",this.app.name);var n=e.join("/");return b.log({description:"Directories endpoint built.",endpoint:n,func:"directoriesEndpoint",obj:"DirectoriesAction"}),n}}]),e}(),j=l.utils.request,y=l.utils.logger,A=function(){function e(n){if(_classCallCheck(this,e),n&&t.isObject(n)&&t.has(n,"groupData"))this.name=t.isObject(n.groupData)?n.groupData.name:n.groupData,t.has(n,"app")&&(this.app=n.app);else{if(!n||!t.isString(n))throw y.error({description:"Action data is required to start a Group Action.",func:"constructor",obj:"Group"}),new Error("Username is required to start an Group");this.name=n}}return _createClass(e,[{key:"get",value:function(){return j.get(this.groupEndpoint).then(function(e){return y.info({description:"Group data loaded successfully.",response:e,func:"get",obj:"Group"}),e})["catch"](function(e){return y.info({description:"Error getting group.",error:e,func:"get",obj:"Group"}),Promise.reject(e.response.text||e.response)})}},{key:"update",value:function(e){return y.log({description:"Group updated called.",groupData:e,func:"update",obj:"Group"}),l.utils.request.put(this.groupEndpoint,e).then(function(t){return y.info({description:"Group updated successfully.",groupData:e,response:t,func:"update",obj:"Group"}),t})["catch"](function(t){return y.error({description:"Error updating group.",groupData:e,error:t,func:"update",obj:"Group"}),Promise.reject(t.response.text||t.response)})}},{key:"del",value:function(e){return y.log({description:"Delete group called.",groupData:e,func:"del",obj:"Group"}),j.del(this.groupEndpoint,{}).then(function(t){return y.info({description:"Group deleted successfully.",groupData:e,func:"del",obj:"Group"}),t})["catch"](function(t){return y.error({description:"Error deleting group.",error:t,text:t.response.text,groupData:e,func:"del",obj:"Group"}),Promise.reject(t.response.text||t.response)})}},{key:"addAccounts",value:function(e){y.log({description:"Group updated called.",accountsData:e,func:"update",obj:"Group"});var n=e;return t.isString(e)&&(n=e.split(",")),t.isString(n[0])?(y.error({description:"Accounts array only currently supports account._id not account.username.",accountsData:e,func:"update",obj:"Group"}),Promise.reject({message:"Accounts array only currently supports account._id not account.username."})):(y.log({description:"Updating group with accounts array.",accountsArray:n,func:"update",obj:"Group"}),this.update({accounts:n}).then(function(e){return y.info({description:"Account(s) added to group successfully.",response:e,func:"addAccounts",obj:"Group"}),e})["catch"](function(e){return y.error({description:"Error addAccountseting group.",error:e,func:"addAccounts",obj:"Group"}),Promise.reject(e.response.text||e.response)}))}},{key:"groupEndpoint",get:function(){var e=[l.endpoint,"groups",this.name];t.has(this,"app")&&t.has(this.app,"name")&&e.splice(1,0,"apps",this.app.name);var n=e.join("/");return y.log({description:"Group Endpoint built.",endpoint:n,func:"groupEndpoint",obj:"Group"}),n}}]),e}(),v=l.utils.request,F=l.utils.logger,k=function(){function e(n){_classCallCheck(this,e),n&&t.isObject(n)&&t.has(n,"app")?(this.app=n.app,F.log({description:"Provided app data set to app parameter.",action:this,providedData:n,func:"constructor",obj:"GroupsAction"})):n&&t.isString(n)&&(this.app={name:n},F.log({description:"App name provided as string was set.",action:this,providedData:n,func:"constructor",obj:"GroupsAction"})),F.info({description:"New Groups action.",action:this,providedData:n,func:"constructor",obj:"GroupsAction"})}return _createClass(e,[{key:"get",value:function(){return F.log({description:"Get group called.",func:"get",obj:"GroupsAction"}),v.get(this.groupsEndpoint).then(function(e){return F.info({description:"Groups loaded successfully.",response:e,func:"get",obj:"GroupsAction"}),e})["catch"](function(e){return F.info({description:"Error getting groups.",error:e,func:"get",obj:"GroupsAction"}),Promise.reject(e)})}},{key:"add",value:function(e){var n=e;return F.debug({description:"Add group called.",groupData:e,func:"add",obj:"GroupsAction"}),t.isString(e)&&(n={name:e}),F.debug({description:"Add group called.",newGroupData:n,func:"add",obj:"GroupsAction"}),v.post(this.groupsEndpoint,n).then(function(e){return F.log({description:"Group added to application successfully.",response:e,func:"add",obj:"GroupsAction"}),e})["catch"](function(e){return F.error({description:"Error adding group.",error:e,func:"add",obj:"GroupsAction"}),Promise.reject(e)})}},{key:"search",value:function(e){if(F.debug({description:"Search groups called.",query:e,func:"search",obj:"GroupsAction"}),!e||""==e||!t.isString(e))return F.log({description:"Null or invalid query, returning empty array.",func:"search",obj:"GroupsAction"}),Promise.resolve([]);var n=this.groupsEndpoint+"/search/"+e;return F.debug({description:"Search endpoint created.",endpoint:n,func:"search",obj:"GroupsAction"}),v.get(n).then(function(e){return F.log({description:"Found groups based on search.",response:e,func:"search",obj:"GroupsAction"}),e})["catch"](function(e){return F.error({description:"Error searching groups.",error:e,func:"search",obj:"GroupsAction"}),Promise.reject(e)})}},{key:"groupsEndpoint",get:function(){var e=[l.endpoint,"groups"];t.has(this,"app")&&t.has(this.app,"name")&&e.splice(1,0,"apps",this.app.name);var n=e.join("/");return F.log({description:"Groups Endpoint built.",endpoint:n,func:"groupsEndpoint",obj:"GroupsAction"}),n}}]),e}(),w=l.utils.request,D=l.utils.logger,E=function(){function e(n){if(_classCallCheck(this,e),n&&t.isObject(n)&&t.has(n,"username"))t.extend(this,n);else{if(!n||!t.isString(n))throw D.error({description:"AccountData is required to start an AccountAction",func:"constructor",obj:"Account"}),new Error("username is required to start an AccountAction");this.username=n}}return _createClass(e,[{key:"get",value:function(){return D.debug({description:"Account data loaded successfully.",func:"get",obj:"Account"}),w.get(this.accountEndpoint).then(function(t){return D.info({description:"Account data loaded successfully.",response:t,func:"get",obj:"Account"}),new e(t)})["catch"](function(e){return D.error({description:"Error getting user.",error:e,func:"get",obj:"Account"}),Promise.reject(e)})}},{key:"update",value:function(t){return D.debug({description:"Update user called.",accountData:t,func:"update",obj:"Account"}),w.put(this.accountEndpoint,t).then(function(t){return D.info({description:"Account updated successfully.",func:"update",obj:"Account"}),new e(t)})["catch"](function(e){return D.error({description:"Error updating user.",func:"update",obj:"Account"}),Promise.reject(e)})}},{key:"del",value:function(t){return D.debug({description:"Delete user called.",func:"del",obj:"Account"}),w.del(this.accountEndpoint,t).then(function(t){return D.info({description:"Delete user successful.",response:t,func:"del",obj:"Account"}),new e(t)})["catch"](function(e){return D.error({description:"Error deleting user.",accountData:t,error:e,func:"del",obj:"Account"}),Promise.reject(e)})}},{key:"accountEndpoint",get:function(){var e=[l.endpoint,"accounts",this.username];t.has(this,"app")&&t.has(this.app,"name")&&e.splice(1,0,"apps",this.app.name);var n=e.join("/");return D.log({description:"Account Endpoint built.",endpoint:n,func:"accountEndpoint",obj:"Account"}),n}}]),e}(),P=l.utils.logger,G=function(){function e(n){_classCallCheck(this,e),n&&t.isObject(n)&&t.has(n,"app")?(this.app=n.app,P.log({description:"Provided app data set to app parameter.",action:this,providedData:n,func:"constructor",obj:"AccountsAction"})):n&&t.isString(n)&&(this.app={name:n},P.log({description:"App name provided as string was set.",action:this,providedData:n,func:"constructor",obj:"AccountsAction"})),P.info({description:"New Accounts action.",action:this,providedData:n,func:"constructor",obj:"AccountsAction"})}return _createClass(e,[{key:"get",value:function(){return P.log({description:"Accounts get called.",func:"get",obj:"AccountsAction"}),l.utils.request.get(this.accountsEndpoint).then(function(e){return P.info({description:"Accounts loaded successfully.",func:"get",obj:"AccountsAction"}),e})["catch"](function(e){return P.info({description:"Error getting accounts.",error:e,func:"get",obj:"AccountsAction"}),Promise.reject(e.message||"Error getting accounts.")})}},{key:"add",value:function(e){return P.info({description:"Account add called.",accountData:e,func:"add",obj:"AccountsAction"}),this.utils.request.post(this.accountsEndpoint,e).then(function(e){return P.info({description:"Account added successfully.",response:e,newAccount:new E(e),func:"add",obj:"AccountsAction"}),new E(e)})["catch"](function(t){return P.error({description:"Account add called.",error:t,accountData:e,func:"add",obj:"AccountsAction"}),Promise.reject(t.message||"Error adding account.")})}},{key:"search",value:function(e){P.log({description:"Accounts search called.",query:e,func:"search",obj:"AccountsAction"});var n=this.accountsEndpoint+"/search/";return e&&t.isString(e)&&(n+=e),e&&""!=e?l.utils.request.get(n).then(function(t){return P.log({description:"Accounts search responded.",response:t,query:e,func:"search",obj:"AccountsAction"}),t})["catch"](function(t){return P.error({description:"Error searching Accounts.",error:t,query:e,func:"search",obj:"AccountsAction"}),Promise.reject(t.message||"Error searching accounts.")}):(P.log({description:"Null query, returning empty array.",func:"search",obj:"AccountsAction"}),Promise.resolve([]))}},{key:"accountsEndpoint",get:function(){var e=[l.endpoint,"accounts"];t.has(this,"app")&&t.has(this.app,"name")&&e.splice(1,0,"apps",this.app.name);var n=e.join("/");return P.log({description:"Accounts Endpoint built.",endpoint:n,func:"accountsEndpoint",obj:"AccountsAction"}),n}}]),e}(),C=l.utils.request,T=l.utils.logger,S=function(){function e(n){if(_classCallCheck(this,e),!n||!t.isString(n))throw T.error({description:"Template data is required to start a Template action.",func:"constructor",obj:"Template"}),new Error("Template data is required to start a Template action.");this.name=n}return _createClass(e,[{key:"get",value:function(){return T.log({description:"Get template called.",name:this.name,func:"get",obj:"Template"}),C.get(this.templateEndpoint).then(function(e){return T.log({description:"Get template responded.",response:e,func:"get",obj:"Template"}),e})["catch"](function(e){return T.error({description:"Error getting template.",error:e,func:"get",obj:"Template"}),Promise.reject(e)})}},{key:"update",value:function(e){return T.log({description:"Update template called.",templateData:e,func:"update",obj:"Template"}),C.put(this.templateEndpoint,e).then(function(t){return T.log({description:"Update template responded.",response:t,templateData:e,func:"update",obj:"Template"}),t})["catch"](function(e){return T.error({description:"Error updating template.",error:e,func:"update",obj:"Template"}),Promise.reject(e)})}},{key:"del",value:function(e){return T.log({description:"Delete template called.",templateData:e,func:"del",obj:"Template"}),C["delete"](this.endpoint,e).then(function(e){return T.log({description:"Template deleted successfully.",response:e,func:"del",obj:"Template"}),e})["catch"](function(e){return T.error({description:"Error deleting template.",error:e,func:"del",obj:"Template"}),Promise.reject(e)})}},{key:"templateEndpoint",get:function(){return l.endpoint+"/templates/"+this.name}}]),e}(),q=l.utils.logger,_=l.utils.request,R=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"get",value:function(){return q.log({description:"Get template called.",func:"get",obj:"TemplatesAction"}),_.get(this.templatesEndpoint).then(function(e){return q.log({description:"Templates loaded.",response:e,func:"get",obj:"TemplatesAction"}),e})["catch"](function(e){return q.error({description:"Error getting templates.",error:e,func:"get",obj:"TemplatesAction"}),Promise.reject(e)})}},{key:"add",value:function(e){return q.log({description:"Add template called.",func:"add",obj:"TemplatesAction"}),_.post(this.templatesEndpoint,e).then(function(e){return q.log({description:"Templates added successfully.",func:"add",obj:"TemplatesAction"}),e})["catch"](function(e){return q.error({description:"Error adding template.",error:e,func:"add",obj:"TemplatesAction"}),Promise.reject(e)})}},{key:"search",value:function(e){q.log({description:"Search template called.",query:e,func:"search",obj:"TemplatesAction"});var n=this.templatesEndpoint+"/search/";return e&&t.isString(e)&&(n+=e),q.log({description:"Search endpoint created.",endpoint:n,func:"search",obj:"TemplatesAction"}),_.get(n).then(function(e){return q.log({description:"Template(s) found successfully.",response:e,endpoint:n,func:"search",obj:"TemplatesAction"}),e})["catch"](function(t){return q.log({description:"Error searching for templates.",query:e,error:t,endpoint:n,func:"search",obj:"TemplatesAction"}),Promise.reject(t)})}},{key:"templatesEndpoint",get:function(){var e=[l.endpoint,"templates"];t.has(this,"app")&&t.has(this.app,"name")&&q.log({description:"Templates action is not currently supported for a specific application.",func:"accountsEndpoint",obj:"AccountsAction"});var n=e.join("/");return q.log({description:"Templates endpoint built.",endpoint:n,func:"templatesEndpoint",obj:"TemplatesAction"}),n}}]),e}(),U=l.utils.logger,O=function(){function e(n){if(_classCallCheck(this,e),!(n&&t.isObject(n)&&t.has(n,"fileData")&&t.has(n,"app")))throw n&&!t.isObject(n)?(U.error({description:"Action data is not an object. Action data must be an object that includes app and fileData.",func:"constructor",obj:"File"}),new Error("File data must be an object that includes path and appName.")):(U.error({description:"File data that includes path and app is needed to create a File action.",func:"constructor",obj:"File"}),new Error("File data with path and app is needed to create file action."));if(t.extend(this,n.fileData),this.app=n.app,!this.path){if(!this.ref)throw U.error({description:"Path or ref required to create file.",func:"constructor",obj:"File"}),new Error("Path or ref required to create file.");this.path=this.pathArrayFromRef.join("/")}this.pathArray=this.path.split("/"),this.name=t.has(n.fileData,"name")?n.fileData.name:this.pathArray[this.pathArray.length-1],this.type="file",U.debug({description:"File object constructed.",file:this,func:"constructor",obj:"File"})}return _createClass(e,[{key:"get",value:function(){var e=this;return new Promise(function(t){var r=new n.headless(e.fbRef);r.getText(function(e){r.dispose(),t(e)})})}},{key:"getFromS3",value:function(){var e=this;if(!this.app||!this.app.frontend)return U.log({description:"Application Frontend data not available. Calling applicaiton get.",func:"get",obj:"File"}),this.app.get().then(function(t){return e.app=t,U.log({description:"Application get successful. Getting file.",app:t,func:"get",obj:"File"}),e.get()},function(e){return U.error({description:"Application Frontend data not available.",error:e,func:"get",obj:"File"}),Promise.reject({message:"Front end data is required to get file."})});var n=function(){"undefined"!=typeof r.config.credentials&&r.config.credentials||(U.log({description:"AWS creds do not exist, so they are being set.",func:"publish",obj:"File"}),o());var n=new r.S3,i={Bucket:e.app.frontend.bucketName,Key:e.path};e.contentType&&(i.ContentType=e.contentType),U.debug({description:"File get params built.",getData:i,file:e,func:"get",obj:"File"});var c=e;return{v:new Promise(function(e,r){n.getObject(i,function(n,i){n?(U.error({description:"Error loading file from S3.",error:n,func:"get",obj:"File"}),r(n)):(U.info({description:"File loaded successfully.",data:i,func:"get",obj:"File"}),t.has(i,"Body")?(U.info({description:"File has content.",content:i.Body.toString(),metaData:i.Metadata.toString(),func:"get",obj:"File"}),c.content=i.Body.toString(),U.info({description:"File content has been added to file.",file:c,func:"get",obj:"File"}),e(c)):e(i))})})}}();return"object"==typeof n?n.v:void 0}},{key:"open",value:function(){return this.get()}},{key:"publish",value:function(e){var n=this;if(U.debug({description:"File publish called.",file:this,fileData:e,func:"publish",obj:"File"}),!this.app.frontend)return U.error({description:"Application Frontend data not available. Make sure to call .get().",func:"publish",obj:"File"}),Promise.reject({message:"Front end data is required to publish file."});var i=function(){if(!t.has(e,["content","path"]))return U.error({description:"File data including path and content required to publish.",func:"publish",obj:"File"}),{v:Promise.reject({message:"File data including path and content required to publish."})};var i={Bucket:n.app.frontend.bucketName,Key:e.path,Body:e.content,ACL:"public-read"};n.contentType&&(i.ContentType=n.contentType),"undefined"!=typeof r.config.credentials&&r.config.credentials||(U.debug({description:"AWS creds do not exist, so they are being set.",func:"publish",obj:"File"}),o());var c=new r.S3;return U.debug({description:"File publish params built.",saveParams:i,fileData:n,func:"publish",obj:"File"}),{v:new Promise(function(e,t){c.putObject(i,function(n,r){n?(U.error({description:"Error saving file to S3.",error:n,func:"publish",obj:"File"}),t(n)):(U.log({description:"File saved successfully.",response:r,func:"publish",obj:"File"}),e(r))})})}}();return"object"==typeof i?i.v:void 0}},{key:"del",value:function(){var e=this;if(!this.app||!this.app.frontend)return U.log({description:"Application Frontend data not available. Calling applicaiton get.",func:"get",obj:"File"}),this.app.get().then(function(t){return e.app=t,U.log({description:"Application get successful. Getting file.",app:t,func:"get",obj:"File"}),e.get()},function(e){return U.error({description:"Application Frontend data not available. Make sure to call .get().",error:e,func:"get",obj:"File"}),Promise.reject({message:"Front end data is required to get file."})});var n=function(){"undefined"!=typeof r.config.credentials&&r.config.credentials||(U.debug({description:"AWS creds do not exist, so they are being set.",func:"publish",obj:"File"}),o());var n=new r.S3,i={Bucket:e.app.frontend.bucketName,Key:e.path};return e.contentType&&(i.ContentType=e.contentType),U.debug({description:"File get params built.",saveParams:i,file:e,func:"get",obj:"File"}),{v:new Promise(function(e,r){n.deleteObject(i,function(n,i){return n?(U.error({description:"Error loading file from S3.",error:n,func:"get",obj:"File"}),r(n)):(U.info({description:"File loaded successfully.",fileData:i,func:"get",obj:"File"}),void(t.has(i,"Body")?(U.info({description:"File has content.",fileData:i.Body.toString(),func:"get",obj:"File"}),e(i.Body.toString())):e(i)))})})}}();return"object"==typeof n?n.v:void 0}},{key:"openInFirepad",value:function(e){var t=this;return new Promise(function(n,r){t.get().then(function(t){U.log({description:"File contents loaded. Opening firepad.",editor:e,file:t,func:"openInFirepad",obj:"File"});var r=t.firepadFromAce(e);r.on("ready",function(){n(t)})},function(t){U.error({description:"Valid ace editor instance required to create firepad.",func:"openInFirepad",obj:"File",editor:e}),r(t)})})}},{key:"firepadFromAce",value:function(e){if(!e||"function"!=typeof e.setTheme)return void U.error({description:"Valid ace editor instance required to create firepad.",func:"fbRef",obj:"File",editor:e});if("function"!=typeof n.fromACE)return void U.error({description:"Firepad does not have fromACE method.",firepad:n,func:"fbRef",obj:"File"});var t={};return this.content&&(t.defaultText=this.content),l.isLoggedIn&&l.currentUser&&(t.userId=l.currentUser.username||l.currentUser.name),U.log({description:"Creating firepad from ace.",settings:t,func:"fbRef",obj:"File"}),n.fromACE(this.fbRef,e,t)}},{key:"getConnectedUsers",value:function(){var e=this;return new Promise(function(t,n){e.fbRef.child("users").on("value",function(e){null===e.val()?t([]):!function(){var n=[];e.forEach(function(e){var t=e.val();t.username=e.key(),n.push(t)}),U.log({description:"Connected users array built.",users:n,func:"connectedUsers",obj:"File"}),t(n)}()},function(e){U.error({description:"Error loading connected users.",error:e,func:"connectedUsers",obj:"File"}),n(e)})})}},{key:"getDefaultContent",value:function(){}},{key:"pathArrayFromRef",get:function(){return this.fbRef||U.error({description:"File fbRef is required to get path array.",file:this,func:"pathArrayFromRef",obj:"File"}),this.fbRef.path.o}},{key:"fileType",get:function(){return"js"==this.ext?"javascript":this.ext}},{key:"ext",get:function(){var e=/(?:\.([^.]+))?$/;return e.exec(this.name)[1]}},{key:"safePathArray",get:function(){var e=this.pathArray.map(function(e){return e.replace(/[.]/g,":").replace(/[#$\[\]]/g,"--")});return U.log({description:"Safe path array created.",safeArray:e,func:"safePathArray",obj:"File"}),e}},{key:"safePath",get:function(){return this.safePathArray.join("/")}},{key:"fbUrl",get:function(){var e=[p.fbUrl,"files",this.app.name,this.safePath].join("/");return U.log({description:"File ref url generated",url:e,func:"fbRef",obj:"File"}),e}},{key:"fbRef",get:function(){return this.ref?(U.log({description:"File already has reference.",ref:this.ref,func:"fbRef",obj:"File"}),this.ref):(U.log({description:"Fb ref generatating.",url:this.fbUrl,func:"fbRef",obj:"File"}),new i(this.fbUrl))}},{key:"headless",get:function(){return new n.Headless(this.fbRef)}}]),e}(),x=l.utils.logger,N=function(){function e(n){if(_classCallCheck(this,e),n&&t.isObject(n)&&t.has(n,"app"))this.app=n.app;else{if(!n||!t.isString(n))throw n&&t.isArray(n)?(x.error({description:"Action data object with name is required to start a Files Action.",func:"constructor",obj:"Files"}),new Error("Files Data object with application is required to start a Files action.")):(x.error({description:"Action data object with name is required to start a Files Action.",func:"constructor",obj:"Files"}),new Error("Files Data object with name is required to start a Files action."));this.app={name:n}}x.debug({description:"Files object constructed.",func:"constructor",obj:"Files"})}return _createClass(e,[{key:"get",value:function(){var e=this;return console.warn(this.pathArrayFromFbRef),x.log({description:"Files get called.",func:"get",obj:"Files"}),new Promise(function(t){e.fbRef.once("value",function(e){x.warn({description:"Files loaded from firebase.",val:e.val(),func:"get",obj:"Files"});var n=[];e.forEach(function(e){var t=e.hasChild("meta")?e.child("meta").val():{path:e.key()};t.key=e.key(),n.push(t)}),x.warn({description:"Files array built.",val:n,func:"get",obj:"Files"}),t(n)})})}},{key:"getFromS3",value:function(){var e=this;if(!this.app.frontend||!this.app.frontend.bucketName)return x.warn({description:"Application Frontend data not available. Calling .get().",app:this.app,func:"getFromS3",obj:"Files"}),this.app.get().then(function(n){return x.log({description:"Application get returned.",data:n,func:"getFromS3",obj:"Files"}),e.app=n,t.has(n,"frontend")?e.get():(x.error({description:"Application does not have Frontend to get files from.",func:"getFromS3",obj:"Files"}),Promise.reject({message:"Application does not have frontend to get files from."}))},function(e){return x.error({description:"Application Frontend data not available. Make sure to call .get().",error:e,func:"getFromS3",obj:"Files"}),Promise.reject({message:"Bucket name required to get objects"})});var n=function(){"undefined"!=typeof r.config.credentials&&r.config.credentials||c();var t=new r.S3,n={Bucket:e.app.frontend.bucketName};return{v:new Promise(function(e,r){t.listObjects(n,function(t,n){return t?(x.error({description:"Error getting files from S3.",error:t,func:"get",obj:"Files"}),r(t)):(x.info({description:"Files list loaded.",filesData:n,func:"get",obj:"Files"}),e(n.Contents))})})}}();return"object"==typeof n?n.v:void 0}},{key:"add",value:function(e){return this.addToFb(e)}},{key:"del",value:function(e){return this.delFromFb(e)}},{key:"addToFb",value:function(e){if(!e||!e.path)return x.error({description:"Invalid file data. Path must be included.",func:"addToFb",obj:"Files"}),Promise.reject({message:"Invalid file data. Path must be included."});var t=new O({app:this.app,fileData:e});return new Promise(function(n,r){t.fbRef.set({meta:{path:t.path}},function(t){t?(x.error({description:"Error creating file on Firebase.",error:t,func:"addToFb",obj:"Files"}),r(t)):(x.error({description:"File successfully added to Firebase.",func:"addToFb",obj:"Files"}),n(e))})})}},{key:"delFromFb",value:function(e){if(!e||!e.path)return x.error({description:"Invalid file data. Path must be included.",func:"delFromFb",obj:"Files"}),Promise.reject({message:"Invalid file data. Path must be included."});var t=new O({app:this.app,fileData:e
});return new Promise(function(n,r){t.fbRef.remove(e,function(t){t?r(t):n(e)})})}},{key:"publish",value:function(){}},{key:"buildStructure",value:function(){return x.debug({description:"Build Structure called.",func:"buildStructure",obj:"Application"}),this.get().then(function(e){x.log({description:"Child struct from array.",childStructure:t,func:"buildStructure",obj:"Application"});var t=a(e);return x.log({description:"Child struct from array.",childStructure:t,func:"buildStructure",obj:"Application"}),t},function(e){return x.error({description:"Error getting application files.",error:e,func:"buildStructure",obj:"Application"}),Promise.reject({message:"Error getting files.",error:e})})}},{key:"fbUrl",get:function(){return p.fbUrl+"/files/"+this.app.name}},{key:"fbRef",get:function(){return x.log({description:"Url created for files fbRef.",url:this.fbUrl,func:"fbRef",obj:"Files"}),new i(this.fbUrl)}},{key:"pathArrayFromFbRef",get:function(){var e=p.fbUrl.replace("https://","").split("/");e.shift(),x.warn({description:"Remove array started.",removeArray:e,fbRefArray:this.fbRef.path.o,func:"fbRef",obj:"Files"});var t=this.fbRef.path.o.splice(0,e.length);return x.warn({description:"Path array built.",pathArray:t,func:"fbRef",obj:"Files"}),t}}]),e}(),I=l.utils.request,B=l.utils.logger,K=function(){function e(n){_classCallCheck(this,e),n&&t.isObject(n)?t.extend(this,n):n&&t.isString(n)&&(this.name=n),i&&t.has(p,"fbUrl")&&t.has(this,"name")&&(this.fbUrl=p.fbUrl+"/"+this.name,this.fbRef=new i(this.fbUrl))}return _createClass(e,[{key:"get",value:function(){return B.debug({description:"Application get called.",func:"get",obj:"Application"}),I.get(this.appEndpoint).then(function(t){return B.info({description:"Application loaded successfully.",response:t,application:new e(t),func:"get",obj:"Application"}),new e(t)})["catch"](function(e){return B.error({description:"Error getting Application.",message:e.response.text,error:e,func:"get",obj:"Application"}),Promise.reject(e.response.text||e.response)})}},{key:"update",value:function(t){return B.debug({description:"Application update called.",func:"update",obj:"Application"}),I.put(this.appEndpoint,t).then(function(t){return B.info({description:"Application updated successfully.",response:t,func:"update",obj:"Application"}),new e(t)})["catch"](function(e){return B.error({description:"Error updating application.",error:e,func:"update",obj:"Application"}),Promise.reject(e.response.text||e.response)})}},{key:"addStorage",value:function(){return B.debug({description:"Application add storage called.",application:this,func:"addStorage",obj:"Application"}),I.post(this.appEndpoint+"/storage",{}).then(function(t){return B.info({description:"Storage successfully added to application.",response:t,application:new e(t),func:"addStorage",obj:"Application"}),new e(t)})["catch"](function(e){return B.error({description:"Error adding storage to application.",error:e,func:"addStorage",obj:"Application"}),Promise.reject(e.response.text||e.response)})}},{key:"applyTemplate",value:function(){var t=this;return B.error({description:"Applying templates to existing applications is not currently supported.",func:"applyTemplate",obj:"Application"}),I.post(this.appEndpoint,{}).then(function(n){return B.info({description:"Template successfully applied to application.",response:n,application:t,func:"applyTemplate",obj:"Application"}),new e(n)})["catch"](function(e){return B.error({description:"Error applying template to application.",error:e,application:t,func:"applyTemplate",obj:"Application"}),Promise.reject(e.response.text||e.response)})}},{key:"File",value:function(e){return B.debug({description:"Applications file action called.",fileData:e,application:this,func:"file",obj:"Application"}),new O({app:this,fileData:e})}},{key:"User",value:function(e){return B.debug({description:"Applications user action called.",userData:e,application:this,func:"user",obj:"Application"}),new E({app:this,userData:e})}},{key:"Account",value:function(e){return B.debug({description:"Applications account action called.",userData:e,application:this,func:"user",obj:"Application"}),new E({app:this,userData:e})}},{key:"Group",value:function(e){return B.debug({description:"Applications group action called.",groupData:e,application:this,func:"group",obj:"Application"}),new A({app:this,groupData:e})}},{key:"Directory",value:function(e){return B.debug({description:"Applications directory action called.",directoryData:e,application:this,func:"directory",obj:"Application"}),new g({app:this,directoryData:e})}},{key:"appEndpoint",get:function(){return l.endpoint+"/apps/"+this.name}},{key:"Files",get:function(){return B.debug({description:"Applications files action called.",application:this,func:"files",obj:"Application"}),new N({app:this})}},{key:"Users",get:function(){return B.debug({description:"Applications users action called.",application:this,func:"user",obj:"Application"}),new G({app:this})}},{key:"Accounts",get:function(){return B.debug({description:"Applications account action called.",application:this,func:"user",obj:"Application"}),new G({app:this})}},{key:"Groups",get:function(){return B.debug({description:"Applications groups action called.",application:this,func:"groups",obj:"Application"}),new k({app:this})}},{key:"Directories",get:function(){return B.debug({description:"Applications directories action called.",application:this,func:"directories",obj:"Application"}),new m({app:this})}}]),e}(),M=l.utils.request,W=l.utils.logger,$=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"get",value:function(){return W.debug({description:"Apps get called.",action:this,func:"get",obj:"AppsAction"}),M.get(this.appsEndpoint).then(function(e){return W.info({description:"Apps data loaded successfully.",response:e,func:"get",obj:"AppsAction"}),e})["catch"](function(e){return W.error({description:"Error getting apps data.",error:e,func:"get",obj:"AppsAction"}),Promise.reject(e)})}},{key:"add",value:function(e){return W.debug({description:"Application add called.",appData:e,func:"add",obj:"AppsAction"}),l.utils.request.post(this.appsEndpoint,e).then(function(e){return W.info({description:"Application added successfully.",response:e,func:"add",obj:"AppsAction"}),e})["catch"](function(e){return W.error({description:"Error adding app.",error:e,func:"add",obj:"AppsAction"}),Promise.reject(e)})}},{key:"appsEndpoint",get:function(){return l.endpoint+"/apps"}}]),e}(),L=function(e){function t(){_classCallCheck(this,t),_get(Object.getPrototypeOf(t.prototype),"constructor",this).call(this,p.appName,p.matterOptions)}return _inherits(t,e),_createClass(t,[{key:"App",value:function(e){return this.utils.logger.debug({description:"Application action called.",appName:e,template:new K(e),func:"App",obj:"Grout"}),new K(e)}},{key:"Template",value:function(e){return this.utils.logger.debug({description:"Template Action called.",templateData:e,template:new S(e),func:"Template",obj:"Grout"}),new S(e)}},{key:"Account",value:function(e){return this.utils.logger.debug({description:"Account Action called.",userData:e,user:new E(e),func:"user",obj:"Grout"}),new E(e)}},{key:"User",value:function(e){return this.utils.logger.debug({description:"Account Action called.",userData:e,user:new E(e),func:"user",obj:"Grout"}),new E(e)}},{key:"Group",value:function(e){return this.utils.logger.debug({description:"Group Action called.",groupData:e,action:new A({app:this,groupData:e}),func:"group",obj:"Grout"}),new A(e)}},{key:"Directory",value:function(e){return this.utils.logger.debug({description:"Directory Action called.",directoryData:e,action:new g(e),func:"directory",obj:"Grout"}),new g(e)}},{key:"Apps",get:function(){return this.utils.logger.debug({description:"Apps Action called.",action:new $,func:"Apps",obj:"Grout"}),new $}},{key:"Templates",get:function(){return this.utils.logger.debug({description:"Templates Action called.",action:new R,func:"Templates",obj:"Grout"}),new R}},{key:"Accounts",get:function(){return this.utils.logger.debug({description:"Account Action called.",action:new G,func:"users",obj:"Grout"}),new G}},{key:"Users",get:function(){return this.utils.logger.debug({description:"Accounts Action called.",action:new G,func:"Users",obj:"Grout"}),new G}},{key:"Groups",get:function(){return this.utils.logger.debug({description:"Groups Action called.",action:new k,func:"groups",obj:"Grout"}),new k}},{key:"Directories",get:function(){return this.utils.logger.debug({description:"Directories Action called.",action:new m,func:"directories",obj:"Grout"}),new m}}]),t}(e);return L});
//# sourceMappingURL=grout.min.js.map
