{"version":3,"sources":["grout.min.js","/source/grout.js"],"names":["_inherits","subClass","superClass","TypeError","prototype","Object","create","constructor","value","enumerable","writable","configurable","setPrototypeOf","__proto__","_classCallCheck","instance","Constructor","_get","_x","_x2","_x3","_again","object","property","receiver","desc","parent","getter","undefined","Function","getOwnPropertyDescriptor","get","call","getPrototypeOf","_createClass","defineProperties","target","props","i","length","descriptor","defineProperty","key","protoProps","staticProps","global","factory","exports","module","require","define","amd","Grout","_","Firebase","jwtDecode","superagent","this","buildMessageArgs","logData","msgStr","msgObj","isObject","has","obj","func","file","each","omit","keys","ind","list","isString","msg","decodeToken","tokenStr","tokenData","err","logger","error","description","data","Error","handleResponse","req","Promise","resolve","reject","end","res","status","warn","body","addAuthHeader","token","string","set","info","message","setAWSConfig","AWS","config","update","credentials","CognitoIdentityCredentials","IdentityPoolId","aws","cognito","poolId","region","childrenStructureFromArray","fileArray","mappedStructure","map","buildStructureObject","combineLikeObjs","pathArray","path","split","Key","pick","name","currentObj","type","finalObj","loc","first","join","children","$id","mappedArray","takenNames","finishedArray","indexOf","push","likeObj","findWhere","union","_config","serverUrl","tokenName","tokenDataName","log","msgArgs","envName","console","apply","debug","storage","item","itemName","itemValue","setItem","localExists","JSON","stringify","window","sessionStorage","getItem","itemStr","isObj","itemObj","parse","removeItem","clear","testKey","save","delete","request","endpoint","queryData","query","post","send","put","del","Matter","appName","opts","options","signupData","then","response","account","errRes","loginData","_this","password","username","text","_this2","_this3","resove","responseData","currentUser","updateData","_this4","isLoggedIn","checkGroups","_this5","isArray","isInGroups","_ret","groupName","groupsArray","v","groups","group","userGroups","any","_this6","isInGroup","localServer","url","location","host","userData","user","fbUrl","matterOptions","params","AuthRoleArn","UnauthRoleArn","_Application","_Matter","appData","owner","collaborators","createdAt","updatedAt","frontend","backend","fbRef","getFiles","filesArray","childStruct","bucketName","s3","S3","listParams","Bucket","listObjects","Contents","fileData","saveParams","frontent","Body","content","ACL","contentType","ContentType","putObject","utils","AppAction","_Matter2","appEndpoint","app","getStructure","structure","AppsAction","_Matter3","appsEndpoint","Application","User","UserAction","_Matter4","userName","userEndpoint","UsersAction","_Matter5","usersEndpoint","searchEndpoint","_Matter6"],"mappings":"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","file":"grout.min.js","sourcesContent":["function _inherits(e,t){if(\"function\"!=typeof t&&null!==t)throw new TypeError(\"Super expression must either be null or a function, not \"+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError(\"Cannot call a class as a function\")}var _get=function(e,t,r){for(var n=!0;n;){var o=e,i=t,s=r;a=c=u=void 0,n=!1,null===o&&(o=Function.prototype);var a=Object.getOwnPropertyDescriptor(o,i);if(void 0!==a){if(\"value\"in a)return a.value;var u=a.get;return void 0===u?void 0:u.call(s)}var c=Object.getPrototypeOf(o);if(null===c)return void 0;e=c,t=i,r=s,n=!0}},_createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,\"value\"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();!function(e,t){\"object\"==typeof exports&&\"undefined\"!=typeof module?module.exports=t(require(\"lodash\"),require(\"firebase\"),require(\"jwt-decode\"),require(\"superagent\")):\"function\"==typeof define&&define.amd?define([\"lodash\",\"firebase\",\"jwt-decode\",\"superagent\"],t):e.Grout=t(e._,e.Firebase,e.jwtDecode,e.superagent)}(this,function(e,t,r,n){\"use strict\";function o(t){var r=\"\",n={};e.isObject(t)?(e.has(t,\"func\")&&(r+=e.has(t,\"obj\")?\"[\"+t.obj+\".\"+t.func+\"()] \":e.has(t,\"file\")?\"[\"+t.file+\" > \"+t.func+\"()] \":\"[\"+t.func+\"()] \"),e.each(e.omit(e.keys(t)),function(o,i,s){\"func\"!=o&&\"obj\"!=o&&(\"description\"==o||\"message\"==o?r+=t[o]:n[o]=e.isString(t[o])?t[o]:t[o])}),r+=\"\\n\"):e.isString(t)&&(r=t);var o=[r,n];return o}function i(e){var t=void 0;if(e&&\"\"!=e)try{t=r(e)}catch(n){throw d.error({description:\"Error decoding token.\",data:t,error:n,func:\"decodeToken\",file:\"token\"}),new Error(\"Invalid token string.\")}return t}function s(e){return new Promise(function(t,r){e.end(function(e,n){return e?(401==e.status&&d.warn(\"Unauthorized. You must be signed into make this request.\"),r(e)):t(n.body)})})}function a(e){return m.string&&(e=e.set(\"Authorization\",\"Bearer \"+m.string),d.info({message:\"Set auth header\",func:\"addAuthHeader\",file:\"request\"})),e}function u(){AWS.config.update({credentials:new AWS.CognitoIdentityCredentials({IdentityPoolId:b.aws.cognito.poolId}),region:b.aws.region})}function c(e){var t=e.map(function(e){return l(e)});return p(t)}function l(t){var r;e.has(t,\"path\")?r=t.path.split(\"/\"):(r=t.Key.split(\"/\"),t=e.pick(t,\"Key\"),t.path=t.Key,t.name=t.Key);var n=t;if(1==r.length)return n.name=r[0],e.has(n,\"type\")||(n.type=\"file\"),n.path=r[0],n;var o={};return e.each(r,function(i,s,a){s!=a.length-1?(n.name=i,n.path=e.first(a,s+1).join(\"/\"),n.type=\"folder\",n.children=[{}],0==s&&(o=n),n=n.children[0]):(n.type=\"file\",n.name=i,n.path=r.join(\"/\"),t.$id&&(n.$id=t.$id))}),o}function p(t){var r=[],n=[];return e.each(t,function(o,i,s){if(-1==r.indexOf(o.name))r.push(o.name),n.push(o);else{var a=e.findWhere(t,{name:o.name});a.children=e.union(o.children,a.children),a.children=p(a.children)}}),n}e=\"default\"in e?e[\"default\"]:e,t=\"default\"in t?t[\"default\"]:t,r=\"default\"in r?r[\"default\"]:r,n=\"default\"in n?n[\"default\"]:n;var f={serverUrl:\"http://tessellate.elasticbeanstalk.com\",tokenName:\"tessellate\",tokenDataName:\"tessellate-tokenData\"},d={log:function(e){var t=o(e);\"local\"==f.envName?console.log(e):console.log.apply(console,t)},info:function(e){var t=o(e);\"local\"==f.envName?console.info(e):console.info.apply(console,t)},warn:function(e){var t=o(e);\"local\"==f.envName?console.warn(e):console.warn.apply(console,t)},debug:function(e){var t=o(e);\"local\"==f.envName?console.log(e):console.log.apply(console,t)},error:function(e){var t=o(e);\"local\"==f.envName?console.error(e):console.error.apply(console,t)}},g={},h=Object.defineProperties({item:function(e,t){return this.setItem(e,t)},setItem:function(t,r){g[t]=r,this.localExists&&(e.isObject(r)&&(r=JSON.stringify(r)),window.sessionStorage.setItem(t,r))},getItem:function(e){if(g[e])return g[e];if(this.localExists){var t=window.sessionStorage.getItem(e);if(t){var r=!1,n=null;try{n=JSON.parse(t),r=!0}catch(o){r=!1}if(r)return n}return t}return null},removeItem:function(e){if(g[e]&&(g[e]=null),this.localExists)try{window.sessionStorage.removeItem(e)}catch(t){d.error({description:\"Error removing item from session storage\",error:t,obj:\"storage\",func:\"removeItem\"})}},clear:function(){if(g={},this.localExists)try{window.sessionStorage.clear()}catch(e){d.warn(\"Session storage could not be cleared.\",e)}}},{localExists:{get:function(){var e=\"test\";if(\"undefined\"==typeof window||\"undefined\"==typeof window.sessionStorage)return!1;try{return window.sessionStorage.setItem(e,\"1\"),window.sessionStorage.removeItem(e),!0}catch(t){return d.error({description:\"Error saving to session storage\",error:t,obj:\"storage\",func:\"localExists\"}),!1}},configurable:!0,enumerable:!0}}),m=Object.defineProperties({save:function(e){this.string=e},\"delete\":function(){h.removeItem(f.tokenName),h.removeItem(f.tokenDataName),d.log({description:\"Token was removed.\",func:\"delete\",obj:\"token\"})}},{string:{get:function(){return h.getItem(f.tokenName)},set:function(e){d.log({description:\"Token was set.\",token:e,func:\"string\",obj:\"token\"}),this.data=r(e),h.setItem(f.tokenName,e)},configurable:!0,enumerable:!0},data:{get:function(){return h.getItem(f.tokenDataName)?h.getItem(f.tokenDataName):i(this.string)},set:function(t){if(e.isString(t)){var r=t;t=i(r),d.info({description:\"Token data was set as string. Decoding token.\",token:r,tokenData:t,func:\"data\",obj:\"token\"})}else d.log({description:\"Token data was set.\",data:t,func:\"data\",obj:\"token\"}),h.setItem(f.tokenDataName,t)},configurable:!0,enumerable:!0}}),v={get:function(e,t){var r=n.get(e);return t&&r.query(t),r=a(r),s(r)},post:function(e,t){var r=n.post(e).send(t);return r=a(r),s(r)},put:function(e,t){var r=n.put(e).send(t);return r=a(r),s(r)},del:function(e,t){var r=n.put(e).send(t);return r=a(r),s(r)}},y=function(){function t(e,r){if(_classCallCheck(this,t),!e)throw d.error({description:\"Application name requires to use Matter.\",func:\"constructor\",obj:\"Matter\"}),new Error(\"Application name is required to use Matter\");this.name=e,r&&(this.options=r)}return _createClass(t,[{key:\"signup\",value:function(t){return v.post(this.endpoint+\"/signup\",t).then(function(r){return d.log({description:\"Account request successful.\",signupData:t,response:r,func:\"signup\",obj:\"Matter\"}),e.has(r,\"account\")?r.account:(d.warn({description:\"Account was not contained in signup response.\",signupData:t,response:r,func:\"signup\",obj:\"Matter\"}),r)})[\"catch\"](function(e){return d.error({description:\"Error requesting signup.\",signupData:t,error:e,func:\"signup\",obj:\"Matter\"}),Promise.reject(e)})}},{key:\"login\",value:function(t){var r=this;return t&&t.password&&t.username?v.put(this.endpoint+\"/login\",t).then(function(t){return e.has(t,\"data\")&&e.has(t.data,\"status\")&&409==t.data.status?(d.warn({description:\"Account not found.\",response:t,func:\"login\",obj:\"Matter\"}),Promise.reject(t.data)):(d.log({description:\"Successful login.\",response:t,func:\"login\",obj:\"Matter\"}),e.has(t,\"token\")&&(r.token.string=t.token),e.has(t,\"account\")&&r.storage.setItem(\"currentUser\",t.account),t.account)})[\"catch\"](function(e){return d.error({description:\"Error requesting login.\",error:e,status:e.status,func:\"login\",obj:\"Matter\"}),(409==e.status||400==e.status)&&(e=e.response.text),Promise.reject(e)}):(d.error({description:\"Username/Email and Password are required to login\",func:\"login\",obj:\"Matter\"}),Promise.reject({message:\"Username/Email and Password are required to login\"}))}},{key:\"logout\",value:function(){var e=this;return v.put(this.endpoint+\"/logout\").then(function(t){return d.log({description:\"Logout successful.\",response:t,func:\"logout\",obj:\"Matter\"}),e.storage.removeItem(\"currentUser\"),e.token[\"delete\"](),t})[\"catch\"](function(t){return d.error({description:\"Error requesting log out: \",error:t,func:\"logout\",obj:\"Matter\"}),e.storage.removeItem(\"currentUser\"),e.token[\"delete\"](),Promise.reject(t)})}},{key:\"getCurrentUser\",value:function(){var e=this;return this.storage.item(\"currentUser\")?Promise.resove(this.storage.item(\"currentUser\")):v.get(this.endpoint+\"/user\").then(function(t){return d.log({description:\"Current User Request responded.\",responseData:t.data,func:\"currentUser\",obj:\"Matter\"}),e.currentUser=t.data,t.data})[\"catch\"](function(e){return d.error({description:\"Error requesting current user.\",error:e,func:\"currentUser\",obj:\"Matter\"}),Promise.reject(e)})}},{key:\"updateProfile\",value:function(e){var t=this;return this.isLoggedIn?(d.warn({description:\"Calling update endpoint.\",endpoint:this.endpoint+\"/user/\"+this.token.data.username,func:\"updateProfile\",obj:\"Matter\"}),v.put(this.endpoint+\"/user/\"+this.token.data.username,e).then(function(e){return d.log({description:\"Update profile request responded.\",responseData:e,func:\"updateProfile\",obj:\"Matter\"}),t.currentUser=e,e})[\"catch\"](function(e){return d.error({description:\"Error requesting current user.\",error:e,func:\"updateProfile\",obj:\"Matter\"}),Promise.reject(e)})):(d.error({description:\"No current user profile to update.\",func:\"updateProfile\",obj:\"Matter\"}),Promise.reject({message:\"Must be logged in to update profile.\"}))}},{key:\"isInGroup\",value:function(t){var r=this;if(!this.isLoggedIn)return d.log({description:\"No logged in user to check.\",func:\"isInGroup\",obj:\"Matter\"}),!1;if(!t||!e.isString(t))return t&&e.isArray(t)?(d.info({description:\"Array of groups.\",list:t,func:\"isInGroup\",obj:\"Matter\"}),this.isInGroups(t)):!1;var n=function(){var n=t,o=n.split(\",\");if(o.length>1)return d.info({description:\"String list of groups.\",list:o,func:\"isInGroup\",obj:\"Matter\"}),{v:r.isInGroups(o)};var i=r.token.data.groups||[];return d.log({description:\"Checking if user is in group.\",group:n,userGroups:r.token.data.groups||[],func:\"isInGroup\",obj:\"Matter\"}),{v:e.any(i,function(e){return n==e.name})}}();return\"object\"==typeof n?n.v:void 0}},{key:\"isInGroups\",value:function(t){var r=this;if(t&&e.isArray(t))return e.map(t,function(t){return r.isInGroup(e.isString(t)?t:t.name)});if(t&&e.isString(t)){var n=t.split(\",\");return n.length>1?this.isInGroups(n):this.isInGroup(n[0])}d.error({description:\"Invalid groups list.\",func:\"isInGroups\",obj:\"Matter\"})}},{key:\"endpoint\",get:function(){var t=f.serverUrl;return e.has(this,\"options\")&&this.options.localServer&&(t=\"http://localhost:4000\",d.info({description:\"LocalServer option was set to true. Now server url is local server.\",url:t,func:\"endpoint\",obj:\"Matter\"})),\"tessellate\"==this.name?window&&e.has(window,\"location\")&&window.location.host==t&&(t=\"\",d.info({description:\"Host is Server, serverUrl simplified!\",url:t,func:\"endpoint\",obj:\"Matter\"})):(t=f.serverUrl+\"/apps/\"+this.name,d.info({description:\"Server url set.\",url:t,func:\"endpoint\",obj:\"Matter\"})),t}},{key:\"currentUser\",set:function(e){d.log({description:\"Current User Request responded.\",user:e,func:\"currentUser\",obj:\"Matter\"}),this.storage.setItem(e)},get:function(){return this.storage.getItem(\"currentUser\")?this.storage.getItem(\"currentUser\"):null}},{key:\"storage\",get:function(){return h}},{key:\"token\",get:function(){return m}},{key:\"utils\",get:function(){return{logger:d,request:v,storage:h}}},{key:\"isLoggedIn\",get:function(){return this.token.string?!0:!1}}]),t}(),b={serverUrl:\"http://tessellate.elasticbeanstalk.com\",tokenName:\"grout\",fbUrl:\"https://pruvit.firebaseio.com/\",appName:\"tessellate\",matterOptions:{localServer:!0},aws:{region:\"us-east-1\",cognito:{poolId:\"us-east-1:72a20ffd-c638-48b0-b234-3312b3e64b2e\",params:{AuthRoleArn:\"arn:aws:iam::823322155619:role/Cognito_TessellateUnauth_Role\",UnauthRoleArn:\"arn:aws:iam::823322155619:role/Cognito_TessellateAuth_Role\"}}}},k=function(e){function r(e){_classCallCheck(this,r),_get(Object.getPrototypeOf(r.prototype),\"constructor\",this).call(this,b.appName,b.matterOptions),this.name=e.name,this.owner=e.owner||null,this.collaborators=e.collaborators||[],this.createdAt=e.createdAt,this.updatedAt=e.updatedAt,this.frontend=e.frontend||{},this.backend=e.backend||{},t&&(this.fbRef=new t(b.fbUrl+e.name))}return _inherits(r,e),_createClass(r,[{key:\"getStructure\",value:function(){return this.getFiles().then(function(e){var t=c(e);return console.log(\"Child struct from array:\",t),t},function(e){return console.error(\"[Application.getStructure] Error getting files: \",e),Promise.reject({message:\"Error getting files.\",error:e})})}},{key:\"getFiles\",value:function(){if(this.frontend&&this.frontend.bucketName){\"undefined\"!=typeof AWS.config.credentials&&AWS.config.credentials||u();var e=new AWS.S3,t={Bucket:this.frontend.bucketName};return new Promise(function(r,n){e.listObjects(t,function(e,t){return e?(console.error(\"[Application.getObjects()] Error listing objects:\",e),n(e)):(console.log(\"[Application.getObjects()] listObjects returned:\",t),r(t.Contents))})})}return console.error(\"[Applicaiton.getFiles] Attempting to get objects for bucket without name.\"),Promise.reject({message:\"Bucket name required to get objects\"})}},{key:\"publishFile\",value:function(e){if(!this.frontend)return console.error(\"Frontend data not available. Make sure to call .get().\"),Promise.reject({message:\"Front end data is required to publish file.\"});var t={Bucket:this.frontent.bucketName,Key:e.key,Body:e.content,ACL:\"public-read\"};return e.contentType&&(t.ContentType=e.contentType),s3.putObject(t,function(e,t){return e?(console.error(\"[Application.publishFile()] Error saving file:\",e),Promise.reject(e)):(console.log(\"[Application.publishFile()] file saved successfully. Returning:\",t),t)})}},{key:\"addStorage\",value:function(){var e=b.serverUrl+\"/apps/\"+this.name+\"/storage\";return this.utils.request.post(e,appData).then(function(e){return console.log(\"[Application.addStorage()] Apps:\",e),new r(e)})[\"catch\"](function(e){return console.error(\"[Application.addStorage()] Error getting apps list: \",e),Promise.reject(e)})}},{key:\"applyTemplate\",value:function(){b.serverUrl+\"/apps/\"+this.name+\"/template\";console.log(\"Applying templates to existing\")}}]),r}(y),j=function(e){function t(e){if(_classCallCheck(this,t),_get(Object.getPrototypeOf(t.prototype),\"constructor\",this).call(this,b.appName,b.matterOptions),!e)throw console.error(\"Application name is required to start an AppAction\"),new Error(\"Application name is required to start an AppAction\");this.name=e}return _inherits(t,e),_createClass(t,[{key:\"get\",value:function(){return this.utils.request.get(this.appEndpoint).then(function(e){return console.log(\"[MatterClient.app().get()] App(s) data loaded:\",e),new k(e)})[\"catch\"](function(e){return console.error(\"[MatterClient.app().get()] Error getting apps list: \",e),Promise.reject(e)})}},{key:\"update\",value:function(e){return this.utils.request.put(this.appEndpoint,e).then(function(e){return console.log(\"[MatterClient.apps().update()] App:\",e),new k(e)})[\"catch\"](function(e){return console.error(\"[MatterClient.apps().update()] Error updating app: \",e),Promise.reject(e)})}},{key:\"del\",value:function(e){return this.utils.request[\"delete\"](this.appEndpoint,e).then(function(e){return console.log(\"[MatterClient.apps().del()] Apps:\",e),new k(e)})[\"catch\"](function(e){return console.error(\"[MatterClient.apps().del()] Error deleting app: \",e),Promise.reject(e)})}},{key:\"getFiles\",value:function(){return this.get().then(function(e){e.getFiles().then(function(e){return e})[\"catch\"](function(e){return console.error(\"[MatterClient.app().getFiles()] Error getting application files: \",e),Promise.reject(e)})})[\"catch\"](function(e){return console.error(\"[MatterClient.app().getFiles()] Error getting application: \",e),Promise.reject(e)})}},{key:\"getStructure\",value:function(){return this.get().then(function(e){return e.getStructure().then(function(e){return console.log(\"Structure loaded: \",e),e})[\"catch\"](function(e){return console.error(\"[MatterClient.app().getStructure()] Error getting application structure: \",e),Promise.reject(e)})})[\"catch\"](function(e){return console.error(\"[MatterClient.app().getStructure()] Error getting application: \",e),Promise.reject(e)})}},{key:\"appEndpoint\",get:function(){return this.endpoint+\"/app/\"+this.name}}]),t}(y),w=function(e){function t(){_classCallCheck(this,t),_get(Object.getPrototypeOf(t.prototype),\"constructor\",this).call(this,b.appName,b.matterOptions)}return _inherits(t,e),_createClass(t,[{key:\"get\",value:function(){return console.warn(\"this.utils:\",this.endpoint),this.utils.request.get(this.appsEndpoint).then(function(e){return console.log(\"[MatterClient.apps().get()] App(s) data loaded:\",e),e})[\"catch\"](function(e){return console.error(\"[MatterClient.apps().get()] Error getting apps list: \",e),Promise.reject(e)})}},{key:\"add\",value:function(e){return this.utils.request.post(this.appsEndpoint,e).then(function(e){return console.log(\"[MatterClient.apps().add()] Application added successfully: \",e),new Application(e)})[\"catch\"](function(e){return console.error(\"[MatterClient.getApps()] Error adding application: \",e),Promise.reject(e)})}},{key:\"appsEndpoint\",get:function(){return this.endpoint+\"/apps\"}}]),t}(y),C=function(){function e(t){_classCallCheck(this,e),this.name=t.name,this.username=t.username,this.createdAt=t.createdAt,this.updatedAt=t.updatedAt}return _createClass(e,[{key:\"app\",value:function(e){return new j(e)}},{key:\"apps\",get:function(){return new w}}]),e}(),A=function(e){function t(e){if(_classCallCheck(this,t),_get(Object.getPrototypeOf(t.prototype),\"constructor\",this).call(this,b.appName,b.matterOptions),!e)throw console.error(\"Username is required to start an UserAction\"),new Error(\"Username is required to start an UserAction\");this.username=e}return _inherits(t,e),_createClass(t,[{key:\"get\",value:function(){return this.utils.request.get(this.userEndpoint).then(function(e){return console.log(\"[MatterClient.user().get()] App(s) data loaded:\",e),new C(e)})[\"catch\"](function(e){return console.error(\"[MatterClient.user().get()] Error getting users list: \",e),Promise.reject(e)})}},{key:\"update\",value:function(e){return this.utils.request.put(this.userEndpoint,e).then(function(e){return console.log(\"[MatterClient.users().update()] App:\",e),new C(e)})[\"catch\"](function(e){return console.error(\"[MatterClient.users().update()] Error updating user: \",e),Promise.reject(e)})}},{key:\"del\",value:function(e){console.error(\"Deleting a user is currently disabled.\")}},{key:\"userEndpoint\",get:function(){return this.endpoint+\"/users/\"+this.username}}]),t}(y),E=function(t){function r(){_classCallCheck(this,r),_get(Object.getPrototypeOf(r.prototype),\"constructor\",this).call(this,b.appName,b.matterOptions)}return _inherits(r,t),_createClass(r,[{key:\"get\",value:function(e){return this.utils.request.get(this.usersEndpoint).then(function(e){return console.log(\"[MatterClient.apps().get()] App(s) data loaded:\",e),e})[\"catch\"](function(e){return console.error(\"[MatterClient.apps().get()] Error getting apps list: \",e),Promise.reject(e)})}},{key:\"add\",value:function(e){return this.utils.request.post(this.usersEndpoint,e).then(function(e){return console.log(\"[MatterClient.apps().add()] Application added successfully: \",e),new Application(e)})[\"catch\"](function(e){return console.error(\"[MatterClient.getApps()] Error adding application: \",e),Promise.reject(e)})}},{key:\"search\",value:function(t){console.log(\"search called:\",t);var r=this.usersEndpoint+\"/search/\";return t&&e.isString(t)&&(r+=t),console.log(\"searchEndpoint:\",r),this.utils.request.get(r).then(function(e){return console.log(\"[MatterClient.users().search()] Users(s) data loaded:\",e),e})[\"catch\"](function(e){return console.error(\"[MatterClient.users().search()] Error getting apps list: \",e),Promise.reject(e)})}},{key:\"usersEndpoint\",get:function(){return this.endpoint+\"/users\"}}]),r}(y),M=function(e){function t(){_classCallCheck(this,t),_get(Object.getPrototypeOf(t.prototype),\"constructor\",this).call(this,b.appName,b.matterOptions)}return _inherits(t,e),_createClass(t,[{key:\"app\",value:function(e){return console.log(\"New AppAction:\",new j(e)),new j(e)}},{key:\"user\",value:function(e){return new A(e)}},{key:\"apps\",get:function(){return console.log(\"New AppsAction:\",new w),new w}},{key:\"users\",get:function(){return new E}}]),t}(y);return M});\n//# sourceMappingURL=grout.min.js.map","(function (global, factory) {\n\ttypeof exports === 'object' && typeof module !== 'undefined' ? module.exports = factory(require('lodash'), require('firebase'), require('jwt-decode'), require('superagent')) :\n\ttypeof define === 'function' && define.amd ? define(['lodash', 'firebase', 'jwt-decode', 'superagent'], factory) :\n\tglobal.Grout = factory(global._,global.Firebase,global.jwtDecode,global.superagent);\n}(this, function (_,Firebase,jwtDecode,superagent) { 'use strict';\n\n\t_ = 'default' in _ ? _['default'] : _;\n\tFirebase = 'default' in Firebase ? Firebase['default'] : Firebase;\n\tjwtDecode = 'default' in jwtDecode ? jwtDecode['default'] : jwtDecode;\n\tsuperagent = 'default' in superagent ? superagent['default'] : superagent;\n\n\tlet _config = {\n\t\tserverUrl: 'http://tessellate.elasticbeanstalk.com',\n\t\ttokenName: 'tessellate',\n\t\ttokenDataName: 'tessellate-tokenData'\n\t};\n\n\tlet logger = {\n\t\tlog(logData) {\n\t\t\tlet msgArgs = buildMessageArgs(logData);\n\t\t\tif (_config.envName == 'local') {\n\t\t\t\tconsole.log(logData);\n\t\t\t} else {\n\t\t\t\tconsole.log.apply(console, msgArgs);\n\t\t\t}\n\t\t},\n\t\tinfo(logData) {\n\t\t\tlet msgArgs = buildMessageArgs(logData);\n\t\t\tif (_config.envName == 'local') {\n\t\t\t\tconsole.info(logData);\n\t\t\t} else {\n\t\t\t\tconsole.info.apply(console, msgArgs);\n\t\t\t}\n\t\t},\n\t\twarn(logData) {\n\t\t\tlet msgArgs = buildMessageArgs(logData);\n\t\t\tif (_config.envName == 'local') {\n\t\t\t\tconsole.warn(logData);\n\t\t\t} else {\n\t\t\t\tconsole.warn.apply(console, msgArgs);\n\t\t\t}\n\t\t},\n\t\tdebug(logData) {\n\t\t\tlet msgArgs = buildMessageArgs(logData);\n\t\t\tif (_config.envName == 'local') {\n\t\t\t\tconsole.log(logData);\n\t\t\t} else {\n\t\t\t\tconsole.log.apply(console, msgArgs);\n\t\t\t}\n\t\t},\n\t\terror(logData) {\n\t\t\tlet msgArgs = buildMessageArgs(logData);\n\t\t\tif (_config.envName == 'local') {\n\t\t\t\tconsole.error(logData);\n\t\t\t} else {\n\t\t\t\tconsole.error.apply(console, msgArgs);\n\t\t\t\t//TODO: Log to external logger\n\t\t\t}\n\t\t}\n\t};\n\n\tfunction buildMessageArgs(logData) {\n\t\tvar msgStr = '';\n\t\tvar msgObj = {};\n\t\t//TODO: Attach time stamp\n\t\tif (_.isObject(logData)) {\n\t\t\tif (_.has(logData, 'func')) {\n\t\t\t\tif (_.has(logData, 'obj')) {\n\t\t\t\t\tmsgStr += '[' + logData.obj + '.' + logData.func + '()] ';\n\t\t\t\t} else if (_.has(logData, 'file')) {\n\t\t\t\t\tmsgStr += '[' + logData.file + ' > ' + logData.func + '()] ';\n\t\t\t\t} else {\n\t\t\t\t\tmsgStr += '[' + logData.func + '()] ';\n\t\t\t\t}\n\t\t\t}\n\t\t\t//Print each key and its value other than obj and func\n\t\t\t_.each(_.omit(_.keys(logData)), function(key, ind, list) {\n\t\t\t\tif (key != 'func' && key != 'obj') {\n\t\t\t\t\tif (key == 'description' || key == 'message') {\n\t\t\t\t\t\tmsgStr += logData[key];\n\t\t\t\t\t} else if (_.isString(logData[key])) {\n\t\t\t\t\t\t// msgStr += key + ': ' + logData[key] + ', ';\n\t\t\t\t\t\tmsgObj[key] = logData[key];\n\t\t\t\t\t} else {\n\t\t\t\t\t\t//Print objects differently\n\t\t\t\t\t\t// msgStr += key + ': ' + logData[key] + ', ';\n\t\t\t\t\t\tmsgObj[key] = logData[key];\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t\tmsgStr += '\\n';\n\t\t} else if (_.isString(logData)) {\n\t\t\tmsgStr = logData;\n\t\t}\n\t\tvar msg = [msgStr, msgObj];\n\n\t\treturn msg;\n\t}\n\n\tlet data = {};\n\tlet storage = {\n\t\tget localExists() {\n\t\t\tconst testKey = 'test';\n\t\t\tif (typeof window != 'undefined' && typeof window.sessionStorage != 'undefined') {\n\t\t\t\ttry {\n\t\t\t\t\twindow.sessionStorage.setItem(testKey, '1');\n\t\t\t\t\twindow.sessionStorage.removeItem(testKey);\n\t\t\t\t\treturn true;\n\t\t\t\t} catch (err) {\n\t\t\t\t\tlogger.error({description: 'Error saving to session storage', error: err,  obj: 'storage', func: 'localExists'});\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t},\n\t\t/**\n\t\t * @description\n\t\t * Safley sets item to session storage.\n\t\t *\n\t\t * @param {String} itemName The items name\n\t\t * @param {String} itemValue The items value\n\t\t *\n\t\t */\n\t\titem(itemName, itemValue) {\n\t\t\treturn this.setItem(itemName, itemValue);\n\t\t},\n\t\t/**\n\t\t * @description\n\t\t * Safley sets item to session storage. Alias: item()\n\t\t *\n\t\t * @param {String} itemName The items name\n\t\t * @param {String} itemValue The items value\n\t\t *\n\t\t */\n\t\tsetItem(itemName, itemValue) {\n\t\t\tdata[itemName] = itemValue;\n\t\t\tif (this.localExists) {\n\t\t\t\t//Convert object to string\n\t\t\t\tif (_.isObject(itemValue)) {\n\t\t\t\t\titemValue = JSON.stringify(itemValue);\n\t\t\t\t}\n\t\t\t\twindow.sessionStorage.setItem(itemName, itemValue);\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * @description\n\t\t * Safley gets an item from session storage. Alias: item()\n\t\t *\n\t\t * @param {String} itemName The items name\n\t\t *\n\t\t * @return {String}\n\t\t *\n\t\t */\n\t\tgetItem(itemName) {\n\t\t\tif (data[itemName]) {\n\t\t\t\treturn data[itemName];\n\t\t\t} else if (this.localExists) {\n\t\t\t\tlet itemStr = window.sessionStorage.getItem(itemName);\n\t\t\t\t//Check that str is not null before parsing\n\t\t\t\tif (itemStr) {\n\t\t\t\t\tlet isObj = false;\n\t\t\t\t\tlet itemObj = null;\n\t\t\t\t\t//Try parsing to object\n\t\t\t\t\ttry {\n\t\t\t\t\t\titemObj = JSON.parse(itemStr);\n\t\t\t\t\t\tisObj = true;\n\t\t\t\t\t} catch (err) {\n\t\t\t\t\t\t// logger.log({message: 'String could not be parsed.', error: err, func: 'getItem', obj: 'storage'});\n\t\t\t\t\t\t//Parsing failed, this must just be a string\n\t\t\t\t\t\tisObj = false;\n\t\t\t\t\t}\n\t\t\t\t\tif (isObj) {\n\t\t\t\t\t\treturn itemObj;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn itemStr;\n\t\t\t} else {\n\t\t\t\treturn null;\n\t\t\t}\n\t\t},\n\t\t/**\n\t\t * @description\n\t\t * Safley removes item from session storage.\n\t\t *\n\t\t * @param {String} itemName - The items name\n\t\t *\n\t\t */\n\t\tremoveItem(itemName) {\n\t\t\t//TODO: Only remove used items\n\t\t\tif (data[itemName]) {\n\t\t\t\tdata[itemName] = null;\n\t\t\t}\n\t\t\tif (this.localExists) {\n\t\t\t\ttry {\n\t\t\t\t\t//Clear session storage\n\t\t\t\t\twindow.sessionStorage.removeItem(itemName);\n\t\t\t\t} catch (err) {\n\t\t\t\t\tlogger.error({description: 'Error removing item from session storage', error: err,  obj: 'storage', func: 'removeItem'});\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\t/**\n\t\t * @description\n\t\t * Safley removes item from session storage.\n\t\t *\n\t\t * @param {String} itemName the items name\n\t\t * @param {String} itemValue the items value\n\t\t *\n\t\t */\n\t\tclear() {\n\t\t\t//TODO: Only remove used items\n\t\t\tdata = {};\n\t\t\tif (this.localExists) {\n\t\t\t\ttry {\n\t\t\t\t\t\t//Clear session storage\n\t\t\t\t\twindow.sessionStorage.clear();\n\t\t\t\t} catch (err) {\n\t\t\t\t\tlogger.warn('Session storage could not be cleared.', err);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t};\n\n\tfunction decodeToken(tokenStr) {\n\t\tlet tokenData;\n\t\tif (tokenStr && tokenStr != '') {\n\t\t\ttry {\n\t\t\t\ttokenData = jwtDecode(tokenStr);\n\t\t\t} catch (err) {\n\t\t\t\tlogger.error({description: 'Error decoding token.', data: tokenData, error: err, func: 'decodeToken', file: 'token'});\n\t\t\t\tthrow new Error('Invalid token string.');\n\t\t\t}\n\t\t}\n\t\treturn tokenData;\n\t}\n\tlet token = {\n\t\tget string() {\n\t\t\treturn storage.getItem(_config.tokenName);\n\t\t},\n\t\tget data() {\n\t\t\tif (storage.getItem(_config.tokenDataName)) {\n\t\t\t\treturn storage.getItem(_config.tokenDataName);\n\t\t\t} else {\n\t\t\t\treturn decodeToken(this.string);\n\t\t\t}\n\t\t},\n\t\tset data(tokenData) {\n\t\t\tif (_.isString(tokenData)) {\n\t\t\t\tlet tokenStr = tokenData;\n\t\t\t\ttokenData = decodeToken(tokenStr);\n\t\t\t\tlogger.info({description: 'Token data was set as string. Decoding token.', token: tokenStr, tokenData: tokenData, func: 'data', obj: 'token'});\n\t\t\t} else {\n\t\t\t\tlogger.log({description: 'Token data was set.', data: tokenData, func: 'data', obj: 'token'});\n\t\t\t\tstorage.setItem(_config.tokenDataName, tokenData);\n\t\t\t}\n\t\t},\n\t\tset string(tokenStr) {\n\t\t\tlogger.log({description: 'Token was set.', token: tokenStr, func: 'string', obj: 'token'});\n\t\t\tthis.data = jwtDecode(tokenStr);\n\t\t\tstorage.setItem(_config.tokenName, tokenStr);\n\t\t},\n\t\tsave(tokenStr) {\n\t\t\tthis.string = tokenStr;\n\t\t},\n\t\tdelete() {\n\t\t\tstorage.removeItem(_config.tokenName);\n\t\t\tstorage.removeItem(_config.tokenDataName);\n\t\t\tlogger.log({description: 'Token was removed.', func: 'delete', obj: 'token'});\n\t\t}\n\t};\n\n\tlet request = {\n\t\tget(endpoint, queryData) {\n\t\t\tvar req = superagent.get(endpoint);\n\t\t\tif (queryData) {\n\t\t\t\treq.query(queryData);\n\t\t\t}\n\t\t\treq = addAuthHeader(req);\n\t\t\treturn handleResponse(req);\n\t\t},\n\t\tpost(endpoint, data) {\n\t\t\tvar req = superagent.post(endpoint).send(data);\n\t\t\treq = addAuthHeader(req);\n\t\t\treturn handleResponse(req);\n\t\t},\n\t\tput(endpoint, data) {\n\t\t\tvar req = superagent.put(endpoint).send(data);\n\t\t\treq = addAuthHeader(req);\n\t\t\treturn handleResponse(req);\n\t\t},\n\t\tdel(endpoint, data) {\n\t\t\tvar req = superagent.put(endpoint).send(data);\n\t\t\treq = addAuthHeader(req);\n\t\t\treturn handleResponse(req);\n\t\t}\n\t};\n\n\tfunction handleResponse(req) {\n\t\treturn new Promise((resolve, reject) => {\n\t\t\treq.end((err, res) => {\n\t\t\t\tif (!err) {\n\t\t\t\t\t// logger.log({description: 'Response:', response:res, func:'handleResponse', file: 'request'});\n\t\t\t\t\treturn resolve(res.body);\n\t\t\t\t} else {\n\t\t\t\t\tif (err.status == 401) {\n\t\t\t\t\t\tlogger.warn('Unauthorized. You must be signed into make this request.');\n\t\t\t\t\t}\n\t\t\t\t\treturn reject(err);\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t}\n\tfunction addAuthHeader(req) {\n\t\tif (token.string) {\n\t\t\treq = req.set('Authorization', 'Bearer ' + token.string);\n\t\t\tlogger.info({message: 'Set auth header', func: 'addAuthHeader', file: 'request'});\n\t\t}\n\t\treturn req;\n\t}\n\n\tclass Matter {\n\t\t/* Constructor\n\t\t * @param {string} appName Name of application\n\t\t */\n\t\tconstructor(appName, opts) {\n\t\t\tif (!appName) {\n\t\t\t\tlogger.error({description: 'Application name requires to use Matter.', func: 'constructor', obj: 'Matter'});\n\t\t\t\tthrow new Error('Application name is required to use Matter');\n\t\t\t} else {\n\t\t\t\tthis.name = appName;\n\t\t\t}\n\t\t\tif (opts) {\n\t\t\t\tthis.options = opts;\n\t\t\t}\n\t\t}\n\t\t/* Endpoint getter\n\t\t *\n\t\t */\n\t\tget endpoint() {\n\t\t\tlet serverUrl = _config.serverUrl;\n\t\t\tif (_.has(this, 'options') && this.options.localServer) {\n\t\t\t\tserverUrl = 'http://localhost:4000';\n\t\t\t\tlogger.info({description: 'LocalServer option was set to true. Now server url is local server.', url: serverUrl, func: 'endpoint', obj: 'Matter'});\n\t\t\t}\n\t\t\tif (this.name == 'tessellate') {\n\t\t\t\t//Remove url if host is server\n\t\t\t\tif (window && _.has(window, 'location') && window.location.host == serverUrl) {\n\t\t\t\t\tserverUrl = '';\n\t\t\t\t\tlogger.info({description: 'Host is Server, serverUrl simplified!', url: serverUrl, func: 'endpoint', obj: 'Matter'});\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tserverUrl = _config.serverUrl + '/apps/' + this.name;\n\t\t\t\tlogger.info({description: 'Server url set.', url: serverUrl, func: 'endpoint', obj: 'Matter'});\n\t\t\t}\n\t\t\treturn serverUrl;\n\t\t}\n\t\t/* Signup\n\t\t *\n\t\t */\n\t\tsignup(signupData) {\n\t\t\treturn request.post(this.endpoint + '/signup', signupData)\n\t\t\t.then((response) => {\n\t\t\t\tlogger.log({description: 'Account request successful.', signupData: signupData, response: response, func: 'signup', obj: 'Matter'});\n\t\t\t\tif (_.has(response, 'account')) {\n\t\t\t\t\treturn response.account;\n\t\t\t\t} else {\n\t\t\t\t\tlogger.warn({description: 'Account was not contained in signup response.', signupData: signupData, response: response, func: 'signup', obj: 'Matter'});\n\t\t\t\t\treturn response;\n\t\t\t\t}\n\t\t\t})\n\t\t\t['catch']((errRes) => {\n\t\t\t\tlogger.error({description: 'Error requesting signup.', signupData: signupData, error: errRes, func: 'signup', obj: 'Matter'});\n\t\t\t\treturn Promise.reject(errRes);\n\t\t\t});\n\t\t}\n\t\t/** Login\n\t\t *\n\t\t */\n\t\tlogin(loginData) {\n\t\t\tif (!loginData || !loginData.password || !loginData.username) {\n\t\t\t\tlogger.error({description: 'Username/Email and Password are required to login', func: 'login', obj: 'Matter'});\n\t\t\t\treturn Promise.reject({message: 'Username/Email and Password are required to login'});\n\t\t\t}\n\t\t\treturn request.put(this.endpoint + '/login', loginData)\n\t\t\t.then((response) => {\n\t\t\t\tif (_.has(response, 'data') && _.has(response.data, 'status') && response.data.status == 409) {\n\t\t\t\t\tlogger.warn({description: 'Account not found.', response: response, func: 'login', obj: 'Matter'});\n\t\t\t\t\treturn Promise.reject(response.data);\n\t\t\t\t} else {\n\t\t\t\t\tlogger.log({description: 'Successful login.', response: response, func: 'login', obj: 'Matter'});\n\t\t\t\t\tif (_.has(response, 'token')) {\n\t\t\t\t\t\tthis.token.string = response.token;\n\t\t\t\t\t}\n\t\t\t\t\tif (_.has(response, 'account')) {\n\t\t\t\t\t\tthis.storage.setItem('currentUser', response.account);\n\t\t\t\t\t}\n\t\t\t\t\treturn response.account;\n\t\t\t\t}\n\t\t\t})['catch']((errRes) => {\n\t\t\t\tlogger.error({description: 'Error requesting login.', error: errRes, status: errRes.status,  func: 'login', obj: 'Matter'});\n\t\t\t\tif (errRes.status == 409 || errRes.status == 400) {\n\t\t\t\t\terrRes = errRes.response.text;\n\t\t\t\t}\n\t\t\t\treturn Promise.reject(errRes);\n\t\t\t});\n\t\t}\n\t\t/** Logout\n\t\t */\n\t\tlogout() {\n\t\t\treturn request.put(this.endpoint + '/logout').then((response) => {\n\t\t\t\tlogger.log({description: 'Logout successful.', response: response, func: 'logout', obj: 'Matter'});\n\t\t\t\tthis.storage.removeItem('currentUser');\n\t\t\t\tthis.token.delete();\n\t\t\t\treturn response;\n\t\t\t})['catch']((errRes) => {\n\t\t\t\tlogger.error({description: 'Error requesting log out: ', error: errRes, func: 'logout', obj: 'Matter'});\n\t\t\t\tthis.storage.removeItem('currentUser');\n\t\t\t\tthis.token.delete();\n\t\t\t\treturn Promise.reject(errRes);\n\t\t\t});\n\t\t}\n\t\tgetCurrentUser() {\n\t\t\tif (this.storage.item('currentUser')) {\n\t\t\t\treturn Promise.resove(this.storage.item('currentUser'));\n\t\t\t} else {\n\t\t\t\treturn request.get(this.endpoint + '/user').then((response) => {\n\t\t\t\t\t//TODO: Save user information locally\n\t\t\t\t\tlogger.log({description: 'Current User Request responded.', responseData: response.data, func: 'currentUser', obj: 'Matter'});\n\t\t\t\t\tthis.currentUser = response.data;\n\t\t\t\t\treturn response.data;\n\t\t\t\t})['catch']((errRes) => {\n\t\t\t\t\tlogger.error({description: 'Error requesting current user.', error: errRes, func: 'currentUser', obj: 'Matter'});\n\t\t\t\t\treturn Promise.reject(errRes);\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t\tset currentUser(userData) {\n\t\t\tlogger.log({description: 'Current User Request responded.', user: userData, func: 'currentUser', obj: 'Matter'});\n\t\t\tthis.storage.setItem(userData);\n\t\t}\n\t\tget currentUser() {\n\t\t\tif (this.storage.getItem('currentUser')) {\n\t\t\t\treturn this.storage.getItem('currentUser');\n\t\t\t} else {\n\t\t\t\treturn null;\n\t\t\t}\n\t\t}\n\t\t/** updateProfile\n\t\t */\n\t\tupdateProfile(updateData) {\n\t\t\tif (!this.isLoggedIn) {\n\t\t\t\tlogger.error({description: 'No current user profile to update.', func: 'updateProfile', obj: 'Matter'});\n\t\t\t\treturn Promise.reject({message: 'Must be logged in to update profile.'});\n\t\t\t}\n\t\t\t//Send update request\n\t\t\tlogger.warn({description: 'Calling update endpoint.', endpoint: `${this.endpoint}/user/${this.token.data.username}` , func: 'updateProfile', obj: 'Matter'});\n\t\t\treturn request.put(`${this.endpoint}/user/${this.token.data.username}` , updateData).then((response) => {\n\t\t\t\tlogger.log({description: 'Update profile request responded.', responseData: response, func: 'updateProfile', obj: 'Matter'});\n\t\t\t\tthis.currentUser = response;\n\t\t\t\treturn response;\n\t\t\t})['catch']((errRes) => {\n\t\t\t\tlogger.error({description: 'Error requesting current user.', error: errRes, func: 'updateProfile', obj: 'Matter'});\n\t\t\t\treturn Promise.reject(errRes);\n\t\t\t});\n\t\t}\n\t\t/** updateProfile\n\t\t */\n\t\tget storage() {\n\t\t\treturn storage;\n\t\t}\n\t\t/** updateProfile\n\t\t */\n\t\tget token() {\n\t\t\treturn token;\n\t\t}\n\t\tget utils() {\n\t\t\treturn {logger: logger, request: request, storage: storage};\n\t\t}\n\t\tget isLoggedIn() {\n\t\t\treturn this.token.string ? true : false;\n\t\t}\n\t\t//Check that user is in a single group or in all of a list of groups\n\t\tisInGroup(checkGroups) {\n\t\t\tif (!this.isLoggedIn) {\n\t\t\t\tlogger.log({description: 'No logged in user to check.', func: 'isInGroup', obj: 'Matter'});\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\t//Check if user is\n\t\t\tif (checkGroups && _.isString(checkGroups)) {\n\t\t\t\tlet groupName = checkGroups;\n\t\t\t\t//Single role or string list of roles\n\t\t\t\tlet groupsArray = groupName.split(',');\n\t\t\t\tif (groupsArray.length > 1) {\n\t\t\t\t\t//String list of groupts\n\t\t\t\t\tlogger.info({description: 'String list of groups.', list: groupsArray, func: 'isInGroup', obj: 'Matter'});\n\t\t\t\t\treturn this.isInGroups(groupsArray);\n\t\t\t\t} else {\n\t\t\t\t\t//Single group\n\t\t\t\t\tlet groups = this.token.data.groups || [];\n\t\t\t\t\tlogger.log({description: 'Checking if user is in group.', group: groupName, userGroups: this.token.data.groups || [],  func: 'isInGroup', obj: 'Matter'});\n\t\t\t\t\treturn _.any(groups, (group) =>  {\n\t\t\t\t\t\treturn groupName == group.name;\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t} else if (checkGroups && _.isArray(checkGroups)) {\n\t\t\t\t//Array of roles\n\t\t\t\t//Check that user is in every group\n\t\t\t\tlogger.info({description: 'Array of groups.', list: checkGroups, func: 'isInGroup', obj: 'Matter'});\n\t\t\t\treturn this.isInGroups(checkGroups);\n\t\t\t} else {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\t//TODO: Handle string and array inputs\n\t\t}\n\t\tisInGroups(checkGroups) {\n\t\t\t//Check if user is in any of the provided groups\n\t\t\tif (checkGroups && _.isArray(checkGroups)) {\n\t\t\t\treturn _.map(checkGroups, (group) =>  {\n\t\t\t\t\tif (_.isString(group)) {\n\t\t\t\t\t\t//Group is string\n\t\t\t\t\t\treturn this.isInGroup(group);\n\t\t\t\t\t} else {\n\t\t\t\t\t\t//Group is object\n\t\t\t\t\t\treturn this.isInGroup(group.name);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t} else if (checkGroups && _.isString(checkGroups)) {\n\t\t\t\t//TODO: Handle spaces within string list\n\t\t\t\tlet groupsArray = checkGroups.split(',');\n\t\t\t\tif (groupsArray.length > 1) {\n\t\t\t\t\treturn this.isInGroups(groupsArray);\n\t\t\t\t}\n\t\t\t\treturn this.isInGroup(groupsArray[0]);\n\t\t\t} else {\n\t\t\t\tlogger.error({description: 'Invalid groups list.', func: 'isInGroups', obj: 'Matter'});\n\t\t\t}\n\t\t}\n\t}\n\n\tlet config = {\n\t\tserverUrl: 'http://tessellate.elasticbeanstalk.com',\n\t\ttokenName: 'grout',\n\t\tfbUrl: 'https://pruvit.firebaseio.com/',\n\t\tappName: 'tessellate',\n\t\tmatterOptions: {\n\t\t\tlocalServer: true\n\t\t},\n\t\taws: {\n\t\t\tregion: 'us-east-1',\n\t\t\tcognito: {\n\t\t\t\tpoolId: 'us-east-1:72a20ffd-c638-48b0-b234-3312b3e64b2e',\n\t\t\t\tparams: {\n\t\t\t\t\tAuthRoleArn: 'arn:aws:iam::823322155619:role/Cognito_TessellateUnauth_Role',\n\t\t\t\t\tUnauthRoleArn: 'arn:aws:iam::823322155619:role/Cognito_TessellateAuth_Role'\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t};\n\n\t/**\n\t * Application class.\n\t *\n\t */\n\tclass _Application extends Matter {\n\t\tconstructor(appData) {\n\t\t\t//Call matter with name and settings\n\t\t\tsuper(config.appName, config.matterOptions);\n\t\t\tthis.name = appData.name;\n\t\t\tthis.owner = appData.owner || null;\n\t\t\tthis.collaborators = appData.collaborators || [];\n\t\t\tthis.createdAt = appData.createdAt;\n\t\t\tthis.updatedAt = appData.updatedAt;\n\t\t\tthis.frontend = appData.frontend || {};\n\t\t\tthis.backend = appData.backend || {};\n\t\t\tif (Firebase) {\n\t\t\t\tthis.fbRef = new Firebase(config.fbUrl + appData.name);\n\t\t\t}\n\t\t}\n\t\t//Get files list and convert to structure\n\t\tgetStructure() {\n\t\t\treturn this.getFiles().then((filesArray) => {\n\t\t\t\tconst childStruct = childrenStructureFromArray(filesArray);\n\t\t\t\tconsole.log('Child struct from array:', childStruct);\n\t\t\t\treturn childStruct;\n\t\t\t}, (err) => {\n\t\t\t\tconsole.error('[Application.getStructure] Error getting files: ', err);\n\t\t\t\treturn Promise.reject({message: 'Error getting files.', error: err});\n\t\t\t});\n\t\t}\n\t\t//Get files list from S3\n\t\tgetFiles() {\n\t\t\tif (!this.frontend || !this.frontend.bucketName) {\n\t\t\t\tconsole.error('[Applicaiton.getFiles] Attempting to get objects for bucket without name.');\n\t\t\t\treturn Promise.reject({message: 'Bucket name required to get objects'});\n\t\t\t} else {\n\t\t\t\t//If AWS Credential do not exist, set them\n\t\t\t\tif (typeof AWS.config.credentials == 'undefined' || !AWS.config.credentials) {\n\t\t\t\t\t// console.info('AWS creds are being updated to make this.utils.request');\n\t\t\t\t\tsetAWSConfig();\n\t\t\t\t}\n\t\t\t\tvar s3 = new AWS.S3();\n\t\t\t\tvar listParams = {Bucket: this.frontend.bucketName};\n\t\t\t\treturn new Promise((resolve, reject) => {\n\t\t\t\t\ts3.listObjects(listParams, function(err, data) {\n\t\t\t\t\t\tif (!err) {\n\t\t\t\t\t\t\tconsole.log('[Application.getObjects()] listObjects returned:', data);\n\t\t\t\t\t\t\treturn resolve(data.Contents);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tconsole.error('[Application.getObjects()] Error listing objects:', err);\n\t\t\t\t\t\t\treturn reject(err);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t\tpublishFile(fileData) {\n\t\t\tif (!this.frontend) {\n\t\t\t\tconsole.error('Frontend data not available. Make sure to call .get().');\n\t\t\t\treturn Promise.reject({message: 'Front end data is required to publish file.'});\n\t\t\t}\n\t\t\tvar saveParams = {Bucket: this.frontent.bucketName, Key: fileData.key,  Body: fileData.content, ACL: 'public-read'};\n\t\t\t//Set contentType from fileData to ContentType parameter of new object\n\t\t\tif (fileData.contentType) {\n\t\t\t\tsaveParams.ContentType = fileData.contentType;\n\t\t\t}\n\t\t\t// console.log('[$aws.$saveFiles] saveParams:', saveParams);\n\t\t\treturn s3.putObject(saveParams, function(err, data) {\n\t\t\t\t//[TODO] Add putting object ACL (make public)\n\t\t\t\tif (!err) {\n\t\t\t\t\tconsole.log('[Application.publishFile()] file saved successfully. Returning:', data);\n\t\t\t\t\treturn data;\n\t\t\t\t}\telse {\n\t\t\t\t\tconsole.error('[Application.publishFile()] Error saving file:', err);\n\t\t\t\t\treturn Promise.reject(err);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\taddStorage() {\n\t\t\t//TODO:Add storage bucket\n\t\t\tvar endpoint = config.serverUrl + '/apps/' + this.name + '/storage';\n\t\t\treturn this.utils.request.post(endpoint, appData).then((response) => {\n\t\t\t\tconsole.log('[Application.addStorage()] Apps:', response);\n\t\t\t\treturn new _Application(response);\n\t\t\t})['catch']((errRes) => {\n\t\t\t\tconsole.error('[Application.addStorage()] Error getting apps list: ', errRes);\n\t\t\t\treturn Promise.reject(errRes);\n\t\t\t});\n\t\t}\n\t\tapplyTemplate() {\n\t\t\tvar endpoint = config.serverUrl + '/apps/' + this.name + '/template';\n\t\t\tconsole.log('Applying templates to existing');\n\t\t\t// return this.utils.request.post(endpoint, appData).then(function(response) {\n\t\t\t// \tconsole.log('[Application.addStorage()] Apps:', response);\n\t\t\t// \tif (!apps.isList) {\n\t\t\t// \t\treturn new Application(response);\n\t\t\t// \t}\n\t\t\t// \treturn response;\n\t\t\t// })['catch'](function(errRes) {\n\t\t\t// \tconsole.error('[Application.addStorage()] Error getting apps list: ', errRes);\n\t\t\t// \treturn Promise.reject(errRes);\n\t\t\t// });\n\t\t}\n\t}\n\n\t//------------------ Utility Functions ------------------//\n\n\t// AWS Config\n\tfunction setAWSConfig() {\n\t\tAWS.config.update({\n\t\t  credentials: new AWS.CognitoIdentityCredentials({\n\t\t  IdentityPoolId: config.aws.cognito.poolId\n\t\t  }),\n\t\t  region: config.aws.region\n\t\t});\n\t}\n\n\t//Convert from array file structure (from S3) to 'children' structure used in Editor GUI (angular-tree-control)\n\t//Examples for two files (index.html and /testFolder/file.js):\n\t//Array structure: [{path:'index.html'}, {path:'testFolder/file.js'}]\n\t//Children Structure [{type:'folder', name:'testfolder', children:[{path:'testFolder/file.js', name:'file.js', filetype:'javascript', contentType:'application/javascript'}]}]\n\tfunction childrenStructureFromArray(fileArray) {\n\t\t// console.log('childStructureFromArray called:', fileArray);\n\t\t//Create a object for each file that stores the file in the correct 'children' level\n\t\tvar mappedStructure = fileArray.map(function(file) {\n\t\t\treturn buildStructureObject(file);\n\t\t});\n\t\treturn combineLikeObjs(mappedStructure);\n\t}\n\t//Convert file with key into a folder/file children object\n\tfunction buildStructureObject(file) {\n\t\tvar pathArray;\n\t\t// console.log('buildStructureObject with:', file);\n\t\tif (_.has(file, 'path')) {\n\t\t\t//Coming from files already having path (structure)\n\t\t\tpathArray = file.path.split('/');\n\t\t} else {\n\t\t\t//Coming from aws\n\t\t\tpathArray = file.Key.split('/');\n\t\t\t// console.log('file before pick:', file);\n\t\t\tfile = _.pick(file, 'Key');\n\t\t\tfile.path = file.Key;\n\t\t\tfile.name = file.Key;\n\t\t}\n\t\tvar currentObj = file;\n\t\tif (pathArray.length == 1) {\n\t\t\tcurrentObj.name = pathArray[0];\n\t\t\tif (!_.has(currentObj,'type')) {\n\t\t\t\tcurrentObj.type = 'file';\n\t\t\t}\n\t\t\tcurrentObj.path = pathArray[0];\n\t\t\treturn currentObj;\n\t\t} else {\n\t\t\tvar finalObj = {};\n\t\t\t_.each(pathArray, (loc, ind, list) => {\n\t\t\t\tif (ind != list.length - 1) {//Not the last loc\n\t\t\t\t\tcurrentObj.name = loc;\n\t\t\t\t\tcurrentObj.path = _.first(list, ind + 1).join('/');\n\t\t\t\t\tcurrentObj.type = 'folder';\n\t\t\t\t\tcurrentObj.children = [{}];\n\t\t\t\t\t//TODO: Find out why this works\n\t\t\t\t\tif (ind == 0) {\n\t\t\t\t\t\tfinalObj = currentObj;\n\t\t\t\t\t}\n\t\t\t\t\tcurrentObj = currentObj.children[0];\n\t\t\t\t} else {\n\t\t\t\t\tcurrentObj.type = 'file';\n\t\t\t\t\tcurrentObj.name = loc;\n\t\t\t\t\tcurrentObj.path = pathArray.join('/');\n\t\t\t\t\tif (file.$id) {\n\t\t\t\t\t\tcurrentObj.$id = file.$id;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t\treturn finalObj;\n\t\t}\n\t}\n\t//Recursivley combine children of object's that have the same names\n\tfunction combineLikeObjs(mappedArray) {\n\t\tvar takenNames = [];\n\t\tvar finishedArray = [];\n\t\t_.each(mappedArray, (obj, ind, list) => {\n\t\t\tif (takenNames.indexOf(obj.name) == -1) {\n\t\t\t\ttakenNames.push(obj.name);\n\t\t\t\tfinishedArray.push(obj);\n\t\t\t} else {\n\t\t\t\tvar likeObj = _.findWhere(mappedArray, {name: obj.name});\n\t\t\t\t//Combine children of like objects\n\t\t\t\tlikeObj.children = _.union(obj.children, likeObj.children);\n\t\t\t\tlikeObj.children = combineLikeObjs(likeObj.children);\n\t\t\t\t// console.log('extended obj:',likeObj);\n\t\t\t}\n\t\t});\n\t\treturn finishedArray;\n\t}\n\n\t//Actions for specific application\n\tclass AppAction extends Matter {\n\t\tconstructor(appName) {\n\t\t\t//Call matter with name and settings\n\t\t\tsuper(config.appName, config.matterOptions);\n\t\t\tif (appName) {\n\t\t\t\tthis.name = appName;\n\t\t\t} else {\n\t\t\t\tconsole.error('Application name is required to start an AppAction');\n\t\t\t\tthrow new Error('Application name is required to start an AppAction');\n\t\t\t}\n\t\t}\n\t\tget appEndpoint() {\n\t\t\treturn `${this.endpoint}/app/${this.name}`;\n\t\t}\n\t\t//Get applications or single application\n\t\tget() {\n\t\t\treturn this.utils.request.get(this.appEndpoint).then((response) => {\n\t\t\t\tconsole.log('[MatterClient.app().get()] App(s) data loaded:', response);\n\t\t\t\treturn new _Application(response);\n\t\t\t})['catch']((errRes) => {\n\t\t\t\tconsole.error('[MatterClient.app().get()] Error getting apps list: ', errRes);\n\t\t\t\treturn Promise.reject(errRes);\n\t\t\t});\n\t\t}\n\t\t//Update an application\n\t\tupdate(appData) {\n\t\t\treturn this.utils.request.put(this.appEndpoint, appData).then((response) => {\n\t\t\t\tconsole.log('[MatterClient.apps().update()] App:', response);\n\t\t\t\treturn new _Application(response);\n\t\t\t})['catch']((errRes) => {\n\t\t\t\tconsole.error('[MatterClient.apps().update()] Error updating app: ', errRes);\n\t\t\t\treturn Promise.reject(errRes);\n\t\t\t});\n\t\t}\n\t\t//Delete an application\n\t\tdel(appData) {\n\t\t\treturn this.utils.request.delete(this.appEndpoint, appData).then((response) => {\n\t\t\t\tconsole.log('[MatterClient.apps().del()] Apps:', response);\n\t\t\t\treturn new _Application(response);\n\t\t\t})['catch']((errRes) => {\n\t\t\t\tconsole.error('[MatterClient.apps().del()] Error deleting app: ', errRes);\n\t\t\t\treturn Promise.reject(errRes);\n\t\t\t});\n\t\t}\n\t\tgetFiles() {\n\t\t\treturn this.get().then((app) => {\n\t\t\t\tapp.getFiles().then((filesArray)=> {\n\t\t\t\t\treturn filesArray;\n\t\t\t\t})['catch']((err) => {\n\t\t\t\t\tconsole.error('[MatterClient.app().getFiles()] Error getting application files: ', err);\n\t\t\t\t\treturn Promise.reject(err);\n\t\t\t\t});\n\t\t\t})['catch']((err) => {\n\t\t\t\tconsole.error('[MatterClient.app().getFiles()] Error getting application: ', err);\n\t\t\t\treturn Promise.reject(err);\n\t\t\t});\n\t\t}\n\n\t\tgetStructure() {\n\t\t\treturn this.get().then((app) => {\n\t\t\t\treturn app.getStructure().then((structure)=> {\n\t\t\t\t\tconsole.log('Structure loaded: ', structure);\n\t\t\t\t\treturn structure;\n\t\t\t\t})['catch']((err) => {\n\t\t\t\t\tconsole.error('[MatterClient.app().getStructure()] Error getting application structure: ', err);\n\t\t\t\t\treturn Promise.reject(err);\n\t\t\t\t});\n\t\t\t})['catch']((err) => {\n\t\t\t\tconsole.error('[MatterClient.app().getStructure()] Error getting application: ', err);\n\t\t\t\treturn Promise.reject(err);\n\t\t\t});\n\t\t}\n\t}\n\n\t//Actions for applications list\n\tclass AppsAction extends Matter {\n\t\tconstructor() {\n\t\t\t//Call matter with name and settings\n\t\t\tsuper(config.appName, config.matterOptions);\n\t\t}\n\t\tget appsEndpoint() {\n\t\t\treturn `${this.endpoint}/apps`;\n\t\t}\n\t\t//Get applications or single application\n\t\tget() {\n\t\t\tconsole.warn('this.utils:', this.endpoint);\n\t\t\treturn this.utils.request.get(this.appsEndpoint).then((response) => {\n\t\t\t\tconsole.log('[MatterClient.apps().get()] App(s) data loaded:', response);\n\t\t\t\treturn response;\n\t\t\t})['catch']((errRes) => {\n\t\t\t\tconsole.error('[MatterClient.apps().get()] Error getting apps list: ', errRes);\n\t\t\t\treturn Promise.reject(errRes);\n\t\t\t});\n\t\t}\n\t\t//Add an application\n\t\tadd(appData) {\n\t\t\treturn this.utils.request.post(this.appsEndpoint, appData).then((response) => {\n\t\t\t\tconsole.log('[MatterClient.apps().add()] Application added successfully: ', response);\n\t\t\t\treturn new Application(response);\n\t\t\t})['catch']((errRes) => {\n\t\t\t\tconsole.error('[MatterClient.getApps()] Error adding application: ', errRes);\n\t\t\t\treturn Promise.reject(errRes);\n\t\t\t});\n\t\t}\n\t}\n\n\t/**\n\t * User class.\n\t *\n\t */\n\tclass User {\n\t\tconstructor(userData) {\n\t\t\tthis.name = userData.name;\n\t\t\tthis.username = userData.username;\n\t\t\tthis.createdAt = userData.createdAt;\n\t\t\tthis.updatedAt = userData.updatedAt;\n\t\t}\n\t\tget apps() {\n\t\t\treturn new AppsAction();\n\t\t}\n\t\tapp(appName) {\n\t\t\t//TODO: Attach owner as well ?\n\t\t\treturn new AppAction(appName);\n\t\t}\n\t}\n\n\t//Actions for specific user\n\tclass UserAction extends Matter {\n\t\tconstructor(userName) {\n\t\t\t//Call matter with name and settings\n\t\t\tsuper(config.appName, config.matterOptions);\n\t\t\tif (userName) {\n\t\t\t\tthis.username = userName;\n\t\t\t} else {\n\t\t\t\tconsole.error('Username is required to start an UserAction');\n\t\t\t\tthrow new Error('Username is required to start an UserAction');\n\t\t\t}\n\t\t}\n\t\tget userEndpoint() {\n\t\t\treturn `${this.endpoint}/users/${this.username}`;\n\t\t}\n\t\t//Get userlications or single userlication\n\t\tget() {\n\t\t\treturn this.utils.request.get(this.userEndpoint).then((response) => {\n\t\t\t\tconsole.log('[MatterClient.user().get()] App(s) data loaded:', response);\n\t\t\t\treturn new User(response);\n\t\t\t})['catch']((errRes) => {\n\t\t\t\tconsole.error('[MatterClient.user().get()] Error getting users list: ', errRes);\n\t\t\t\treturn Promise.reject(errRes);\n\t\t\t});\n\t\t}\n\t\t//Update an userlication\n\t\tupdate(userData) {\n\t\t\treturn this.utils.request.put(this.userEndpoint, userData).then((response) => {\n\t\t\t\tconsole.log('[MatterClient.users().update()] App:', response);\n\t\t\t\treturn new User(response);\n\t\t\t})['catch']((errRes) => {\n\t\t\t\tconsole.error('[MatterClient.users().update()] Error updating user: ', errRes);\n\t\t\t\treturn Promise.reject(errRes);\n\t\t\t});\n\t\t}\n\t\t//Delete an userlication\n\t\t//TODO: Only do this.utils.request if deleting personal account\n\t\tdel(userData) {\n\t\t\tconsole.error('Deleting a user is currently disabled.');\n\t\t\t// return this.utils.request.delete(this.endpoint, userData).then((response) => {\n\t\t\t// \tconsole.log('[MatterClient.users().del()] Apps:', response);\n\t\t\t// \treturn new User(response);\n\t\t\t// })['catch']((errRes) => {\n\t\t\t// \tconsole.error('[MatterClient.users().del()] Error deleting user: ', errRes);\n\t\t\t// \treturn Promise.reject(errRes);\n\t\t\t// });\n\t\t}\n\t}\n\n\t//Actions for users list\n\tclass UsersAction extends Matter {\n\t\tconstructor() {\n\t\t\t//Call matter with name and settings\n\t\t\tsuper(config.appName, config.matterOptions);\n\t\t}\n\t\tget usersEndpoint() {\n\t\t\treturn `${this.endpoint}/users`;\n\t\t}\n\t\t//Get users or single application\n\t\tget(query) {\n\t\t\treturn this.utils.request.get(this.usersEndpoint).then((response) => {\n\t\t\t\tconsole.log('[MatterClient.apps().get()] App(s) data loaded:', response);\n\t\t\t\treturn response;\n\t\t\t})['catch']((errRes) => {\n\t\t\t\tconsole.error('[MatterClient.apps().get()] Error getting apps list: ', errRes);\n\t\t\t\treturn Promise.reject(errRes);\n\t\t\t});\n\t\t}\n\t\t//Add an application\n\t\tadd(appData) {\n\t\t\treturn this.utils.request.post(this.usersEndpoint, appData).then((response) => {\n\t\t\t\tconsole.log('[MatterClient.apps().add()] Application added successfully: ', response);\n\t\t\t\treturn new Application(response);\n\t\t\t})['catch']((errRes) => {\n\t\t\t\tconsole.error('[MatterClient.getApps()] Error adding application: ', errRes);\n\t\t\t\treturn Promise.reject(errRes);\n\t\t\t});\n\t\t}\n\t\t//Search with partial of username\n\t\tsearch(query) {\n\t\t\tconsole.log('search called:', query);\n\t\t\tvar searchEndpoint = this.usersEndpoint + '/search/';\n\t\t\tif (query && _.isString(query)) {\n\t\t\t\tsearchEndpoint += query;\n\t\t\t}\n\t\t\tconsole.log('searchEndpoint:', searchEndpoint);\n\t\t\treturn this.utils.request.get(searchEndpoint).then((response) => {\n\t\t\t\tconsole.log('[MatterClient.users().search()] Users(s) data loaded:', response);\n\t\t\t\treturn response;\n\t\t\t})['catch']((errRes) => {\n\t\t\t\tconsole.error('[MatterClient.users().search()] Error getting apps list: ', errRes);\n\t\t\t\treturn Promise.reject(errRes);\n\t\t\t});\n\t\t}\n\t}\n\n\t/**Grout Client Class\n\t * @ description Extending matter provides token storage and login/logout/signup capabilities\n\t */\n\tclass Grout extends Matter {\n\t\t//TODO: Use getter/setter to make this not a function\n\t\tconstructor() {\n\t\t\t//Call matter with tessellate\n\t\t\tsuper(config.appName, config.matterOptions);\n\t\t}\n\t\t//Start a new Apps Action\n\t\tget apps() {\n\t\t\tconsole.log('New AppsAction:', new AppsAction());\n\t\t\treturn new AppsAction();\n\t\t}\n\t\t//Start a new App action\n\t\tapp(appName) {\n\t\t\tconsole.log('New AppAction:', new AppAction(appName));\n\t\t\treturn new AppAction(appName);\n\t\t}\n\t\t//Start a new Users action\n\t\tget users() {\n\t\t\treturn new UsersAction();\n\t\t}\n\t\t//Start a new User action\n\t\tuser(username) {\n\t\t\treturn new UserAction(username);\n\t\t}\n\t};\n\n\treturn Grout;\n\n}));"],"sourceRoot":"/source/"}