{"version":3,"sources":["grout.min.js","/source/grout.js"],"names":["_classCallCheck","instance","Constructor","TypeError","_createClass","defineProperties","target","props","i","length","descriptor","enumerable","configurable","writable","Object","defineProperty","key","protoProps","staticProps","prototype","global","factory","exports","module","require","define","amd","Grout","_","Firebase","superagent","this","handleResponse","req","Promise","resolve","reject","end","err","res","status","console","warn","body","addAuthHeader","storage","getItem","config","tokenName","set","log","setAWSConfig","AWS","update","credentials","CognitoIdentityCredentials","IdentityPoolId","aws","cognito","poolId","region","childrenStructureFromArray","fileArray","mappedStructure","map","file","buildStructureObject","combineLikeObjs","pathArray","has","path","split","Key","pick","name","currentObj","type","finalObj","each","loc","ind","list","first","join","children","$id","mappedArray","takenNames","finishedArray","obj","indexOf","push","likeObj","findWhere","union","serverUrl","fbUrl","params","RoleArn","window","location","hostname","setItem","itemName","itemValue","exists","sessionStorage","removeItem","clear","get","testKey","requester","undefined","error","request","endpoint","queryData","query","post","data","send","put","del","_Application","appData","owner","collaborators","createdAt","updatedAt","frontend","backend","fbRef","value","getFiles","then","filesArray","childStruct","message","bucketName","s3","S3","listParams","Bucket","listObjects","Contents","fileData","saveParams","frontent","Body","content","ACL","contentType","ContentType","putObject","response","errRes","AppAction","appName","Error","app","getStructure","structure","AppsAction","Application","User","userData","username","UserAction","userName","UsersAction","userEndpoint","isString","msg","searchEndpoint","user","token","signupData","loginData","password"],"mappings":"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","file":"grout.min.js","sourcesContent":["function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError(\"Cannot call a class as a function\")}var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,\"value\"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();!function(e,t){\"object\"==typeof exports&&\"undefined\"!=typeof module?module.exports=t(require(\"underscore\"),require(\"firebase\"),require(\"superagent\")):\"function\"==typeof define&&define.amd?define([\"underscore\",\"firebase\",\"superagent\"],t):e.Grout=t(e._,e.Firebase,e.superagent)}(this,function(e,t,n){\"use strict\";function r(e){return new Promise(function(t,n){e.end(function(e,r){return e?(401==e.status&&console.warn(\"Unauthorized. You must be signed into make this request.\"),n(e)):t(r.body)})})}function o(e){return l.getItem(c.tokenName)&&(e=e.set(\"Authorization\",\"Bearer \"+l.getItem(c.tokenName)),console.log(\"Set auth header\")),e}function i(){AWS.config.update({credentials:new AWS.CognitoIdentityCredentials({IdentityPoolId:c.aws.cognito.poolId}),region:c.aws.region})}function s(e){var t=e.map(function(e){return a(e)});return u(t)}function a(t){var n;e.has(t,\"path\")?n=t.path.split(\"/\"):(n=t.Key.split(\"/\"),t=e.pick(t,\"Key\"),t.path=t.Key,t.name=t.Key);var r=t;if(1==n.length)return r.name=n[0],e.has(r,\"type\")||(r.type=\"file\"),r.path=n[0],r;var o={};return e.each(n,function(i,s,a){s!=a.length-1?(r.name=i,r.path=e.first(a,s+1).join(\"/\"),r.type=\"folder\",r.children=[{}],0==s&&(o=r),r=r.children[0]):(r.type=\"file\",r.name=i,r.path=n.join(\"/\"),t.$id&&(r.$id=t.$id))}),o}function u(t){var n=[],r=[];return e.each(t,function(o,i,s){if(-1==n.indexOf(o.name))n.push(o.name),r.push(o);else{var a=e.findWhere(t,{name:o.name});a.children=e.union(o.children,a.children),a.children=u(a.children)}}),r}e=\"default\"in e?e[\"default\"]:e,t=\"default\"in t?t[\"default\"]:t,n=\"default\"in n?n[\"default\"]:n;var c={serverUrl:\"hypercube.elasticbeanstalk.com\",tokenName:\"matter-client\",fbUrl:\"https://pruvit.firebaseio.com/\",aws:{region:\"us-east-1\",cognito:{poolId:\"us-east-1:7f3bc1ff-8484-48dd-9e13-27e5cd3de982\",params:{RoleArn:\"arn:aws:iam::823322155619:role/Cognito_HypercubeTestAuth_Role1\"}}}};\"undefined\"==typeof window||\"\"!=window.location.hostname&&\"localhost\"!=window.location.hostname||(c.serverUrl=\"http://localhost:4000\");var l=Object.defineProperties({setItem:function(e,t){this.exists&&window.sessionStorage.setItem(e,t)},getItem:function(e){return this.exists?(console.log(\"item loaded from session\"),window.sessionStorage.getItem(e)):null},removeItem:function(e){if(this.exists)try{window.sessionStorage.removeItem(e)}catch(t){console.warn(\"Item could not be removed from session storage.\",t)}},clear:function(){if(this.exists)try{window.sessionStorage.clear()}catch(e){console.warn(\"Session storage could not be cleared.\",e)}}},{exists:{get:function(){var e=\"test\";if(console.log(\"storage exists called\"),\"undefined\"==typeof window)return!1;try{return window.sessionStorage.setItem(e,\"1\"),window.sessionStorage.removeItem(e),!0}catch(t){return console.warn(\"Session storage does not exist.\",t),!1}},configurable:!0,enumerable:!0}}),p=void 0;\"undefined\"==typeof window?p=n:\"undefined\"==typeof window.superagent?console.error(\"Superagent is required to use Matter\"):p=window.superagent;var d={get:function(e,t){var n=p.get(e);return t&&n.query(t),n=o(n),r(n)},post:function(e,t){var n=p.post(e).send(t);return n=o(n),r(n)},put:function(e,t){var n=p.put(e).send(t);return n=o(n),r(n)},del:function(e,t){var n=p.put(e).send(t);return n=o(n),r(n)}},f=function(){function e(n){_classCallCheck(this,e),this.name=n.name,this.owner=n.owner||null,this.collaborators=n.collaborators||[],this.createdAt=n.createdAt,this.updatedAt=n.updatedAt,this.frontend=n.frontend||{},this.backend=n.backend||{},t&&(this.fbRef=new t(c.fbUrl+n.name))}return _createClass(e,[{key:\"getStructure\",value:function(){return this.getFiles().then(function(e){var t=s(e);return console.log(\"Child struct from array:\",t),t},function(e){return console.error(\"[Application.getStructure] Error getting files: \",e),Promise.reject({message:\"Error getting files.\",error:e})})}},{key:\"getFiles\",value:function(){if(this.frontend&&this.frontend.bucketName){\"undefined\"!=typeof AWS.config.credentials&&AWS.config.credentials||i();var e=new AWS.S3,t={Bucket:this.frontend.bucketName};return new Promise(function(n,r){e.listObjects(t,function(e,t){return e?(console.error(\"[Application.getObjects()] Error listing objects:\",e),r(e)):(console.log(\"[Application.getObjects()] listObjects returned:\",t),n(t.Contents))})})}return console.error(\"[Applicaiton.getFiles] Attempting to get objects for bucket without name.\"),Promise.reject({message:\"Bucket name required to get objects\"})}},{key:\"publishFile\",value:function(e){if(!this.frontend)return console.error(\"Frontend data not available. Make sure to call .get().\"),Promise.reject({message:\"Front end data is required to publish file.\"});var t={Bucket:this.frontent.bucketName,Key:e.key,Body:e.content,ACL:\"public-read\"};return e.contentType&&(t.ContentType=e.contentType),s3.putObject(t,function(e,t){return e?(console.error(\"[Application.publishFile()] Error saving file:\",e),Promise.reject(e)):(console.log(\"[Application.publishFile()] file saved successfully. Returning:\",t),t)})}},{key:\"addStorage\",value:function(){var t=c.serverUrl+\"/apps/\"+this.name+\"/storage\";return d.post(t,appData).then(function(t){return console.log(\"[Application.addStorage()] Apps:\",t),new e(t)})[\"catch\"](function(e){return console.error(\"[Application.addStorage()] Error getting apps list: \",e),Promise.reject(e)})}},{key:\"applyTemplate\",value:function(){c.serverUrl+\"/apps/\"+this.name+\"/template\";console.log(\"Applying templates to existing\")}}]),e}(),g=function(){function e(t){if(_classCallCheck(this,e),!t)throw console.error(\"Application name is required to start an AppAction\"),new Error(\"Application name is required to start an AppAction\");this.name=t,this.endpoint=c.serverUrl+\"/apps/\"+this.name}return _createClass(e,[{key:\"get\",value:function(){return d.get(this.endpoint).then(function(e){return console.log(\"[MatterClient.app().get()] App(s) data loaded:\",e),new f(e)})[\"catch\"](function(e){return console.error(\"[MatterClient.app().get()] Error getting apps list: \",e),Promise.reject(e)})}},{key:\"update\",value:function(e){return d.put(this.endpoint,e).then(function(e){return console.log(\"[MatterClient.apps().update()] App:\",e),new f(e)})[\"catch\"](function(e){return console.error(\"[MatterClient.apps().update()] Error updating app: \",e),Promise.reject(e)})}},{key:\"del\",value:function(e){return d[\"delete\"](this.endpoint,e).then(function(e){return console.log(\"[MatterClient.apps().del()] Apps:\",e),new f(e)})[\"catch\"](function(e){return console.error(\"[MatterClient.apps().del()] Error deleting app: \",e),Promise.reject(e)})}},{key:\"getFiles\",value:function(){return this.get().then(function(e){e.getFiles().then(function(e){return e})[\"catch\"](function(e){return console.error(\"[MatterClient.app().getFiles()] Error getting application files: \",e),Promise.reject(e)})})[\"catch\"](function(e){return console.error(\"[MatterClient.app().getFiles()] Error getting application: \",e),Promise.reject(e)})}},{key:\"getStructure\",value:function(){return this.get().then(function(e){return e.getStructure().then(function(e){return console.log(\"Structure loaded: \",e),e})[\"catch\"](function(e){return console.error(\"[MatterClient.app().getStructure()] Error getting application structure: \",e),Promise.reject(e)})})[\"catch\"](function(e){return console.error(\"[MatterClient.app().getStructure()] Error getting application: \",e),Promise.reject(e)})}}]),e}(),h=function(){function e(){_classCallCheck(this,e),this.endpoint=c.serverUrl+\"/apps\"}return _createClass(e,[{key:\"get\",value:function(){return d.get(this.endpoint).then(function(e){return console.log(\"[MatterClient.apps().get()] App(s) data loaded:\",e),e})[\"catch\"](function(e){return console.error(\"[MatterClient.apps().get()] Error getting apps list: \",e),Promise.reject(e)})}},{key:\"add\",value:function(e){return d.post(this.endpoint,e).then(function(e){return console.log(\"[MatterClient.apps().add()] Application added successfully: \",e),new Application(e)})[\"catch\"](function(e){return console.error(\"[MatterClient.getApps()] Error adding application: \",e),Promise.reject(e)})}}]),e}(),m=function(){function e(t){_classCallCheck(this,e),this.name=t.name,this.username=t.username,this.createdAt=t.createdAt,this.updatedAt=t.updatedAt}return _createClass(e,[{key:\"app\",value:function(e){return new g(e)}},{key:\"apps\",get:function(){return new h}}]),e}(),y=function(){function e(t){if(_classCallCheck(this,e),!t)throw console.error(\"Username is required to start an UserAction\"),new Error(\"Username is required to start an UserAction\");this.name=t,this.endpoint=c.serverUrl+\"/users/\"+this.name}return _createClass(e,[{key:\"get\",value:function(){return d.get(this.endpoint).then(function(e){return console.log(\"[MatterClient.user().get()] App(s) data loaded:\",e),new m(e)})[\"catch\"](function(e){return console.error(\"[MatterClient.user().get()] Error getting users list: \",e),Promise.reject(e)})}},{key:\"update\",value:function(e){return d.put(this.endpoint,e).then(function(e){return console.log(\"[MatterClient.users().update()] App:\",e),new m(e)})[\"catch\"](function(e){return console.error(\"[MatterClient.users().update()] Error updating user: \",e),Promise.reject(e)})}},{key:\"del\",value:function(e){console.error(\"Deleting a user is currently disabled.\")}}]),e}(),w=function(){function t(){_classCallCheck(this,t),this.endpoint=c.serverUrl+\"/users\"}return _createClass(t,[{key:\"get\",value:function(t){var n=this.endpoint;if(t&&!e.isString(t)){var r=\"Get only handles username as a string\";return console.error(r),Promise.reject({message:r})}return t&&(n=n+\"/\"+t),d.get(n).then(function(e){return console.log(\"[MatterClient.apps().get()] App(s) data loaded:\",e),e})[\"catch\"](function(e){return console.error(\"[MatterClient.apps().get()] Error getting apps list: \",e),Promise.reject(e)})}},{key:\"add\",value:function(e){return d.post(this.endpoint,e).then(function(e){return console.log(\"[MatterClient.apps().add()] Application added successfully: \",e),new Application(e)})[\"catch\"](function(e){return console.error(\"[MatterClient.getApps()] Error adding application: \",e),Promise.reject(e)})}},{key:\"search\",value:function(t){console.log(\"search called:\",t);var n=this.endpoint+\"/search/\";return t&&e.isString(t)&&(n+=t),console.log(\"searchEndpoint:\",n),d.get(n).then(function(e){return console.log(\"[MatterClient.users().search()] Users(s) data loaded:\",e),e})[\"catch\"](function(e){return console.error(\"[MatterClient.users().search()] Error getting apps list: \",e),Promise.reject(e)})}}]),t}(),v=void 0,k=void 0,C=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:\"signup\",value:function(e){return d.post(c.serverUrl+\"/signup\",e).then(function(e){return console.log(e),e})[\"catch\"](function(e){return console.error(\"[Grout.signup()] Error signing up:\",e),Promise.reject(e)})}},{key:\"login\",value:function(e){return e&&e.password&&e.username?d.put(c.serverUrl+\"/login\",e).then(function(e){return console.log(\"[Grout.login()]: Login response: \",e),k=e.token,null===l.getItem(c.tokenName)&&(l.setItem(c.tokenName,e.token),console.log(\"[Grout.login()]: token set to storage:\",l.getItem(c.tokenName))),e})[\"catch\"](function(e){return console.error(\"[Grout.login()] Error logging in: \",e),Promise.reject(e)}):(console.error(\"Username/Email and Password are required to login.\"),Promise.reject({message:\"Username/Email and Password are required to login.\"}))}},{key:\"logout\",value:function(){return d.put(c.serverUrl+\"/logout\",{}).then(function(e){return console.log(\"[Grout.logout()] Logout successful: \",e),\"undefined\"!=typeof window&&null!=typeof l.getItem(c.tokenName)&&l.clear(),e.body})[\"catch\"](function(e){return e.status&&401==e.status?void(\"undefined\"!=typeof window&&null!=l.getItem(c.tokenName)&&l.clear()):(console.error(\"[Grout.logout()] Error logging out: \",e),Promise.reject(e))})}},{key:\"getCurrentUser\",value:function(){return d.get(c.serverUrl+\"/user\",{}).then(function(e){return console.log(\"[Grout.getCurrentUser()] Current User:\",e),v=e})[\"catch\"](function(e){return console.error(\"[Grout.getCurrentUser()] Error getting current user: \",e),Promise.reject(e)})}},{key:\"getAuthToken\",value:function(){return\"undefined\"==typeof window||\"undefined\"==typeof l.getItem(c.tokenName)?null:l.getItem(c.tokenName)}},{key:\"app\",value:function(e){return console.log(\"New AppAction:\",new g(e)),new g(e)}},{key:\"user\",value:function(e){return new y(e)}},{key:\"apps\",get:function(){return console.log(\"New AppsAction:\",new h),new h}},{key:\"users\",get:function(){return new w}}]),e}();return C});\n//# sourceMappingURL=grout.min.js.map","(function (global, factory) {\n\ttypeof exports === 'object' && typeof module !== 'undefined' ? module.exports = factory(require('underscore'), require('firebase'), require('superagent')) :\n\ttypeof define === 'function' && define.amd ? define(['underscore', 'firebase', 'superagent'], factory) :\n\tglobal.Grout = factory(global._,global.Firebase,global.superagent);\n}(this, function (_,Firebase,superagent) { 'use strict';\n\n\t_ = 'default' in _ ? _['default'] : _;\n\tFirebase = 'default' in Firebase ? Firebase['default'] : Firebase;\n\tsuperagent = 'default' in superagent ? superagent['default'] : superagent;\n\n\tlet config = {\n\t\tserverUrl: 'hypercube.elasticbeanstalk.com',\n\t\ttokenName: 'matter-client',\n\t\tfbUrl: 'https://pruvit.firebaseio.com/',\n\t\taws: {\n\t\t\tregion: 'us-east-1',\n\t\t\tcognito: {\n\t\t\t\tpoolId: 'us-east-1:7f3bc1ff-8484-48dd-9e13-27e5cd3de982',\n\t\t\t\tparams: {\n\t\t\t\t\tRoleArn: 'arn:aws:iam::823322155619:role/Cognito_HypercubeTestAuth_Role1'\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t};\n\t//Set server to local server if developing\n\tif (typeof window != 'undefined' && (window.location.hostname == '' || window.location.hostname == 'localhost')) {\n\t\tconfig.serverUrl = 'http://localhost:4000';\n\t}\n\n\tlet storage = {\n\t\tget exists() {\n\t\t\tconst testKey = 'test';\n\t\t\tconsole.log('storage exists called');\n\t\t\tif (typeof window != 'undefined') {\n\t\t\t\ttry {\n\t\t\t\t\twindow.sessionStorage.setItem(testKey, '1');\n\t\t\t\t\twindow.sessionStorage.removeItem(testKey);\n\t\t\t\t\treturn true;\n\t\t\t\t} catch (err) {\n\t\t\t\t\tconsole.warn('Session storage does not exist.', err);\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t},\n\t\t/**\n\t\t * @description\n\t\t * Safley sets item to session storage.\n\t\t *\n\t\t * @param {String} itemName The items name\n\t\t * @param {String} itemValue The items value\n\t\t *\n\t\t *  @private\n\t\t */\n\t\tsetItem(itemName, itemValue) {\n\t\t\t//TODO: Handle itemValue being an object instead of a string\n\t\t\tif (this.exists) {\n\t\t\t\twindow.sessionStorage.setItem(itemName, itemValue);\n\t\t\t}\n\t\t},\n\t\t/**\n\t\t * @description\n\t\t * Safley gets an item from session storage.\n\t\t *\n\t\t * @param {String} itemName The items name\n\t\t *\n\t\t * @return {String}\n\t\t *\n\t\t */\n\t\tgetItem(itemName) {\n\t\t\tif (this.exists) {\n\t\t\t\tconsole.log('item loaded from session');\n\t\t\t\treturn window.sessionStorage.getItem(itemName);\n\t\t\t}\n\t\t\treturn null;\n\t\t},\n\t\t/**\n\t\t * @description\n\t\t * Safley removes item from session storage.\n\t\t *\n\t\t * @param {String} itemName - The items name\n\t\t *\n\t\t */\n\t\tremoveItem(itemName) {\n\t\t\t//TODO: Only remove used items\n\t\t\tif (this.exists) {\n\t\t\t\ttry {\n\t\t\t\t\t//Clear session storage\n\t\t\t\t\twindow.sessionStorage.removeItem(itemName);\n\t\t\t\t} catch (err) {\n\t\t\t\t\tconsole.warn('Item could not be removed from session storage.', err);\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\t/**\n\t\t * @description\n\t\t * Safley removes item from session storage.\n\t\t *\n\t\t * @param {String} itemName the items name\n\t\t * @param {String} itemValue the items value\n\t\t *\n\t\t *  @private\n\t\t */\n\t\tclear() {\n\t\t\t//TODO: Only remove used items\n\t\t\tif (this.exists) {\n\t\t\t\ttry {\n\t\t\t\t\t\t//Clear session storage\n\t\t\t\t\twindow.sessionStorage.clear();\n\t\t\t\t} catch (err) {\n\t\t\t\t\tconsole.warn('Session storage could not be cleared.', err);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t};\n\n\tlet requester;\n\tif (typeof window == 'undefined') { //Node Mode\n\t\trequester = superagent;\n\t} else if (typeof window.superagent == 'undefined') {\n\t\tconsole.error('Superagent is required to use Matter');\n\t} else { //Browser mode\n\t\trequester = window.superagent;\n\t}\n\n\tlet request = {\n\t\tget(endpoint, queryData) {\n\t\t\tvar req = requester.get(endpoint);\n\t\t\tif (queryData) {\n\t\t\t\treq.query(queryData);\n\t\t\t}\n\t\t\treq = addAuthHeader(req);\n\t\t\treturn handleResponse(req);\n\t\t},\n\t\tpost(endpoint, data) {\n\t\t\tvar req = requester.post(endpoint).send(data);\n\t\t\treq = addAuthHeader(req);\n\t\t\treturn handleResponse(req);\n\t\t},\n\t\tput(endpoint, data) {\n\t\t\tvar req = requester.put(endpoint).send(data);\n\t\t\treq = addAuthHeader(req);\n\t\t\treturn handleResponse(req);\n\t\t},\n\t\tdel(endpoint, data) {\n\t\t\tvar req = requester.put(endpoint).send(data);\n\t\t\treq = addAuthHeader(req);\n\t\t\treturn handleResponse(req);\n\t\t}\n\n\t};\n\n\tfunction handleResponse(req) {\n\t\treturn new Promise((resolve, reject) => {\n\t\t\treq.end((err, res) => {\n\t\t\t\tif (!err) {\n\t\t\t\t\t// console.log('Response:', res);\n\t\t\t\t\treturn resolve(res.body);\n\t\t\t\t} else {\n\t\t\t\t\tif (err.status == 401) {\n\t\t\t\t\t\tconsole.warn('Unauthorized. You must be signed into make this request.');\n\t\t\t\t\t}\n\t\t\t\t\treturn reject(err);\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t}\n\tfunction addAuthHeader(req) {\n\t\tif (storage.getItem(config.tokenName)) {\n\t\t\treq = req.set('Authorization', 'Bearer ' + storage.getItem(config.tokenName));\n\t\t\tconsole.log('Set auth header');\n\t\t}\n\t\treturn req;\n\t}\n\n\t/**\n\t * Application class.\n\t *\n\t */\n\tclass _Application {\n\t\tconstructor(appData) {\n\t\t\tthis.name = appData.name;\n\t\t\tthis.owner = appData.owner || null;\n\t\t\tthis.collaborators = appData.collaborators || [];\n\t\t\tthis.createdAt = appData.createdAt;\n\t\t\tthis.updatedAt = appData.updatedAt;\n\t\t\tthis.frontend = appData.frontend || {};\n\t\t\tthis.backend = appData.backend || {};\n\t\t\tif (Firebase) {\n\t\t\t\tthis.fbRef = new Firebase(config.fbUrl + appData.name);\n\t\t\t}\n\t\t}\n\t\t//Get files list and convert to structure\n\t\tgetStructure() {\n\t\t\treturn this.getFiles().then((filesArray) => {\n\t\t\t\tconst childStruct = childrenStructureFromArray(filesArray);\n\t\t\t\tconsole.log('Child struct from array:', childStruct);\n\t\t\t\treturn childStruct;\n\t\t\t}, (err) => {\n\t\t\t\tconsole.error('[Application.getStructure] Error getting files: ', err);\n\t\t\t\treturn Promise.reject({message: 'Error getting files.', error: err});\n\t\t\t});\n\t\t}\n\t\t//Get files list from S3\n\t\tgetFiles() {\n\t\t\tif (!this.frontend || !this.frontend.bucketName) {\n\t\t\t\tconsole.error('[Applicaiton.getFiles] Attempting to get objects for bucket without name.');\n\t\t\t\treturn Promise.reject({message: 'Bucket name required to get objects'});\n\t\t\t} else {\n\t\t\t\t//If AWS Credential do not exist, set them\n\t\t\t\tif (typeof AWS.config.credentials == 'undefined' || !AWS.config.credentials) {\n\t\t\t\t\t// console.info('AWS creds are being updated to make request');\n\t\t\t\t\tsetAWSConfig();\n\t\t\t\t}\n\t\t\t\tvar s3 = new AWS.S3();\n\t\t\t\tvar listParams = {Bucket: this.frontend.bucketName};\n\t\t\t\treturn new Promise((resolve, reject) => {\n\t\t\t\t\ts3.listObjects(listParams, function(err, data) {\n\t\t\t\t\t\tif (!err) {\n\t\t\t\t\t\t\tconsole.log('[Application.getObjects()] listObjects returned:', data);\n\t\t\t\t\t\t\treturn resolve(data.Contents);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tconsole.error('[Application.getObjects()] Error listing objects:', err);\n\t\t\t\t\t\t\treturn reject(err);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t\tpublishFile(fileData) {\n\t\t\tif (!this.frontend) {\n\t\t\t\tconsole.error('Frontend data not available. Make sure to call .get().');\n\t\t\t\treturn Promise.reject({message: 'Front end data is required to publish file.'});\n\t\t\t}\n\t\t\tvar saveParams = {Bucket: this.frontent.bucketName, Key: fileData.key,  Body: fileData.content, ACL: 'public-read'};\n\t\t\t//Set contentType from fileData to ContentType parameter of new object\n\t\t\tif (fileData.contentType) {\n\t\t\t\tsaveParams.ContentType = fileData.contentType;\n\t\t\t}\n\t\t\t// console.log('[$aws.$saveFiles] saveParams:', saveParams);\n\t\t\treturn s3.putObject(saveParams, function(err, data) {\n\t\t\t\t//[TODO] Add putting object ACL (make public)\n\t\t\t\tif (!err) {\n\t\t\t\t\tconsole.log('[Application.publishFile()] file saved successfully. Returning:', data);\n\t\t\t\t\treturn data;\n\t\t\t\t}\telse {\n\t\t\t\t\tconsole.error('[Application.publishFile()] Error saving file:', err);\n\t\t\t\t\treturn Promise.reject(err);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\taddStorage() {\n\t\t\t//TODO:Add storage bucket\n\t\t\tvar endpoint = config.serverUrl + '/apps/' + this.name + '/storage';\n\t\t\treturn request.post(endpoint, appData).then((response) => {\n\t\t\t\tconsole.log('[Application.addStorage()] Apps:', response);\n\t\t\t\treturn new _Application(response);\n\t\t\t})['catch']((errRes) => {\n\t\t\t\tconsole.error('[Application.addStorage()] Error getting apps list: ', errRes);\n\t\t\t\treturn Promise.reject(errRes);\n\t\t\t});\n\t\t}\n\t\tapplyTemplate() {\n\t\t\tvar endpoint = config.serverUrl + '/apps/' + this.name + '/template';\n\t\t\tconsole.log('Applying templates to existing');\n\t\t\t// return request.post(endpoint, appData).then(function(response) {\n\t\t\t// \tconsole.log('[Application.addStorage()] Apps:', response);\n\t\t\t// \tif (!apps.isList) {\n\t\t\t// \t\treturn new Application(response);\n\t\t\t// \t}\n\t\t\t// \treturn response;\n\t\t\t// })['catch'](function(errRes) {\n\t\t\t// \tconsole.error('[Application.addStorage()] Error getting apps list: ', errRes);\n\t\t\t// \treturn Promise.reject(errRes);\n\t\t\t// });\n\t\t}\n\t}\n\n\t//------------------ Utility Functions ------------------//\n\n\t// AWS Config\n\tfunction setAWSConfig() {\n\t\tAWS.config.update({\n\t\t  credentials: new AWS.CognitoIdentityCredentials({\n\t\t  IdentityPoolId: config.aws.cognito.poolId\n\t\t  }),\n\t\t  region: config.aws.region\n\t\t});\n\t}\n\n\t//Convert from array file structure (from S3) to 'children' structure used in Editor GUI (angular-tree-control)\n\t//Examples for two files (index.html and /testFolder/file.js):\n\t//Array structure: [{path:'index.html'}, {path:'testFolder/file.js'}]\n\t//Children Structure [{type:'folder', name:'testfolder', children:[{path:'testFolder/file.js', name:'file.js', filetype:'javascript', contentType:'application/javascript'}]}]\n\tfunction childrenStructureFromArray(fileArray) {\n\t\t// console.log('childStructureFromArray called:', fileArray);\n\t\t//Create a object for each file that stores the file in the correct 'children' level\n\t\tvar mappedStructure = fileArray.map(function(file) {\n\t\t\treturn buildStructureObject(file);\n\t\t});\n\t\treturn combineLikeObjs(mappedStructure);\n\t}\n\t//Convert file with key into a folder/file children object\n\tfunction buildStructureObject(file) {\n\t\tvar pathArray;\n\t\t// console.log('buildStructureObject with:', file);\n\t\tif (_.has(file, 'path')) {\n\t\t\t//Coming from files already having path (structure)\n\t\t\tpathArray = file.path.split('/');\n\t\t} else {\n\t\t\t//Coming from aws\n\t\t\tpathArray = file.Key.split('/');\n\t\t\t// console.log('file before pick:', file);\n\t\t\tfile = _.pick(file, 'Key');\n\t\t\tfile.path = file.Key;\n\t\t\tfile.name = file.Key;\n\t\t}\n\t\tvar currentObj = file;\n\t\tif (pathArray.length == 1) {\n\t\t\tcurrentObj.name = pathArray[0];\n\t\t\tif (!_.has(currentObj,'type')) {\n\t\t\t\tcurrentObj.type = 'file';\n\t\t\t}\n\t\t\tcurrentObj.path = pathArray[0];\n\t\t\treturn currentObj;\n\t\t} else {\n\t\t\tvar finalObj = {};\n\t\t\t_.each(pathArray, (loc, ind, list) => {\n\t\t\t\tif (ind != list.length - 1) {//Not the last loc\n\t\t\t\t\tcurrentObj.name = loc;\n\t\t\t\t\tcurrentObj.path = _.first(list, ind + 1).join('/');\n\t\t\t\t\tcurrentObj.type = 'folder';\n\t\t\t\t\tcurrentObj.children = [{}];\n\t\t\t\t\t//TODO: Find out why this works\n\t\t\t\t\tif (ind == 0) {\n\t\t\t\t\t\tfinalObj = currentObj;\n\t\t\t\t\t}\n\t\t\t\t\tcurrentObj = currentObj.children[0];\n\t\t\t\t} else {\n\t\t\t\t\tcurrentObj.type = 'file';\n\t\t\t\t\tcurrentObj.name = loc;\n\t\t\t\t\tcurrentObj.path = pathArray.join('/');\n\t\t\t\t\tif (file.$id) {\n\t\t\t\t\t\tcurrentObj.$id = file.$id;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t\treturn finalObj;\n\t\t}\n\t}\n\t//Recursivley combine children of object's that have the same names\n\tfunction combineLikeObjs(mappedArray) {\n\t\tvar takenNames = [];\n\t\tvar finishedArray = [];\n\t\t_.each(mappedArray, (obj, ind, list) => {\n\t\t\tif (takenNames.indexOf(obj.name) == -1) {\n\t\t\t\ttakenNames.push(obj.name);\n\t\t\t\tfinishedArray.push(obj);\n\t\t\t} else {\n\t\t\t\tvar likeObj = _.findWhere(mappedArray, {name: obj.name});\n\t\t\t\t//Combine children of like objects\n\t\t\t\tlikeObj.children = _.union(obj.children, likeObj.children);\n\t\t\t\tlikeObj.children = combineLikeObjs(likeObj.children);\n\t\t\t\t// console.log('extended obj:',likeObj);\n\t\t\t}\n\t\t});\n\t\treturn finishedArray;\n\t}\n\n\t//Actions for specific application\n\tclass AppAction {\n\t\tconstructor(appName) {\n\t\t\tif (appName) {\n\t\t\t\tthis.name = appName;\n\t\t\t\tthis.endpoint = `${config.serverUrl}/apps/${this.name}`;\n\t\t\t} else {\n\t\t\t\tconsole.error('Application name is required to start an AppAction');\n\t\t\t\tthrow new Error('Application name is required to start an AppAction');\n\t\t\t}\n\t\t}\n\t\t//Get applications or single application\n\t\tget() {\n\t\t\treturn request.get(this.endpoint).then((response) => {\n\t\t\t\tconsole.log('[MatterClient.app().get()] App(s) data loaded:', response);\n\t\t\t\treturn new _Application(response);\n\t\t\t})['catch']((errRes) => {\n\t\t\t\tconsole.error('[MatterClient.app().get()] Error getting apps list: ', errRes);\n\t\t\t\treturn Promise.reject(errRes);\n\t\t\t});\n\t\t}\n\t\t//Update an application\n\t\tupdate(appData) {\n\t\t\treturn request.put(this.endpoint, appData).then((response) => {\n\t\t\t\tconsole.log('[MatterClient.apps().update()] App:', response);\n\t\t\t\treturn new _Application(response);\n\t\t\t})['catch']((errRes) => {\n\t\t\t\tconsole.error('[MatterClient.apps().update()] Error updating app: ', errRes);\n\t\t\t\treturn Promise.reject(errRes);\n\t\t\t});\n\t\t}\n\t\t//Delete an application\n\t\tdel(appData) {\n\t\t\treturn request.delete(this.endpoint, appData).then((response) => {\n\t\t\t\tconsole.log('[MatterClient.apps().del()] Apps:', response);\n\t\t\t\treturn new _Application(response);\n\t\t\t})['catch']((errRes) => {\n\t\t\t\tconsole.error('[MatterClient.apps().del()] Error deleting app: ', errRes);\n\t\t\t\treturn Promise.reject(errRes);\n\t\t\t});\n\t\t}\n\t\tgetFiles() {\n\t\t\treturn this.get().then((app) => {\n\t\t\t\tapp.getFiles().then((filesArray)=> {\n\t\t\t\t\treturn filesArray;\n\t\t\t\t})['catch']((err) => {\n\t\t\t\t\tconsole.error('[MatterClient.app().getFiles()] Error getting application files: ', err);\n\t\t\t\t\treturn Promise.reject(err);\n\t\t\t\t});\n\t\t\t})['catch']((err) => {\n\t\t\t\tconsole.error('[MatterClient.app().getFiles()] Error getting application: ', err);\n\t\t\t\treturn Promise.reject(err);\n\t\t\t});\n\t\t}\n\n\t\tgetStructure() {\n\t\t\treturn this.get().then((app) => {\n\t\t\t\treturn app.getStructure().then((structure)=> {\n\t\t\t\t\tconsole.log('Structure loaded: ', structure);\n\t\t\t\t\treturn structure;\n\t\t\t\t})['catch']((err) => {\n\t\t\t\t\tconsole.error('[MatterClient.app().getStructure()] Error getting application structure: ', err);\n\t\t\t\t\treturn Promise.reject(err);\n\t\t\t\t});\n\t\t\t})['catch']((err) => {\n\t\t\t\tconsole.error('[MatterClient.app().getStructure()] Error getting application: ', err);\n\t\t\t\treturn Promise.reject(err);\n\t\t\t});\n\t\t}\n\t}\n\n\t//Actions for applications list\n\tclass AppsAction {\n\t\tconstructor() {\n\t\t\tthis.endpoint = config.serverUrl + '/apps';\n\t\t}\n\t\t//Get applications or single application\n\t\tget() {\n\t\t\treturn request.get(this.endpoint).then((response) => {\n\t\t\t\tconsole.log('[MatterClient.apps().get()] App(s) data loaded:', response);\n\t\t\t\treturn response;\n\t\t\t})['catch']((errRes) => {\n\t\t\t\tconsole.error('[MatterClient.apps().get()] Error getting apps list: ', errRes);\n\t\t\t\treturn Promise.reject(errRes);\n\t\t\t});\n\t\t}\n\t\t//Add an application\n\t\tadd(appData) {\n\t\t\treturn request.post(this.endpoint, appData).then((response) => {\n\t\t\t\tconsole.log('[MatterClient.apps().add()] Application added successfully: ', response);\n\t\t\t\treturn new Application(response);\n\t\t\t})['catch']((errRes) => {\n\t\t\t\tconsole.error('[MatterClient.getApps()] Error adding application: ', errRes);\n\t\t\t\treturn Promise.reject(errRes);\n\t\t\t});\n\t\t}\n\t}\n\n\t/**\n\t * User class.\n\t *\n\t */\n\tclass User {\n\t\tconstructor(userData) {\n\t\t\tthis.name = userData.name;\n\t\t\tthis.username = userData.username;\n\t\t\tthis.createdAt = userData.createdAt;\n\t\t\tthis.updatedAt = userData.updatedAt;\n\t\t}\n\t\tget apps() {\n\t\t\treturn new AppsAction();\n\t\t}\n\t\tapp(appName) {\n\t\t\t//TODO: Attach owner as well ?\n\t\t\treturn new AppAction(appName);\n\t\t}\n\t}\n\n\t//Actions for specific user\n\tclass UserAction {\n\t\tconstructor(userName) {\n\t\t\tif (userName) {\n\t\t\t\tthis.name = userName;\n\t\t\t\tthis.endpoint = `${config.serverUrl}/users/${this.name}`;\n\t\t\t} else {\n\t\t\t\tconsole.error('Username is required to start an UserAction');\n\t\t\t\tthrow new Error('Username is required to start an UserAction');\n\t\t\t}\n\t\t}\n\t\t//Get userlications or single userlication\n\t\tget() {\n\t\t\treturn request.get(this.endpoint).then((response) => {\n\t\t\t\tconsole.log('[MatterClient.user().get()] App(s) data loaded:', response);\n\t\t\t\treturn new User(response);\n\t\t\t})['catch']((errRes) => {\n\t\t\t\tconsole.error('[MatterClient.user().get()] Error getting users list: ', errRes);\n\t\t\t\treturn Promise.reject(errRes);\n\t\t\t});\n\t\t}\n\t\t//Update an userlication\n\t\tupdate(userData) {\n\t\t\treturn request.put(this.endpoint, userData).then((response) => {\n\t\t\t\tconsole.log('[MatterClient.users().update()] App:', response);\n\t\t\t\treturn new User(response);\n\t\t\t})['catch']((errRes) => {\n\t\t\t\tconsole.error('[MatterClient.users().update()] Error updating user: ', errRes);\n\t\t\t\treturn Promise.reject(errRes);\n\t\t\t});\n\t\t}\n\t\t//Delete an userlication\n\t\t//TODO: Only do request if deleting personal account\n\t\tdel(userData) {\n\t\t\tconsole.error('Deleting a user is currently disabled.');\n\t\t\t// return request.delete(this.endpoint, userData).then((response) => {\n\t\t\t// \tconsole.log('[MatterClient.users().del()] Apps:', response);\n\t\t\t// \treturn new User(response);\n\t\t\t// })['catch']((errRes) => {\n\t\t\t// \tconsole.error('[MatterClient.users().del()] Error deleting user: ', errRes);\n\t\t\t// \treturn Promise.reject(errRes);\n\t\t\t// });\n\t\t}\n\t}\n\n\t//Actions for applications list\n\tclass UsersAction {\n\t\tconstructor() {\n\t\t\tthis.endpoint = config.serverUrl + '/users';\n\t\t}\n\t\t//Get applications or single application\n\t\tget(query) {\n\t\t\tlet userEndpoint = this.endpoint;\n\t\t\tif (query && !_.isString(query)) {\n\t\t\t\tconst msg = 'Get only handles username as a string';\n\t\t\t\tconsole.error(msg);\n\t\t\t\treturn Promise.reject({message: msg});\n\t\t\t}\n\t\t\tif (query) {\n\t\t\t userEndpoint = userEndpoint + '/' + query;\n\t\t\t}\n\t\t\treturn request.get(userEndpoint).then((response) => {\n\t\t\t\tconsole.log('[MatterClient.apps().get()] App(s) data loaded:', response);\n\t\t\t\treturn response;\n\t\t\t})['catch']((errRes) => {\n\t\t\t\tconsole.error('[MatterClient.apps().get()] Error getting apps list: ', errRes);\n\t\t\t\treturn Promise.reject(errRes);\n\t\t\t});\n\t\t}\n\t\t//Add an application\n\t\tadd(appData) {\n\t\t\treturn request.post(this.endpoint, appData).then((response) => {\n\t\t\t\tconsole.log('[MatterClient.apps().add()] Application added successfully: ', response);\n\t\t\t\treturn new Application(response);\n\t\t\t})['catch']((errRes) => {\n\t\t\t\tconsole.error('[MatterClient.getApps()] Error adding application: ', errRes);\n\t\t\t\treturn Promise.reject(errRes);\n\t\t\t});\n\t\t}\n\t\t//Search with partial of username\n\t\tsearch(query) {\n\t\t\tconsole.log('search called:', query);\n\t\t\tvar searchEndpoint = this.endpoint + '/search/';\n\t\t\tif (query && _.isString(query)) {\n\t\t\t\tsearchEndpoint += query;\n\t\t\t}\n\t\t\tconsole.log('searchEndpoint:', searchEndpoint);\n\t\t\treturn request.get(searchEndpoint).then((response) => {\n\t\t\t\tconsole.log('[MatterClient.users().search()] Users(s) data loaded:', response);\n\t\t\t\treturn response;\n\t\t\t})['catch']((errRes) => {\n\t\t\t\tconsole.error('[MatterClient.users().search()] Error getting apps list: ', errRes);\n\t\t\t\treturn Promise.reject(errRes);\n\t\t\t});\n\t\t}\n\t}\n\n\tlet user;\n\tlet token;\n\n\t//Matter Client Class\n\tclass Grout {\n\t\t//Signup a new user\n\t\tsignup(signupData) {\n\t\t\treturn request.post(config.serverUrl + '/signup', signupData)\n\t\t\t.then((response) => {\n\t\t\t  console.log(response);\n\t\t\t  return response;\n\t\t\t})\n\t\t\t['catch']((errRes) => {\n\t\t\t  console.error('[Grout.signup()] Error signing up:', errRes);\n\t\t\t  return Promise.reject(errRes);\n\t\t\t});\n\t\t}\n\n\t\t//Login a user\n\t\tlogin(loginData) {\n\t\t\tif (!loginData || !loginData.password || !loginData.username) {\n\t\t\t\tconsole.error('Username/Email and Password are required to login.');\n\t\t\t\treturn Promise.reject({message: 'Username/Email and Password are required to login.'});\n\t\t\t}\n\t\t\treturn request.put(config.serverUrl + '/login', loginData)\n\t\t\t.then((response) => {\n\t\t\t\t//TODO: Save token locally\n\t\t\t\tconsole.log('[Grout.login()]: Login response: ', response);\n\t\t\t\ttoken = response.token;\n\t\t\t\tif (storage.getItem(config.tokenName) === null) {\n\t\t\t\t\tstorage.setItem(config.tokenName, response.token);\n\t\t\t\t\tconsole.log('[Grout.login()]: token set to storage:', storage.getItem(config.tokenName));\n\t\t\t\t}\n\t\t\t\treturn response;\n\t\t\t})['catch']((errRes) => {\n\t\t\t\tconsole.error('[Grout.login()] Error logging in: ', errRes);\n\t\t\t\treturn Promise.reject(errRes);\n\t\t\t});\n\t\t}\n\n\t\tlogout() {\n\t\t\treturn request.put(config.serverUrl + '/logout', {\n\t\t\t}).then(function(response) {\n\t\t\t  console.log('[Grout.logout()] Logout successful: ', response);\n\t\t\t  if (typeof window != 'undefined' && typeof storage.getItem(config.tokenName) != null) {\n\t\t\t\t\t//Clear session storage\n\t\t\t\t\tstorage.clear();\n\t\t\t\t}\n\t\t\t\treturn response.body;\n\t\t\t})['catch'](function(errRes) {\n\t\t\t\tif (errRes.status && errRes.status == 401) {\n\t\t\t\t\tif (typeof window != 'undefined' && storage.getItem(config.tokenName) != null) {\n\t\t\t\t\t\t//Clear session storage\n\t\t\t\t\t\tstorage.clear();\n\t\t\t\t\t}\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tconsole.error('[Grout.logout()] Error logging out: ', errRes);\n\t\t\t\treturn Promise.reject(errRes);\n\t\t\t});\n\t\t}\n\n\t\tgetCurrentUser() {\n\t\t\t//TODO: Check Current user variable\n\t\t\treturn request.get(config.serverUrl + '/user', {\n\t\t\t}).then(function(response) {\n\t\t\t\t//TODO: Save user information locally\n\t\t\t\tconsole.log('[Grout.getCurrentUser()] Current User:', response);\n\t\t\t\tuser = response;\n\t\t\t\treturn user;\n\t\t\t})['catch'](function(errRes) {\n\t\t\t\tconsole.error('[Grout.getCurrentUser()] Error getting current user: ', errRes);\n\t\t\t\treturn Promise.reject(errRes);\n\t\t\t});\n\t\t}\n\n\t\tgetAuthToken() {\n\t\t\tif (typeof window == 'undefined' || typeof storage.getItem(config.tokenName) == 'undefined') {\n\t\t\t\treturn null;\n\t\t\t}\n\t\t\treturn storage.getItem(config.tokenName);\n\t\t}\n\t\t//TODO: Use getter/setter to make this not a function\n\t\t//Start a new AppsAction\n\t\tget apps() {\n\t\t\tconsole.log('New AppsAction:', new AppsAction());\n\t\t\treturn new AppsAction();\n\t\t}\n\t\t//Start a new app action\n\t\tapp(appName) {\n\t\t\tconsole.log('New AppAction:', new AppAction(appName));\n\t\t\treturn new AppAction(appName);\n\t\t}\n\n\t\tget users() {\n\t\t\treturn new UsersAction();\n\t\t}\n\t\tuser(username) {\n\t\t\treturn new UserAction(username);\n\t\t}\n\t};\n\n\treturn Grout;\n\n}));"],"sourceRoot":"/source/"}