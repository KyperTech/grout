{"version":3,"sources":["grout.min.js","/source/grout.js"],"names":["_inherits","subClass","superClass","TypeError","prototype","Object","create","constructor","value","enumerable","writable","configurable","setPrototypeOf","__proto__","_classCallCheck","instance","Constructor","_get","_x","_x2","_x3","_again","object","property","receiver","desc","parent","getter","undefined","Function","getOwnPropertyDescriptor","get","call","getPrototypeOf","_createClass","defineProperties","target","props","i","length","descriptor","defineProperty","key","protoProps","staticProps","global","factory","exports","module","require","define","amd","Grout","_","jwtDecode","superagent","Firebase","this","buildMessageArgs","logData","msgStr","msgObj","isObject","has","obj","func","file","each","omit","keys","ind","list","isString","msg","decodeToken","tokenStr","tokenData","err","____logger","error","description","data","Error","handleResponse","req","Promise","resolve","reject","end","res","status","console","warn","body","addAuthHeader","token","string","set","info","message","setAWSConfig","AWS","config","update","credentials","CognitoIdentityCredentials","IdentityPoolId","aws","cognito","poolId","region","childrenStructureFromArray","fileArray","mappedStructure","map","buildStructureObject","combineLikeObjs","pathArray","path","split","Key","pick","name","currentObj","type","finalObj","loc","first","join","children","$id","mappedArray","takenNames","finishedArray","indexOf","push","likeObj","findWhere","union","_config","serverUrl","tokenName","tokenDataName","tokenUserDataName","log","msgArgs","envName","apply","debug","storage","item","itemName","itemValue","setItem","localExists","JSON","stringify","window","sessionStorage","getItem","itemStr","isObj","itemObj","parse","removeItem","clear","testKey","save","delete","__request","endpoint","queryData","query","post","send","put","del","Matter","appName","opts","options","signupData","then","response","account","errRes","loginData","_this","password","username","text","_this2","currentUser","_this3","resove","isLoggedIn","responseData","updateData","_this4","checkGroups","_this5","isArray","isInGroups","_ret","groupName","groupsArray","v","groups","group","userGroups","any","_this6","isInGroup","localServer","url","location","host","userData","user","logger","request","fbUrl","matterOptions","params","AuthRoleArn","UnauthRoleArn","matter","GroupAction","userName","utils","userEndpoint","___logger","GroupsAction","usersEndpoint","appData","Application","searchEndpoint","__logger","UsersAction","_Application","owner","collaborators","createdAt","updatedAt","frontend","backend","directories","fbRef","getFiles","filesArray","childStruct","bucketName","s3","S3","listParams","Bucket","listObjects","Contents","fileData","saveParams","frontent","Body","content","ACL","contentType","ContentType","putObject","UserAction","groupData","AppAction","appEndpoint","app","getStructure","structure","AppsAction","appsEndpoint","User","_request","_logger","TemplateAction","templateName","templateEndpoint","templateData","TemplatesAction","templatesEndpoint","_Matter"],"mappings":"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","file":"grout.min.js","sourcesContent":[null,"(function (global, factory) {\n\ttypeof exports === 'object' && typeof module !== 'undefined' ? module.exports = factory(require('lodash'), require('jwt-decode'), require('superagent'), require('firebase')) :\n\ttypeof define === 'function' && define.amd ? define(['lodash', 'jwt-decode', 'superagent', 'firebase'], factory) :\n\tglobal.Grout = factory(global._,global.jwtDecode,global.superagent,global.Firebase);\n}(this, function (_,jwtDecode,superagent,Firebase) { 'use strict';\n\n\t_ = 'default' in _ ? _['default'] : _;\n\tjwtDecode = 'default' in jwtDecode ? jwtDecode['default'] : jwtDecode;\n\tsuperagent = 'default' in superagent ? superagent['default'] : superagent;\n\tFirebase = 'default' in Firebase ? Firebase['default'] : Firebase;\n\n\tlet _config = {\n\t\tserverUrl: 'http://tessellate.elasticbeanstalk.com',\n\t\ttokenName: 'tessellate',\n\t\ttokenDataName: 'tessellate-tokenData',\n\t\ttokenUserDataName: 'tessellate-currentUser'\n\t};\n\n\tlet ____logger = {\n\t\tlog(logData) {\n\t\t\tlet msgArgs = buildMessageArgs(logData);\n\t\t\tif (_config.envName == 'local') {\n\t\t\t\tconsole.log(logData);\n\t\t\t} else {\n\t\t\t\tconsole.log.apply(console, msgArgs);\n\t\t\t}\n\t\t},\n\t\tinfo(logData) {\n\t\t\tlet msgArgs = buildMessageArgs(logData);\n\t\t\tif (_config.envName == 'local') {\n\t\t\t\tconsole.info(logData);\n\t\t\t} else {\n\t\t\t\tconsole.info.apply(console, msgArgs);\n\t\t\t}\n\t\t},\n\t\twarn(logData) {\n\t\t\tlet msgArgs = buildMessageArgs(logData);\n\t\t\tif (_config.envName == 'local') {\n\t\t\t\tconsole.warn(logData);\n\t\t\t} else {\n\t\t\t\tconsole.warn.apply(console, msgArgs);\n\t\t\t}\n\t\t},\n\t\tdebug(logData) {\n\t\t\tlet msgArgs = buildMessageArgs(logData);\n\t\t\tif (_config.envName == 'local') {\n\t\t\t\tconsole.log(logData);\n\t\t\t} else {\n\t\t\t\tconsole.log.apply(console, msgArgs);\n\t\t\t}\n\t\t},\n\t\terror(logData) {\n\t\t\tlet msgArgs = buildMessageArgs(logData);\n\t\t\tif (_config.envName == 'local') {\n\t\t\t\tconsole.error(logData);\n\t\t\t} else {\n\t\t\t\tconsole.error.apply(console, msgArgs);\n\t\t\t\t//TODO: Log to external logger\n\t\t\t}\n\t\t}\n\t};\n\n\tfunction buildMessageArgs(logData) {\n\t\tvar msgStr = '';\n\t\tvar msgObj = {};\n\t\t//TODO: Attach time stamp\n\t\tif (_.isObject(logData)) {\n\t\t\tif (_.has(logData, 'func')) {\n\t\t\t\tif (_.has(logData, 'obj')) {\n\t\t\t\t\tmsgStr += '[' + logData.obj + '.' + logData.func + '()] ';\n\t\t\t\t} else if (_.has(logData, 'file')) {\n\t\t\t\t\tmsgStr += '[' + logData.file + ' > ' + logData.func + '()] ';\n\t\t\t\t} else {\n\t\t\t\t\tmsgStr += '[' + logData.func + '()] ';\n\t\t\t\t}\n\t\t\t}\n\t\t\t//Print each key and its value other than obj and func\n\t\t\t_.each(_.omit(_.keys(logData)), function(key, ind, list) {\n\t\t\t\tif (key != 'func' && key != 'obj') {\n\t\t\t\t\tif (key == 'description' || key == 'message') {\n\t\t\t\t\t\tmsgStr += logData[key];\n\t\t\t\t\t} else if (_.isString(logData[key])) {\n\t\t\t\t\t\t// msgStr += key + ': ' + logData[key] + ', ';\n\t\t\t\t\t\tmsgObj[key] = logData[key];\n\t\t\t\t\t} else {\n\t\t\t\t\t\t//Print objects differently\n\t\t\t\t\t\t// msgStr += key + ': ' + logData[key] + ', ';\n\t\t\t\t\t\tmsgObj[key] = logData[key];\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t\tmsgStr += '\\n';\n\t\t} else if (_.isString(logData)) {\n\t\t\tmsgStr = logData;\n\t\t}\n\t\tvar msg = [msgStr, msgObj];\n\n\t\treturn msg;\n\t}\n\n\tlet data = {};\n\tlet storage = {\n\t\tget localExists() {\n\t\t\tconst testKey = 'test';\n\t\t\tif (typeof window != 'undefined' && typeof window.sessionStorage != 'undefined') {\n\t\t\t\ttry {\n\t\t\t\t\twindow.sessionStorage.setItem(testKey, '1');\n\t\t\t\t\twindow.sessionStorage.removeItem(testKey);\n\t\t\t\t\treturn true;\n\t\t\t\t} catch (err) {\n\t\t\t\t\t____logger.error({description: 'Error saving to session storage', error: err,  obj: 'storage', func: 'localExists'});\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t},\n\t\t/**\n\t\t * @description\n\t\t * Safley sets item to session storage.\n\t\t *\n\t\t * @param {String} itemName The items name\n\t\t * @param {String} itemValue The items value\n\t\t *\n\t\t */\n\t\titem(itemName, itemValue) {\n\t\t\treturn this.setItem(itemName, itemValue);\n\t\t},\n\t\t/**\n\t\t * @description\n\t\t * Safley sets item to session storage. Alias: item()\n\t\t *\n\t\t * @param {String} itemName The items name\n\t\t * @param {String} itemValue The items value\n\t\t *\n\t\t */\n\t\tsetItem(itemName, itemValue) {\n\t\t\tdata[itemName] = itemValue;\n\t\t\tif (this.localExists) {\n\t\t\t\t//Convert object to string\n\t\t\t\tif (_.isObject(itemValue)) {\n\t\t\t\t\titemValue = JSON.stringify(itemValue);\n\t\t\t\t}\n\t\t\t\twindow.sessionStorage.setItem(itemName, itemValue);\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * @description\n\t\t * Safley gets an item from session storage. Alias: item()\n\t\t *\n\t\t * @param {String} itemName The items name\n\t\t *\n\t\t * @return {String}\n\t\t *\n\t\t */\n\t\tgetItem(itemName) {\n\t\t\tif (data[itemName]) {\n\t\t\t\treturn data[itemName];\n\t\t\t} else if (this.localExists) {\n\t\t\t\tlet itemStr = window.sessionStorage.getItem(itemName);\n\t\t\t\t//Check that str is not null before parsing\n\t\t\t\tif (itemStr) {\n\t\t\t\t\tlet isObj = false;\n\t\t\t\t\tlet itemObj = null;\n\t\t\t\t\t//Try parsing to object\n\t\t\t\t\ttry {\n\t\t\t\t\t\titemObj = JSON.parse(itemStr);\n\t\t\t\t\t\tisObj = true;\n\t\t\t\t\t} catch (err) {\n\t\t\t\t\t\t// logger.log({message: 'String could not be parsed.', error: err, func: 'getItem', obj: 'storage'});\n\t\t\t\t\t\t//Parsing failed, this must just be a string\n\t\t\t\t\t\tisObj = false;\n\t\t\t\t\t}\n\t\t\t\t\tif (isObj) {\n\t\t\t\t\t\treturn itemObj;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn itemStr;\n\t\t\t} else {\n\t\t\t\treturn null;\n\t\t\t}\n\t\t},\n\t\t/**\n\t\t * @description\n\t\t * Safley removes item from session storage.\n\t\t *\n\t\t * @param {String} itemName - The items name\n\t\t *\n\t\t */\n\t\tremoveItem(itemName) {\n\t\t\t//TODO: Only remove used items\n\t\t\tif (data[itemName]) {\n\t\t\t\tdata[itemName] = null;\n\t\t\t}\n\t\t\tif (this.localExists) {\n\t\t\t\ttry {\n\t\t\t\t\t//Clear session storage\n\t\t\t\t\twindow.sessionStorage.removeItem(itemName);\n\t\t\t\t} catch (err) {\n\t\t\t\t\t____logger.error({description: 'Error removing item from session storage', error: err,  obj: 'storage', func: 'removeItem'});\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\t/**\n\t\t * @description\n\t\t * Safley removes item from session storage.\n\t\t *\n\t\t * @param {String} itemName the items name\n\t\t * @param {String} itemValue the items value\n\t\t *\n\t\t */\n\t\tclear() {\n\t\t\t//TODO: Only remove used items\n\t\t\tdata = {};\n\t\t\tif (this.localExists) {\n\t\t\t\ttry {\n\t\t\t\t\t\t//Clear session storage\n\t\t\t\t\twindow.sessionStorage.clear();\n\t\t\t\t} catch (err) {\n\t\t\t\t\t____logger.warn('Session storage could not be cleared.', err);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t};\n\n\tfunction decodeToken(tokenStr) {\n\t\tlet tokenData;\n\t\tif (tokenStr && tokenStr != '') {\n\t\t\ttry {\n\t\t\t\ttokenData = jwtDecode(tokenStr);\n\t\t\t} catch (err) {\n\t\t\t\t____logger.error({description: 'Error decoding token.', data: tokenData, error: err, func: 'decodeToken', file: 'token'});\n\t\t\t\tthrow new Error('Invalid token string.');\n\t\t\t}\n\t\t}\n\t\treturn tokenData;\n\t}\n\tlet token = {\n\t\tget string() {\n\t\t\treturn storage.getItem(_config.tokenName);\n\t\t},\n\t\tget data() {\n\t\t\tif (storage.getItem(_config.tokenDataName)) {\n\t\t\t\treturn storage.getItem(_config.tokenDataName);\n\t\t\t} else {\n\t\t\t\treturn decodeToken(this.string);\n\t\t\t}\n\t\t},\n\t\tset data(tokenData) {\n\t\t\tif (_.isString(tokenData)) {\n\t\t\t\tlet tokenStr = tokenData;\n\t\t\t\ttokenData = decodeToken(tokenStr);\n\t\t\t\t____logger.info({description: 'Token data was set as string. Decoding token.', token: tokenStr, tokenData: tokenData, func: 'data', obj: 'token'});\n\t\t\t} else {\n\t\t\t\t____logger.log({description: 'Token data was set.', data: tokenData, func: 'data', obj: 'token'});\n\t\t\t\tstorage.setItem(_config.tokenDataName, tokenData);\n\t\t\t}\n\t\t},\n\t\tset string(tokenStr) {\n\t\t\t____logger.log({description: 'Token was set.', token: tokenStr, func: 'string', obj: 'token'});\n\t\t\tthis.data = jwtDecode(tokenStr);\n\t\t\tstorage.setItem(_config.tokenName, tokenStr);\n\t\t},\n\t\tsave(tokenStr) {\n\t\t\tthis.string = tokenStr;\n\t\t},\n\t\tdelete() {\n\t\t\tstorage.removeItem(_config.tokenName);\n\t\t\tstorage.removeItem(_config.tokenDataName);\n\t\t\t____logger.log({description: 'Token was removed.', func: 'delete', obj: 'token'});\n\t\t}\n\t};\n\n\tlet __request = {\n\t\tget(endpoint, queryData) {\n\t\t\tvar req = superagent.get(endpoint);\n\t\t\tif (queryData) {\n\t\t\t\treq.query(queryData);\n\t\t\t}\n\t\t\treq = addAuthHeader(req);\n\t\t\treturn handleResponse(req);\n\t\t},\n\t\tpost(endpoint, data) {\n\t\t\tvar req = superagent.post(endpoint).send(data);\n\t\t\treq = addAuthHeader(req);\n\t\t\treturn handleResponse(req);\n\t\t},\n\t\tput(endpoint, data) {\n\t\t\tvar req = superagent.put(endpoint).send(data);\n\t\t\treq = addAuthHeader(req);\n\t\t\treturn handleResponse(req);\n\t\t},\n\t\tdel(endpoint, data) {\n\t\t\tvar req = superagent.put(endpoint).send(data);\n\t\t\treq = addAuthHeader(req);\n\t\t\treturn handleResponse(req);\n\t\t}\n\t};\n\n\tfunction handleResponse(req) {\n\t\treturn new Promise((resolve, reject) => {\n\t\t\treq.end((err, res) => {\n\t\t\t\tif (!err) {\n\t\t\t\t\t// logger.log({description: 'Response:', response:res, func:'handleResponse', file: 'request'});\n\t\t\t\t\treturn resolve(res.body);\n\t\t\t\t} else {\n\t\t\t\t\tif (err.status == 401) {\n\t\t\t\t\t\tconsole.warn('Unauthorized. You must be signed into make this request.');\n\t\t\t\t\t}\n\t\t\t\t\treturn reject(err);\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t}\n\tfunction addAuthHeader(req) {\n\t\tif (token.string) {\n\t\t\treq = req.set('Authorization', 'Bearer ' + token.string);\n\t\t\tconsole.info({message: 'Set auth header', func: 'addAuthHeader', file: 'request'});\n\t\t}\n\t\treturn req;\n\t}\n\n\tclass Matter {\n\t\t/* Constructor\n\t\t * @param {string} appName Name of application\n\t\t */\n\t\tconstructor(appName, opts) {\n\t\t\tif (!appName) {\n\t\t\t\t____logger.error({description: 'Application name requires to use Matter.', func: 'constructor', obj: 'Matter'});\n\t\t\t\tthrow new Error('Application name is required to use Matter');\n\t\t\t} else {\n\t\t\t\tthis.name = appName;\n\t\t\t}\n\t\t\tif (opts) {\n\t\t\t\tthis.options = opts;\n\t\t\t}\n\t\t}\n\t\t/* Endpoint getter\n\t\t *\n\t\t */\n\t\tget endpoint() {\n\t\t\tlet serverUrl = _config.serverUrl;\n\t\t\tif (_.has(this, 'options') && this.options.localServer) {\n\t\t\t\tserverUrl = 'http://localhost:4000';\n\t\t\t\t____logger.info({description: 'LocalServer option was set to true. Now server url is local server.', url: serverUrl, func: 'endpoint', obj: 'Matter'});\n\t\t\t}\n\t\t\tif (this.name == 'tessellate') {\n\t\t\t\t//Remove url if host is server\n\t\t\t\tif (window && _.has(window, 'location') && window.location.host == serverUrl) {\n\t\t\t\t\tserverUrl = '';\n\t\t\t\t\t____logger.info({description: 'Host is Server, serverUrl simplified!', url: serverUrl, func: 'endpoint', obj: 'Matter'});\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tserverUrl = _config.serverUrl + '/apps/' + this.name;\n\t\t\t\t____logger.info({description: 'Server url set.', url: serverUrl, func: 'endpoint', obj: 'Matter'});\n\t\t\t}\n\t\t\treturn serverUrl;\n\t\t}\n\t\t/* Signup\n\t\t *\n\t\t */\n\t\tsignup(signupData) {\n\t\t\treturn __request.post(this.endpoint + '/signup', signupData)\n\t\t\t.then((response) => {\n\t\t\t\t____logger.log({description: 'Account request successful.', signupData: signupData, response: response, func: 'signup', obj: 'Matter'});\n\t\t\t\tif (_.has(response, 'account')) {\n\t\t\t\t\treturn response.account;\n\t\t\t\t} else {\n\t\t\t\t\t____logger.warn({description: 'Account was not contained in signup response.', signupData: signupData, response: response, func: 'signup', obj: 'Matter'});\n\t\t\t\t\treturn response;\n\t\t\t\t}\n\t\t\t})\n\t\t\t['catch']((errRes) => {\n\t\t\t\t____logger.error({description: 'Error requesting signup.', signupData: signupData, error: errRes, func: 'signup', obj: 'Matter'});\n\t\t\t\treturn Promise.reject(errRes);\n\t\t\t});\n\t\t}\n\t\t/** Login\n\t\t *\n\t\t */\n\t\tlogin(loginData) {\n\t\t\tif (!loginData || !loginData.password || !loginData.username) {\n\t\t\t\t____logger.error({description: 'Username/Email and Password are required to login', func: 'login', obj: 'Matter'});\n\t\t\t\treturn Promise.reject({message: 'Username/Email and Password are required to login'});\n\t\t\t}\n\t\t\treturn __request.put(this.endpoint + '/login', loginData)\n\t\t\t.then((response) => {\n\t\t\t\tif (_.has(response, 'data') && _.has(response.data, 'status') && response.data.status == 409) {\n\t\t\t\t\t____logger.warn({description: 'Account not found.', response: response, func: 'login', obj: 'Matter'});\n\t\t\t\t\treturn Promise.reject(response.data);\n\t\t\t\t} else {\n\t\t\t\t\t____logger.log({description: 'Successful login.', response: response, func: 'login', obj: 'Matter'});\n\t\t\t\t\tif (_.has(response, 'token')) {\n\t\t\t\t\t\tthis.token.string = response.token;\n\t\t\t\t\t}\n\t\t\t\t\tif (_.has(response, 'account')) {\n\t\t\t\t\t\tthis.storage.setItem(_config.tokenUserDataName, response.account);\n\t\t\t\t\t}\n\t\t\t\t\treturn response.account;\n\t\t\t\t}\n\t\t\t})['catch']((errRes) => {\n\t\t\t\t____logger.error({description: 'Error requesting login.', error: errRes, status: errRes.status,  func: 'login', obj: 'Matter'});\n\t\t\t\tif (errRes.status == 409 || errRes.status == 400) {\n\t\t\t\t\terrRes = errRes.response.text;\n\t\t\t\t}\n\t\t\t\treturn Promise.reject(errRes);\n\t\t\t});\n\t\t}\n\t\t/** Logout\n\t\t */\n\t\tlogout() {\n\t\t\treturn __request.put(this.endpoint + '/logout').then((response) => {\n\t\t\t\t____logger.log({description: 'Logout successful.', response: response, func: 'logout', obj: 'Matter'});\n\t\t\t\tthis.currentUser = null;\n\t\t\t\tthis.token.delete();\n\t\t\t\treturn response;\n\t\t\t})['catch']((errRes) => {\n\t\t\t\t____logger.error({description: 'Error requesting log out: ', error: errRes, func: 'logout', obj: 'Matter'});\n\t\t\t\tthis.storage.removeItem(_config.tokenUserDataName);\n\t\t\t\tthis.token.delete();\n\t\t\t\treturn Promise.reject(errRes);\n\t\t\t});\n\t\t}\n\t\tgetCurrentUser() {\n\t\t\tif (this.storage.item(_config.tokenUserDataName)) {\n\t\t\t\treturn Promise.resove(this.storage.getItem(_config.tokenUserDataName));\n\t\t\t} else {\n\t\t\t\tif (this.isLoggedIn) {\n\t\t\t\t\treturn __request.get(this.endpoint + '/user').then((response) => {\n\t\t\t\t\t\t//TODO: Save user information locally\n\t\t\t\t\t\t____logger.log({description: 'Current User Request responded.', responseData: response, func: 'currentUser', obj: 'Matter'});\n\t\t\t\t\t\tthis.currentUser = response;\n\t\t\t\t\t\treturn response;\n\t\t\t\t\t})['catch']((errRes) => {\n\t\t\t\t\t\tif (err.status == 401) {\n\t\t\t\t\t\t\t____logger.warn({description: 'Called for current user without token.', error: errRes, func: 'currentUser', obj: 'Matter'});\n\t\t\t\t\t\t\treturn Promise.resolve(null);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t____logger.error({description: 'Error requesting current user.', error: errRes, func: 'currentUser', obj: 'Matter'});\n\t\t\t\t\t\t\treturn Promise.reject(errRes);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\treturn Promise.resolve(null);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tset currentUser(userData) {\n\t\t\t____logger.log({description: 'Current User set.', user: userData, func: 'currentUser', obj: 'Matter'});\n\t\t\tthis.storage.setItem(_config.tokenUserDataName, userData);\n\t\t}\n\t\tget currentUser() {\n\t\t\tif (this.storage.getItem(_config.tokenUserDataName)) {\n\t\t\t\treturn this.storage.getItem(_config.tokenUserDataName);\n\t\t\t} else {\n\t\t\t\treturn null;\n\t\t\t}\n\t\t}\n\t\t/** updateProfile\n\t\t */\n\t\tupdateProfile(updateData) {\n\t\t\tif (!this.isLoggedIn) {\n\t\t\t\t____logger.error({description: 'No current user profile to update.', func: 'updateProfile', obj: 'Matter'});\n\t\t\t\treturn Promise.reject({message: 'Must be logged in to update profile.'});\n\t\t\t}\n\t\t\t//Send update request\n\t\t\t____logger.warn({description: 'Calling update endpoint.', endpoint: `${this.endpoint}/user/${this.token.data.username}` , func: 'updateProfile', obj: 'Matter'});\n\t\t\treturn __request.put(`${this.endpoint}/user/${this.token.data.username}` , updateData).then((response) => {\n\t\t\t\t____logger.log({description: 'Update profile request responded.', responseData: response, func: 'updateProfile', obj: 'Matter'});\n\t\t\t\tthis.currentUser = response;\n\t\t\t\treturn response;\n\t\t\t})['catch']((errRes) => {\n\t\t\t\t____logger.error({description: 'Error requesting current user.', error: errRes, func: 'updateProfile', obj: 'Matter'});\n\t\t\t\treturn Promise.reject(errRes);\n\t\t\t});\n\t\t}\n\t\t/** updateProfile\n\t\t */\n\t\tget storage() {\n\t\t\treturn storage;\n\t\t}\n\t\t/** updateProfile\n\t\t */\n\t\tget token() {\n\t\t\treturn token;\n\t\t}\n\t\tget utils() {\n\t\t\treturn {logger: ____logger, request: __request, storage: storage};\n\t\t}\n\t\tget isLoggedIn() {\n\t\t\treturn this.token.string ? true : false;\n\t\t}\n\t\t//Check that user is in a single group or in all of a list of groups\n\t\tisInGroup(checkGroups) {\n\t\t\tif (!this.isLoggedIn) {\n\t\t\t\t____logger.log({description: 'No logged in user to check.', func: 'isInGroup', obj: 'Matter'});\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\t//Check if user is\n\t\t\tif (checkGroups && _.isString(checkGroups)) {\n\t\t\t\tlet groupName = checkGroups;\n\t\t\t\t//Single role or string list of roles\n\t\t\t\tlet groupsArray = groupName.split(',');\n\t\t\t\tif (groupsArray.length > 1) {\n\t\t\t\t\t//String list of groupts\n\t\t\t\t\t____logger.info({description: 'String list of groups.', list: groupsArray, func: 'isInGroup', obj: 'Matter'});\n\t\t\t\t\treturn this.isInGroups(groupsArray);\n\t\t\t\t} else {\n\t\t\t\t\t//Single group\n\t\t\t\t\tlet groups = this.token.data.groups || [];\n\t\t\t\t\t____logger.log({description: 'Checking if user is in group.', group: groupName, userGroups: this.token.data.groups || [],  func: 'isInGroup', obj: 'Matter'});\n\t\t\t\t\treturn _.any(groups, (group) =>  {\n\t\t\t\t\t\treturn groupName == group.name;\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t} else if (checkGroups && _.isArray(checkGroups)) {\n\t\t\t\t//Array of roles\n\t\t\t\t//Check that user is in every group\n\t\t\t\t____logger.info({description: 'Array of groups.', list: checkGroups, func: 'isInGroup', obj: 'Matter'});\n\t\t\t\treturn this.isInGroups(checkGroups);\n\t\t\t} else {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\t//TODO: Handle string and array inputs\n\t\t}\n\t\tisInGroups(checkGroups) {\n\t\t\t//Check if user is in any of the provided groups\n\t\t\tif (checkGroups && _.isArray(checkGroups)) {\n\t\t\t\treturn _.map(checkGroups, (group) =>  {\n\t\t\t\t\tif (_.isString(group)) {\n\t\t\t\t\t\t//Group is string\n\t\t\t\t\t\treturn this.isInGroup(group);\n\t\t\t\t\t} else {\n\t\t\t\t\t\t//Group is object\n\t\t\t\t\t\treturn this.isInGroup(group.name);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t} else if (checkGroups && _.isString(checkGroups)) {\n\t\t\t\t//TODO: Handle spaces within string list\n\t\t\t\tlet groupsArray = checkGroups.split(',');\n\t\t\t\tif (groupsArray.length > 1) {\n\t\t\t\t\treturn this.isInGroups(groupsArray);\n\t\t\t\t}\n\t\t\t\treturn this.isInGroup(groupsArray[0]);\n\t\t\t} else {\n\t\t\t\t____logger.error({description: 'Invalid groups list.', func: 'isInGroups', obj: 'Matter'});\n\t\t\t}\n\t\t}\n\t}\n\n\tlet config = {\n\t\tserverUrl: 'http://tessellate.elasticbeanstalk.com',\n\t\ttokenName: 'grout',\n\t\tfbUrl: 'https://pruvit.firebaseio.com/',\n\t\tappName: 'tessellate',\n\t\tmatterOptions: {\n\t\t\tlocalServer: true\n\t\t},\n\t\taws: {\n\t\t\tregion: 'us-east-1',\n\t\t\tcognito: {\n\t\t\t\tpoolId: 'us-east-1:72a20ffd-c638-48b0-b234-3312b3e64b2e',\n\t\t\t\tparams: {\n\t\t\t\t\tAuthRoleArn: 'arn:aws:iam::823322155619:role/Cognito_TessellateUnauth_Role',\n\t\t\t\t\tUnauthRoleArn: 'arn:aws:iam::823322155619:role/Cognito_TessellateAuth_Role'\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t};\n\n\tlet matter = new Matter(config.appName, config.matterOptions);\n\n\t//Actions for specific user\n\tclass GroupAction {\n\t\tconstructor(userName) {\n\t\t\t//Call matter with name and settings\n\t\t\tif (userName) {\n\t\t\t\tthis.username = userName;\n\t\t\t} else {\n\t\t\t\tconsole.error('Username is required to start an GroupAction');\n\t\t\t\tthrow new Error('Username is required to start an GroupAction');\n\t\t\t}\n\t\t}\n\t\tget userEndpoint() {\n\t\t\treturn `${matter.endpoint}/users/${this.username}`;\n\t\t}\n\t\t//Get userlications or single userlication\n\t\tget() {\n\t\t\treturn matter.utils.request.get(this.userEndpoint).then((response) => {\n\t\t\t\tconsole.log('[MatterClient.user().get()] App(s) data loaded:', response);\n\t\t\t\treturn response;\n\t\t\t})['catch']((errRes) => {\n\t\t\t\tconsole.error('[MatterClient.user().get()] Error getting users list: ', errRes);\n\t\t\t\treturn Promise.reject(errRes);\n\t\t\t});\n\t\t}\n\t\t//Update an userlication\n\t\tupdate(userData) {\n\t\t\treturn matter.utils.request.put(this.userEndpoint, userData).then((response) => {\n\t\t\t\tconsole.log('[MatterClient.users().update()] App:', response);\n\t\t\t\treturn response;\n\t\t\t})['catch']((errRes) => {\n\t\t\t\tconsole.error('[MatterClient.users().update()] Error updating user: ', errRes);\n\t\t\t\treturn Promise.reject(errRes);\n\t\t\t});\n\t\t}\n\t\t//Delete an userlication\n\t\t//TODO: Only do matter.utils.request if deleting personal account\n\t\tdel(userData) {\n\t\t\tconsole.error('Deleting a user is currently disabled.');\n\t\t\t// return matter.utils.request.delete(this.endpoint, userData).then((response) => {\n\t\t\t// \tconsole.log('[MatterClient.users().del()] Apps:', response);\n\t\t\t// \treturn new User(response);\n\t\t\t// })['catch']((errRes) => {\n\t\t\t// \tconsole.error('[MatterClient.users().del()] Error deleting user: ', errRes);\n\t\t\t// \treturn Promise.reject(errRes);\n\t\t\t// });\n\t\t}\n\t}\n\n\tlet ___logger = matter.utils.logger;\n\t//Actions for users list\n\tclass GroupsAction {\n\t\tget usersEndpoint() {\n\t\t\treturn `${matter.endpoint}/users`;\n\t\t}\n\t\t//Get users or single application\n\t\tget() {\n\t\t\tconsole.log({description: 'Users get called.', func: 'get', obj: 'GroupsAction'});\n\t\t\treturn matter.utils.request.get(this.usersEndpoint).then((response) => {\n\t\t\t\tconsole.log('users loaded:', response);\n\t\t\t\treturn response;\n\t\t\t})['catch']((errRes) => {\n\t\t\t\tconsole.error('error getting users');\n\t\t\t\treturn Promise.reject(errRes);\n\t\t\t});\n\t\t}\n\t\t//Add an application\n\t\tadd(appData) {\n\t\t\treturn this.utils.request.post(this.usersEndpoint, appData).then((response) => {\n\t\t\t\tconsole.log('[MatterClient.users().add()] Application added successfully: ', response);\n\t\t\t\treturn new Application(response);\n\t\t\t})['catch']((errRes) => {\n\t\t\t\tconsole.error('[MatterClient.getApps()] Error adding application: ', errRes);\n\t\t\t\treturn Promise.reject(errRes);\n\t\t\t});\n\t\t}\n\t\t//Search with partial of username\n\t\tsearch(query) {\n\t\t\tconsole.log('search called:', query);\n\t\t\tvar searchEndpoint = this.usersEndpoint + '/search/';\n\t\t\tif (query && _.isString(query)) {\n\t\t\t\tsearchEndpoint += query;\n\t\t\t}\n\t\t\tif (!query || query == '') {\n\t\t\t\t___logger.log({description: 'Null query, returning empty array.', func: 'search', obj: 'GroupsAction'});\n\t\t\t\treturn Promise.resolve([]);\n\t\t\t}\n\t\t\treturn matter.utils.request.get(searchEndpoint).then((response) => {\n\t\t\t\tconsole.log('[MatterClient.users().search()] Users(s) data loaded:', response);\n\t\t\t\treturn response;\n\t\t\t})['catch']((errRes) => {\n\t\t\t\tconsole.error('[MatterClient.users().search()] Error getting users list: ', errRes);\n\t\t\t\treturn Promise.reject(errRes);\n\t\t\t});\n\t\t}\n\t}\n\n\tlet __logger = matter.utils.logger;\n\t//Actions for users list\n\tclass UsersAction {\n\t\tget usersEndpoint() {\n\t\t\treturn `${matter.endpoint}/users`;\n\t\t}\n\t\t//Get users or single application\n\t\tget() {\n\t\t\tconsole.log({description: 'Users get called.', func: 'get', obj: 'UsersAction'});\n\t\t\treturn matter.utils.request.get(this.usersEndpoint).then((response) => {\n\t\t\t\tconsole.log('users loaded:', response);\n\t\t\t\treturn response;\n\t\t\t})['catch']((errRes) => {\n\t\t\t\tconsole.error('error getting users');\n\t\t\t\treturn Promise.reject(errRes);\n\t\t\t});\n\t\t}\n\t\t//Add an application\n\t\tadd(appData) {\n\t\t\treturn this.utils.request.post(this.usersEndpoint, appData).then((response) => {\n\t\t\t\tconsole.log('[MatterClient.users().add()] Application added successfully: ', response);\n\t\t\t\treturn new Application(response);\n\t\t\t})['catch']((errRes) => {\n\t\t\t\tconsole.error('[MatterClient.getApps()] Error adding application: ', errRes);\n\t\t\t\treturn Promise.reject(errRes);\n\t\t\t});\n\t\t}\n\t\t//Search with partial of username\n\t\tsearch(query) {\n\t\t\tconsole.log('search called:', query);\n\t\t\tvar searchEndpoint = this.usersEndpoint + '/search/';\n\t\t\tif (query && _.isString(query)) {\n\t\t\t\tsearchEndpoint += query;\n\t\t\t}\n\t\t\tif (!query || query == '') {\n\t\t\t\t__logger.log({description: 'Null query, returning empty array.', func: 'search', obj: 'UsersAction'});\n\t\t\t\treturn Promise.resolve([]);\n\t\t\t}\n\t\t\treturn matter.utils.request.get(searchEndpoint).then((response) => {\n\t\t\t\tconsole.log('[MatterClient.users().search()] Users(s) data loaded:', response);\n\t\t\t\treturn response;\n\t\t\t})['catch']((errRes) => {\n\t\t\t\tconsole.error('[MatterClient.users().search()] Error getting users list: ', errRes);\n\t\t\t\treturn Promise.reject(errRes);\n\t\t\t});\n\t\t}\n\t}\n\n\t/**\n\t * Application class.\n\t *\n\t */\n\tclass _Application {\n\t\tconstructor(appData) {\n\t\t\t//Call matter with name and settings\n\t\t\tthis.name = appData.name;\n\t\t\tthis.owner = appData.owner || null;\n\t\t\tthis.collaborators = appData.collaborators || [];\n\t\t\tthis.createdAt = appData.createdAt;\n\t\t\tthis.updatedAt = appData.updatedAt;\n\t\t\tthis.frontend = appData.frontend || {};\n\t\t\tthis.backend = appData.backend || {};\n\t\t\tthis.groups = appData.groups || null;\n\t\t\tthis.directories = appData.directories || null;\n\t\t\tif (Firebase) {\n\t\t\t\tthis.fbRef = new Firebase(config.fbUrl + appData.name);\n\t\t\t}\n\t\t}\n\t\t//Get files list and convert to structure\n\t\tgetStructure() {\n\t\t\treturn this.getFiles().then((filesArray) => {\n\t\t\t\tconst childStruct = childrenStructureFromArray(filesArray);\n\t\t\t\tconsole.log('Child struct from array:', childStruct);\n\t\t\t\treturn childStruct;\n\t\t\t}, (err) => {\n\t\t\t\tconsole.error('[Application.getStructure] Error getting files: ', err);\n\t\t\t\treturn Promise.reject({message: 'Error getting files.', error: err});\n\t\t\t});\n\t\t}\n\t\t//Get files list from S3\n\t\tgetFiles() {\n\t\t\tif (!this.frontend || !this.frontend.bucketName) {\n\t\t\t\tconsole.error('[Applicaiton.getFiles] Attempting to get objects for bucket without name.');\n\t\t\t\treturn Promise.reject({message: 'Bucket name required to get objects'});\n\t\t\t} else {\n\t\t\t\t//If AWS Credential do not exist, set them\n\t\t\t\tif (typeof AWS.config.credentials == 'undefined' || !AWS.config.credentials) {\n\t\t\t\t\t// console.info('AWS creds are being updated to make matter.utils.request');\n\t\t\t\t\tsetAWSConfig();\n\t\t\t\t}\n\t\t\t\tvar s3 = new AWS.S3();\n\t\t\t\tvar listParams = {Bucket: this.frontend.bucketName};\n\t\t\t\treturn new Promise((resolve, reject) => {\n\t\t\t\t\ts3.listObjects(listParams, function(err, data) {\n\t\t\t\t\t\tif (!err) {\n\t\t\t\t\t\t\tconsole.log('[Application.getObjects()] listObjects returned:', data);\n\t\t\t\t\t\t\treturn resolve(data.Contents);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tconsole.error('[Application.getObjects()] Error listing objects:', err);\n\t\t\t\t\t\t\treturn reject(err);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t\tpublishFile(fileData) {\n\t\t\tif (!this.frontend) {\n\t\t\t\tconsole.error('Frontend data not available. Make sure to call .get().');\n\t\t\t\treturn Promise.reject({message: 'Front end data is required to publish file.'});\n\t\t\t}\n\t\t\tvar saveParams = {Bucket: this.frontent.bucketName, Key: fileData.key,  Body: fileData.content, ACL: 'public-read'};\n\t\t\t//Set contentType from fileData to ContentType parameter of new object\n\t\t\tif (fileData.contentType) {\n\t\t\t\tsaveParams.ContentType = fileData.contentType;\n\t\t\t}\n\t\t\t// console.log('[$aws.$saveFiles] saveParams:', saveParams);\n\t\t\treturn s3.putObject(saveParams, function(err, data) {\n\t\t\t\t//[TODO] Add putting object ACL (make public)\n\t\t\t\tif (!err) {\n\t\t\t\t\tconsole.log('[Application.publishFile()] file saved successfully. Returning:', data);\n\t\t\t\t\treturn data;\n\t\t\t\t}\telse {\n\t\t\t\t\tconsole.error('[Application.publishFile()] Error saving file:', err);\n\t\t\t\t\treturn Promise.reject(err);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\taddStorage() {\n\t\t\t//TODO:Add storage bucket\n\t\t\tvar endpoint = config.serverUrl + '/apps/' + this.name + '/storage';\n\t\t\treturn matter.utils.request.post(endpoint, appData).then((response) => {\n\t\t\t\tconsole.log('[Application.addStorage()] Apps:', response);\n\t\t\t\treturn new _Application(response);\n\t\t\t})['catch']((errRes) => {\n\t\t\t\tconsole.error('[Application.addStorage()] Error getting apps list: ', errRes);\n\t\t\t\treturn Promise.reject(errRes);\n\t\t\t});\n\t\t}\n\t\tapplyTemplate() {\n\t\t\tvar endpoint = config.serverUrl + '/apps/' + this.name + '/template';\n\t\t\tconsole.log('Applying templates to existing');\n\t\t\t// return matter.utils.request.post(endpoint, appData).then(function(response) {\n\t\t\t// \tconsole.log('[Application.addStorage()] Apps:', response);\n\t\t\t// \tif (!apps.isList) {\n\t\t\t// \t\treturn new Application(response);\n\t\t\t// \t}\n\t\t\t// \treturn response;\n\t\t\t// })['catch'](function(errRes) {\n\t\t\t// \tconsole.error('[Application.addStorage()] Error getting apps list: ', errRes);\n\t\t\t// \treturn Promise.reject(errRes);\n\t\t\t// });\n\t\t}\n\t\tget users() {\n\t\t\t//TODO: Handle this being an application's users action\n\t\t\treturn new UsersAction();\n\t\t}\n\t\tuser(userData) {\n\t\t\t//TODO: Handle userData being a string or object\n\t\t\t//TODO: Handle this being an application's users action\n\t\t\treturn new UserAction(userData);\n\t\t}\n\t\tget groups() {\n\t\t\t//TODO: Handle this being an application's groups action\n\t\t\treturn new GroupsAction();\n\t\t}\n\t\tgroup(groupData) {\n\t\t\t//TODO: Handle this being an application's group action\n\t\t\treturn new GroupAction(groupData);\n\t\t}\n\n\t}\n\n\t//------------------ Utility Functions ------------------//\n\n\t// AWS Config\n\tfunction setAWSConfig() {\n\t\tAWS.config.update({\n\t\t  credentials: new AWS.CognitoIdentityCredentials({\n\t\t  IdentityPoolId: config.aws.cognito.poolId\n\t\t  }),\n\t\t  region: config.aws.region\n\t\t});\n\t}\n\n\t//Convert from array file structure (from S3) to 'children' structure used in Editor GUI (angular-tree-control)\n\t//Examples for two files (index.html and /testFolder/file.js):\n\t//Array structure: [{path:'index.html'}, {path:'testFolder/file.js'}]\n\t//Children Structure [{type:'folder', name:'testfolder', children:[{path:'testFolder/file.js', name:'file.js', filetype:'javascript', contentType:'application/javascript'}]}]\n\tfunction childrenStructureFromArray(fileArray) {\n\t\t// console.log('childStructureFromArray called:', fileArray);\n\t\t//Create a object for each file that stores the file in the correct 'children' level\n\t\tvar mappedStructure = fileArray.map(function(file) {\n\t\t\treturn buildStructureObject(file);\n\t\t});\n\t\treturn combineLikeObjs(mappedStructure);\n\t}\n\t//Convert file with key into a folder/file children object\n\tfunction buildStructureObject(file) {\n\t\tvar pathArray;\n\t\t// console.log('buildStructureObject with:', file);\n\t\tif (_.has(file, 'path')) {\n\t\t\t//Coming from files already having path (structure)\n\t\t\tpathArray = file.path.split('/');\n\t\t} else {\n\t\t\t//Coming from aws\n\t\t\tpathArray = file.Key.split('/');\n\t\t\t// console.log('file before pick:', file);\n\t\t\tfile = _.pick(file, 'Key');\n\t\t\tfile.path = file.Key;\n\t\t\tfile.name = file.Key;\n\t\t}\n\t\tvar currentObj = file;\n\t\tif (pathArray.length == 1) {\n\t\t\tcurrentObj.name = pathArray[0];\n\t\t\tif (!_.has(currentObj,'type')) {\n\t\t\t\tcurrentObj.type = 'file';\n\t\t\t}\n\t\t\tcurrentObj.path = pathArray[0];\n\t\t\treturn currentObj;\n\t\t} else {\n\t\t\tvar finalObj = {};\n\t\t\t_.each(pathArray, (loc, ind, list) => {\n\t\t\t\tif (ind != list.length - 1) {//Not the last loc\n\t\t\t\t\tcurrentObj.name = loc;\n\t\t\t\t\tcurrentObj.path = _.first(list, ind + 1).join('/');\n\t\t\t\t\tcurrentObj.type = 'folder';\n\t\t\t\t\tcurrentObj.children = [{}];\n\t\t\t\t\t//TODO: Find out why this works\n\t\t\t\t\tif (ind == 0) {\n\t\t\t\t\t\tfinalObj = currentObj;\n\t\t\t\t\t}\n\t\t\t\t\tcurrentObj = currentObj.children[0];\n\t\t\t\t} else {\n\t\t\t\t\tcurrentObj.type = 'file';\n\t\t\t\t\tcurrentObj.name = loc;\n\t\t\t\t\tcurrentObj.path = pathArray.join('/');\n\t\t\t\t\tif (file.$id) {\n\t\t\t\t\t\tcurrentObj.$id = file.$id;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t\treturn finalObj;\n\t\t}\n\t}\n\t//Recursivley combine children of object's that have the same names\n\tfunction combineLikeObjs(mappedArray) {\n\t\tvar takenNames = [];\n\t\tvar finishedArray = [];\n\t\t_.each(mappedArray, (obj, ind, list) => {\n\t\t\tif (takenNames.indexOf(obj.name) == -1) {\n\t\t\t\ttakenNames.push(obj.name);\n\t\t\t\tfinishedArray.push(obj);\n\t\t\t} else {\n\t\t\t\tvar likeObj = _.findWhere(mappedArray, {name: obj.name});\n\t\t\t\t//Combine children of like objects\n\t\t\t\tlikeObj.children = _.union(obj.children, likeObj.children);\n\t\t\t\tlikeObj.children = combineLikeObjs(likeObj.children);\n\t\t\t\t// console.log('extended obj:',likeObj);\n\t\t\t}\n\t\t});\n\t\treturn finishedArray;\n\t}\n\n\t//Actions for specific application\n\tclass AppAction {\n\t\tconstructor(appName) {\n\t\t\t//Call matter with name and settings\n\t\t\tif (appName) {\n\t\t\t\tthis.name = appName;\n\t\t\t} else {\n\t\t\t\tconsole.error('Application name is required to start an AppAction');\n\t\t\t\tthrow new Error('Application name is required to start an AppAction');\n\t\t\t}\n\t\t}\n\t\tget appEndpoint() {\n\t\t\treturn `${matter.endpoint}/apps/${this.name}`;\n\t\t}\n\t\t//Get applications or single application\n\t\tget() {\n\t\t\treturn matter.utils.request.get(this.appEndpoint).then((response) => {\n\t\t\t\tconsole.log('[MatterClient.app().get()] App(s) data loaded:', response);\n\t\t\t\treturn new _Application(response);\n\t\t\t})['catch']((errRes) => {\n\t\t\t\tconsole.error('[MatterClient.app().get()] Error getting apps list: ', errRes);\n\t\t\t\treturn Promise.reject(errRes);\n\t\t\t});\n\t\t}\n\t\t//Update an application\n\t\tupdate(appData) {\n\t\t\treturn matter.utils.request.put(this.appEndpoint, appData).then((response) => {\n\t\t\t\tconsole.log('[MatterClient.apps().update()] App:', response);\n\t\t\t\treturn new _Application(response);\n\t\t\t})['catch']((errRes) => {\n\t\t\t\tconsole.error('[MatterClient.apps().update()] Error updating app: ', errRes);\n\t\t\t\treturn Promise.reject(errRes);\n\t\t\t});\n\t\t}\n\t\t//Delete an application\n\t\tdel(appData) {\n\t\t\treturn matter.utils.request.delete(this.appEndpoint, appData).then((response) => {\n\t\t\t\tconsole.log('[MatterClient.apps().del()] Apps:', response);\n\t\t\t\treturn new _Application(response);\n\t\t\t})['catch']((errRes) => {\n\t\t\t\tconsole.error('[MatterClient.apps().del()] Error deleting app: ', errRes);\n\t\t\t\treturn Promise.reject(errRes);\n\t\t\t});\n\t\t}\n\t\tgetFiles() {\n\t\t\treturn this.get().then((app) => {\n\t\t\t\tapp.getFiles().then((filesArray)=> {\n\t\t\t\t\treturn filesArray;\n\t\t\t\t})['catch']((err) => {\n\t\t\t\t\tconsole.error('[MatterClient.app().getFiles()] Error getting application files: ', err);\n\t\t\t\t\treturn Promise.reject(err);\n\t\t\t\t});\n\t\t\t})['catch']((err) => {\n\t\t\t\tconsole.error('[MatterClient.app().getFiles()] Error getting application: ', err);\n\t\t\t\treturn Promise.reject(err);\n\t\t\t});\n\t\t}\n\n\t\tgetStructure() {\n\t\t\treturn this.get().then((app) => {\n\t\t\t\treturn app.getStructure().then((structure)=> {\n\t\t\t\t\tconsole.log('Structure loaded: ', structure);\n\t\t\t\t\treturn structure;\n\t\t\t\t})['catch']((err) => {\n\t\t\t\t\tconsole.error('[MatterClient.app().getStructure()] Error getting application structure: ', err);\n\t\t\t\t\treturn Promise.reject(err);\n\t\t\t\t});\n\t\t\t})['catch']((err) => {\n\t\t\t\tconsole.error('[MatterClient.app().getStructure()] Error getting application: ', err);\n\t\t\t\treturn Promise.reject(err);\n\t\t\t});\n\t\t}\n\t}\n\n\t//Actions for applications list\n\tclass AppsAction {\n\t\tconstructor() {\n\t\t\t//Call matter with name and settings\n\t\t}\n\t\tget appsEndpoint() {\n\t\t\tconsole.log('matter.endpoint is currently:', matter.endpoint);\n\t\t\treturn `${matter.endpoint}/apps`;\n\t\t}\n\t\t//Get applications or single application\n\t\tget() {\n\t\t\tconsole.warn('matter.utils:', matter.utils);\n\t\t\treturn matter.utils.request.get(this.appsEndpoint).then((response) => {\n\t\t\t\tconsole.log('[MatterClient.apps().get()] App(s) data loaded:', response);\n\t\t\t\treturn response;\n\t\t\t})['catch']((errRes) => {\n\t\t\t\tconsole.error('[MatterClient.apps().get()] Error getting apps list: ', errRes);\n\t\t\t\treturn Promise.reject(errRes);\n\t\t\t});\n\t\t}\n\t\t//Add an application\n\t\tadd(appData) {\n\t\t\treturn matter.utils.request.post(this.appsEndpoint, appData).then((response) => {\n\t\t\t\tconsole.log('[MatterClient.apps().add()] Application added successfully: ', response);\n\t\t\t\treturn new Application(response);\n\t\t\t})['catch']((errRes) => {\n\t\t\t\tconsole.error('[MatterClient.getApps()] Error adding application: ', errRes);\n\t\t\t\treturn Promise.reject(errRes);\n\t\t\t});\n\t\t}\n\t}\n\n\t/**\n\t * User class.\n\t *\n\t */\n\tclass User {\n\t\tconstructor(userData) {\n\t\t\tthis.name = userData.name;\n\t\t\tthis.username = userData.username;\n\t\t\tthis.createdAt = userData.createdAt;\n\t\t\tthis.updatedAt = userData.updatedAt;\n\t\t}\n\t\tget apps() {\n\t\t\treturn new AppsAction();\n\t\t}\n\t\tapp(appName) {\n\t\t\t//TODO: Attach owner as well ?\n\t\t\treturn new AppAction(appName);\n\t\t}\n\t}\n\n\t//Actions for specific user\n\tclass UserAction {\n\t\tconstructor(userName) {\n\t\t\t//Call matter with name and settings\n\t\t\tif (userName) {\n\t\t\t\tthis.username = userName;\n\t\t\t} else {\n\t\t\t\tconsole.error('Username is required to start an UserAction');\n\t\t\t\tthrow new Error('Username is required to start an UserAction');\n\t\t\t}\n\t\t}\n\t\tget userEndpoint() {\n\t\t\treturn `${matter.endpoint}/users/${this.username}`;\n\t\t}\n\t\t//Get userlications or single userlication\n\t\tget() {\n\t\t\treturn matter.utils.request.get(this.userEndpoint).then((response) => {\n\t\t\t\tconsole.log('[MatterClient.user().get()] App(s) data loaded:', response);\n\t\t\t\treturn new User(response);\n\t\t\t})['catch']((errRes) => {\n\t\t\t\tconsole.error('[MatterClient.user().get()] Error getting users list: ', errRes);\n\t\t\t\treturn Promise.reject(errRes);\n\t\t\t});\n\t\t}\n\t\t//Update an userlication\n\t\tupdate(userData) {\n\t\t\treturn matter.utils.request.put(this.userEndpoint, userData).then((response) => {\n\t\t\t\tconsole.log('[MatterClient.users().update()] App:', response);\n\t\t\t\treturn new User(response);\n\t\t\t})['catch']((errRes) => {\n\t\t\t\tconsole.error('[MatterClient.users().update()] Error updating user: ', errRes);\n\t\t\t\treturn Promise.reject(errRes);\n\t\t\t});\n\t\t}\n\t\t//Delete an userlication\n\t\t//TODO: Only do matter.utils.request if deleting personal account\n\t\tdel(userData) {\n\t\t\tconsole.error('Deleting a user is currently disabled.');\n\t\t\t// return matter.utils.request.delete(this.endpoint, userData).then((response) => {\n\t\t\t// \tconsole.log('[MatterClient.users().del()] Apps:', response);\n\t\t\t// \treturn new User(response);\n\t\t\t// })['catch']((errRes) => {\n\t\t\t// \tconsole.error('[MatterClient.users().del()] Error deleting user: ', errRes);\n\t\t\t// \treturn Promise.reject(errRes);\n\t\t\t// });\n\t\t}\n\t}\n\n\tlet _request = matter.utils.request;\n\tlet _logger = matter.utils.logger;\n\t//Actions for specific user\n\tclass TemplateAction {\n\t\tconstructor(templateName) {\n\t\t\t//Call matter with name and settings\n\t\t\tif (templateName) {\n\t\t\t\tthis.name = templateName;\n\t\t\t} else {\n\t\t\t\t_logger.error({description: 'Template name is required to start a TemplateAction', func: 'construcotr', obj: ''});\n\t\t\t\tthrow new Error('Template name is required to start a TemplateAction');\n\t\t\t}\n\t\t}\n\t\tget templateEndpoint() {\n\t\t\treturn `${matter.endpoint}/templates/${this.name}`;\n\t\t}\n\t\t//Get userlications or single userlication\n\t\tget() {\n\t\t\t_logger.log({description: 'Get template called.', name: this.name, func: 'get', obj: 'TemplateAction'});\n\t\t\treturn _request.get(this.templateEndpoint).then((response) => {\n\t\t\t\t_logger.log({description: 'Get template responded.', response: response, func: 'get', obj: 'TemplateAction'});\n\t\t\t\treturn response;\n\t\t\t})['catch']((errRes) => {\n\t\t\t\t_logger.error({description: 'Error getting template.', error: errRes, func: 'get', obj: 'TemplateAction'});\n\t\t\t\treturn Promise.reject(errRes);\n\t\t\t});\n\t\t}\n\t\t//Update an userlication\n\t\tupdate(templateData) {\n\t\t\t_logger.log({description: 'Update template called.', templateData: templateData, func: 'update', obj: 'TemplateAction'});\n\t\t\treturn _request.put(this.templateEndpoint, templateData).then((response) => {\n\t\t\t\t_logger.log({description: 'Update template responded.', response: response, templateData: templateData, func: 'update', obj: 'TemplateAction'});\n\t\t\t\t//TODO: Return template object\n\t\t\t\treturn response;\n\t\t\t})['catch']((errRes) => {\n\t\t\t\t_logger.error({description: 'Error updating template.', error: errRes, func: 'update', obj: 'TemplateAction'});\n\t\t\t\treturn Promise.reject(errRes);\n\t\t\t});\n\t\t}\n\t\t//Delete a template\n\t\tdel(templateData) {\n\t\t\t_logger.log({description: 'Delete template called.', templateData: templateData, func: 'del', obj: 'TemplateAction'});\n\t\t\treturn _request.delete(this.endpoint, templateData).then((response) => {\n\t\t\t\t_logger.log({description: 'Template deleted successfully.', response: response, func: 'del', obj: 'TemplateAction'});\n\t\t\t\t//TODO: Return template object\n\t\t\t\treturn response;\n\t\t\t})['catch']((errRes) => {\n\t\t\t\t_logger.error({description: 'Error deleting template.', error: errRes, func: 'del', obj: 'TemplateAction'});\n\t\t\t\treturn Promise.reject(errRes);\n\t\t\t});\n\t\t}\n\t}\n\n\tlet logger = matter.utils.logger;\n\tlet request = matter.utils.request;\n\n\t//Actions for templates list\n\tclass TemplatesAction {\n\t\tget templatesEndpoint() {\n\t\t\treturn `${matter.endpoint}/templates`;\n\t\t}\n\t\t//Get templates or single application\n\t\tget() {\n\t\t\tlogger.log({description: 'Get template called.', func: 'get', obj: 'TemplatesAction'});\n\t\t\treturn request.get(this.templatesEndpoint).then((response) => {\n\t\t\t\tlogger.log({description: 'Templates loaded.', response: response, func: 'get', obj: 'TemplatesAction'});\n\t\t\t\treturn response;\n\t\t\t})['catch']((errRes) => {\n\t\t\t\tlogger.error({description: 'Error getting templates.', error: errRes, func: 'get', obj: 'TemplatesAction'});\n\t\t\t\treturn Promise.reject(errRes);\n\t\t\t});\n\t\t}\n\t\t//Add an application\n\t\tadd(appData) {\n\t\t\tlogger.log({description: 'Add template called.', func: 'add', obj: 'TemplatesAction'});\n\t\t\treturn request.post(this.templatesEndpoint, appData).then((response) => {\n\t\t\t\tlogger.log({description: 'Templates added successfully.', func: 'add', obj: 'TemplatesAction'});\n\t\t\t\treturn response;\n\t\t\t})['catch']((errRes) => {\n\t\t\t\tlogger.error({description: 'Error adding template.', error: errRes, func: 'add', obj: 'TemplatesAction'});\n\t\t\t\treturn Promise.reject(errRes);\n\t\t\t});\n\t\t}\n\t\t//Search with partial of username\n\t\tsearch(query) {\n\t\t\tlogger.log({description: 'Search template called.', query: query, func: 'search', obj: 'TemplatesAction'});\n\t\t\tvar searchEndpoint = this.templatesEndpoint + '/search/';\n\t\t\tif (query && _.isString(query)) {\n\t\t\t\tsearchEndpoint += query;\n\t\t\t}\n\t\t\tlogger.log({description: 'Search endpoint created.', endpoint: searchEndpoint, func: 'search', obj: 'TemplatesAction'});\n\t\t\treturn request.get(searchEndpoint).then((response) => {\n\t\t\t\tlogger.log({description: 'Template(s) found successfully.', response: response, endpoint: searchEndpoint, func: 'search', obj: 'TemplatesAction'});\n\t\t\t\treturn response;\n\t\t\t})['catch']((errRes) => {\n\t\t\t\tlogger.log({description: 'Error searching for templates.', query: query, error: errRes, endpoint: searchEndpoint, func: 'search', obj: 'TemplatesAction'});\n\t\t\t\treturn Promise.reject(errRes);\n\t\t\t});\n\t\t}\n\t}\n\n\t/**Grout Client Class\n\t * @ description Extending matter provides token storage and login/logout/signup capabilities\n\t */\n\tclass Grout extends Matter {\n\t\t//TODO: Use getter/setter to make this not a function\n\t\tconstructor() {\n\t\t\t//Call matter with tessellate\n\t\t\tsuper(config.appName, config.matterOptions);\n\t\t}\n\t\t//Start a new Apps Action\n\t\tget apps() {\n\t\t\tconsole.log('New AppsAction object:', new AppsAction());\n\t\t\treturn new AppsAction();\n\t\t}\n\t\t//Start a new App action\n\t\tapp(appName) {\n\t\t\tconsole.log('New AppAction:', new AppAction(appName));\n\t\t\treturn new AppAction(appName);\n\t\t}\n\t\t//Start a new Apps Action\n\t\tget templates() {\n\t\t\tconsole.log('New TemplatesAction object:', new TemplatesAction());\n\t\t\treturn new TemplatesAction();\n\t\t}\n\t\t//Start a new App action\n\t\ttemplate(appName) {\n\t\t\tconsole.log('New TemplateAction:', new TemplateAction(appName));\n\t\t\treturn new TemplateAction(appName);\n\t\t}\n\t\t//Start a new Users action\n\t\tget users() {\n\t\t\treturn new UsersAction();\n\t\t}\n\t\t//Start a new User action\n\t\tuser(username) {\n\t\t\treturn new UserAction(username);\n\t\t}\n\t};\n\n\treturn Grout;\n\n}));"],"sourceRoot":"/source/"}