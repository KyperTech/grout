function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("underscore"),require("aws-sdk"),require("superagent"),require("firebase")):"function"==typeof define&&define.amd?define(["underscore","aws-sdk","superagent","firebase"],t):e.MatterClient=t(e._,e.AWS,e.superagent,e.Firebase)}(this,function(_,AWS,superagent,Firebase){"use strict";function handleResponse(e){return new Promise(function(t,n){e.end(function(e,r){return e?n(e):t(r.body)})})}function addAuthHeader(e){return"undefined"!=typeof window&&window.sessionStorage.getItem(config__default.tokenName)&&(e=e.set("Authorization","Bearer "+sessionStorage.getItem(config__default.tokenName))),e}function setAWSConfig(){AWS.config.update({credentials:new AWS.CognitoIdentityCredentials({IdentityPoolId:config__default.aws.cognito.poolId}),region:config__default.aws.region})}function childrenStructureFromArray(e){var t=e.map(function(e){return buildStructureObject(e)});return combineLikeObjs(t)}function buildStructureObject(e){var t;_.has(e,"path")?t=e.path.split("/"):(t=e.Key.split("/"),e=_.pick(e,"Key"),e.path=e.Key,e.name=e.Key);var n=e;if(1==t.length)return n.name=t[0],_.has(n,"type")||(n.type="file"),n.path=t[0],n;var r={};return _.each(t,function(o,i,s){i!=s.length-1?(n.name=o,n.path=_.first(s,i+1).join("/"),n.type="folder",n.children=[{}],0==i&&(r=n),n=n.children[0]):(n.type="file",n.name=o,n.path=t.join("/"),e.$id&&(n.$id=e.$id))}),r}function combineLikeObjs(e){var t=[],n=[];return _.each(e,function(r,o,i){if(-1==t.indexOf(r.name))t.push(r.name),n.push(r);else{var s=_.findWhere(e,{name:r.name});s.children=_.union(r.children,s.children),s.children=combineLikeObjs(s.children)}}),n}var libChecker=function libChecker(libsArray){libsArray.forEach(function(libName){var libRef=libName;if(!(libName.length>=20||"string"!=typeof libName))return"undefined"==typeof window?void(libRef="window."+libName):void(("undefined"==typeof eval(libName)||"undefined"==typeof eval(libRef))&&console.error(libName+" is required to use Matter"))})},config__config={serverUrl:"hypercube.elasticbeanstalk.com",tokenName:"matter-client",fbUrl:"https://pruvit.firebaseio.com/",aws:{region:"us-east-1",cognito:{poolId:"us-east-1:7f3bc1ff-8484-48dd-9e13-27e5cd3de982",params:{RoleArn:"arn:aws:iam::823322155619:role/Cognito_HypercubeTestAuth_Role1"}}}};"undefined"==typeof window||""!=window.location.hostname&&"localhost"!=window.location.hostname||(config__config.serverUrl="http://localhost:4000");var config__default=config__config,request__requester=void 0;"undefined"==typeof window?request__requester=superagent:"undefined"==typeof window.superagent?console.error("Superagent is required to use Matter"):request__requester=window.superagent;var request__request={get:function(e,t){var n=request__requester.get(e);return t&&n.query(t),n=addAuthHeader(n),handleResponse(n)},post:function(e,t){var n=request__requester.post(e).send(t);return n=addAuthHeader(n),handleResponse(n)},put:function(e,t){var n=request__requester.put(e).send(t);return n=addAuthHeader(n),handleResponse(n)},del:function(e,t){var n=request__requester.put(e).send(t);return n=addAuthHeader(n),handleResponse(n)}},request__default=request__request,AppsAction=function(){function e(){_classCallCheck(this,e),this.endpoint=config__default.serverUrl+"/apps"}return _createClass(e,[{key:"get",value:function(){return request__default.get(this.endpoint).then(function(e){return console.log("[MatterClient.apps().get()] App(s) data loaded:",e),e})["catch"](function(e){return console.error("[MatterClient.apps().get()] Error getting apps list: ",e),Promise.reject(e)})}},{key:"add",value:function(e){return request__default.post(this.endpoint,e).then(function(e){return console.log("[MatterClient.apps().add()] Application added successfully: ",e),new Application(e)})["catch"](function(e){return console.error("[MatterClient.getApps()] Error adding application: ",e),Promise.reject(e)})}}]),e}(),Application__Application=function(){function e(t){_classCallCheck(this,e),this.name=t.name,this.owner=t.owner||null,this.collaborators=t.collaborators||[],this.createdAt=t.createdAt,this.updatedAt=t.updatedAt,this.frontend=t.frontend||{},this.backend=t.backend||{},Firebase&&(this.fbRef=new Firebase(config__default.fbUrl+t.name))}return _createClass(e,[{key:"getStructure",value:function(){return this.getFiles().then(function(e){var t=childrenStructureFromArray(e);return console.log("Child struct from array:",t),t},function(e){return console.error("[Application.getStructure] Error getting files: ",e),Promise.reject({message:"Error getting files.",error:e})})}},{key:"getFiles",value:function(){if(this.frontend&&this.frontend.bucketName){"undefined"!=typeof AWS.config.credentials&&AWS.config.credentials||setAWSConfig();var e=new AWS.S3,t={Bucket:this.frontend.bucketName};return new Promise(function(n,r){e.listObjects(t,function(e,t){return e?(console.error("[Application.getObjects()] Error listing objects:",e),r(e)):(console.log("[Application.getObjects()] listObjects returned:",t),n(t.Contents))})})}return console.error("[Applicaiton.getFiles] Attempting to get objects for bucket without name."),Promise.reject({message:"Bucket name required to get objects"})}},{key:"publishFile",value:function(e){if(!this.frontend)return console.error("Frontend data not available. Make sure to call .get()."),Promise.reject({message:"Front end data is required to publish file."});var t={Bucket:this.frontent.bucketName,Key:e.key,Body:e.content,ACL:"public-read"};return e.contentType&&(t.ContentType=e.contentType),s3.putObject(t,function(e,t){return e?(console.error("[Application.publishFile()] Error saving file:",e),Promise.reject(e)):(console.log("[Application.publishFile()] file saved successfully. Returning:",t),t)})}},{key:"addStorage",value:function(){var t=config__default.serverUrl+"/apps/"+this.name+"/storage";return request__default.post(t,appData).then(function(t){return console.log("[Application.addStorage()] Apps:",t),new e(t)})["catch"](function(e){return console.error("[Application.addStorage()] Error getting apps list: ",e),Promise.reject(e)})}},{key:"applyTemplate",value:function(){config__default.serverUrl+"/apps/"+this.name+"/template";console.log("Applying templates to existing")}}]),e}(),Application__default=Application__Application,AppAction=function(){function e(t){if(_classCallCheck(this,e),!t)throw console.error("Application name is required to start an AppAction"),new Error("Application name is required to start an AppAction");this.name=t,this.endpoint=config__default.serverUrl+"/apps/"+this.name}return _createClass(e,[{key:"get",value:function(){return request__default.get(this.endpoint).then(function(e){return console.log("[MatterClient.app().get()] App(s) data loaded:",e),new Application__default(e)})["catch"](function(e){return console.error("[MatterClient.app().get()] Error getting apps list: ",e),Promise.reject(e)})}},{key:"update",value:function(e){return request__default.put(this.endpoint,e).then(function(e){return console.log("[MatterClient.apps().update()] App:",e),new Application__default(e)})["catch"](function(e){return console.error("[MatterClient.apps().update()] Error updating app: ",e),Promise.reject(e)})}},{key:"del",value:function(e){return request__default["delete"](this.endpoint,e).then(function(e){return console.log("[MatterClient.apps().del()] Apps:",e),new Application__default(e)})["catch"](function(e){return console.error("[MatterClient.apps().del()] Error deleting app: ",e),Promise.reject(e)})}},{key:"getFiles",value:function(){return this.get().then(function(e){e.getFiles().then(function(e){return e})["catch"](function(e){return console.error("[MatterClient.app().getFiles()] Error getting application files: ",e),Promise.reject(e)})})["catch"](function(e){return console.error("[MatterClient.app().getFiles()] Error getting application: ",e),Promise.reject(e)})}},{key:"getStructure",value:function(){return this.get().then(function(e){return e.getStructure().then(function(e){return console.log("Structure loaded: ",e),e})["catch"](function(e){return console.error("[MatterClient.app().getStructure()] Error getting application structure: ",e),Promise.reject(e)})})["catch"](function(e){return console.error("[MatterClient.app().getStructure()] Error getting application: ",e),Promise.reject(e)})}}]),e}(),User=function(){function e(t){_classCallCheck(this,e),this.name=t.name,this.username=t.username,this.createdAt=t.createdAt,this.updatedAt=t.updatedAt}return _createClass(e,[{key:"app",value:function(e){return new AppAction(e)}},{key:"apps",get:function(){return new AppsAction}}]),e}(),UsersAction=function(){function e(){_classCallCheck(this,e),this.endpoint=config__default.serverUrl+"/users"}return _createClass(e,[{key:"get",value:function(e){var t=this.endpoint;if(e&&!_.isString(e)){var n="Get only handles username as a string";return console.error(n),Promise.reject({message:n})}return e&&(t=t+"/"+e),request__default.get(t).then(function(e){return console.log("[MatterClient.apps().get()] App(s) data loaded:",e),e})["catch"](function(e){return console.error("[MatterClient.apps().get()] Error getting apps list: ",e),Promise.reject(e)})}},{key:"add",value:function(e){return request__default.post(this.endpoint,e).then(function(e){return console.log("[MatterClient.apps().add()] Application added successfully: ",e),new Application(e)})["catch"](function(e){return console.error("[MatterClient.getApps()] Error adding application: ",e),Promise.reject(e)})}},{key:"search",value:function(e){console.log("search called:",e);var t=this.endpoint+"/search/";return e&&_.isString(e)&&(t+=e),console.log("searchEndpoint:",t),request__default.get(t).then(function(e){return console.log("[MatterClient.users().search()] Users(s) data loaded:",e),e})["catch"](function(e){return console.error("[MatterClient.users().search()] Error getting apps list: ",e),Promise.reject(e)})}}]),e}(),UserAction=function(){function e(t){if(_classCallCheck(this,e),!t)throw console.error("Username is required to start an UserAction"),new Error("Username is required to start an UserAction");this.name=t,this.endpoint=config__default.serverUrl+"/users/"+this.name}return _createClass(e,[{key:"get",value:function(){return request__default.get(this.endpoint).then(function(e){return console.log("[MatterClient.user().get()] App(s) data loaded:",e),new User(e)})["catch"](function(e){return console.error("[MatterClient.user().get()] Error getting users list: ",e),Promise.reject(e)})}},{key:"update",value:function(e){return request__default.put(this.endpoint,e).then(function(e){return console.log("[MatterClient.users().update()] App:",e),new User(e)})["catch"](function(e){return console.error("[MatterClient.users().update()] Error updating user: ",e),Promise.reject(e)})}},{key:"del",value:function(e){console.error("Deleting a user is currently disabled.")}}]),e}(),matter_client__user=void 0,matter_client__token=void 0;libChecker(["AWS","_"]);var MatterClient=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"signup",value:function(e){return request__default.post(config__default.serverUrl+"/signup",e).then(function(e){return console.log(e),e})["catch"](function(e){return console.error("[MatterClient.signup()] Error signing up:",e),Promise.reject(e)})}},{key:"login",value:function(e){return e&&e.password&&e.username?request__default.put(config__default.serverUrl+"/login",e).then(function(e){return console.log("[MatterClient.login()]: Login response: ",e),matter_client__token=e.token,null===window.sessionStorage.getItem(config__default.tokenName)&&(window.sessionStorage.setItem(config__default.tokenName,e.token),console.log("[MatterClient.login()]: token set to storage:",window.sessionStorage.getItem(config__default.tokenName))),e})["catch"](function(e){return console.error("[MatterClient.login()] Error logging in: ",e),Promise.reject(e)}):(console.error("Username/Email and Password are required to login."),Promise.reject({message:"Username/Email and Password are required to login."}))}},{key:"logout",value:function(){return request__default.put(config__default.serverUrl+"/logout",{}).then(function(e){return console.log("[MatterClient.logout()] Logout successful: ",e),"undefined"!=typeof window&&null!=typeof window.sessionStorage.getItem(config__default.tokenName)&&window.sessionStorage.clear(),e.body})["catch"](function(e){return e.status&&401==e.status?void("undefined"!=typeof window&&null!=window.sessionStorage.getItem(config__default.tokenName)&&window.sessionStorage.clear()):(console.error("[MatterClient.logout()] Error logging out: ",e),Promise.reject(e))})}},{key:"getCurrentUser",value:function(){return request__default.get(config__default.serverUrl+"/user",{}).then(function(e){return console.log("[MatterClient.getCurrentUser()] Current User:",e),matter_client__user=e})["catch"](function(e){return console.error("[MatterClient.getCurrentUser()] Error getting current user: ",e),Promise.reject(e)})}},{key:"getAuthToken",value:function(){return"undefined"==typeof window||"undefined"==typeof window.sessionStorage.getItem(config__default.tokenName)?null:window.sessionStorage.getItem(config__default.tokenName)}},{key:"app",value:function(e){return console.log("New AppAction:",new AppAction(e)),new AppAction(e)}},{key:"matter_client__user",value:function(e){return new UserAction(e)}},{key:"apps",get:function(){return console.log("New AppsAction:",new AppsAction),new AppsAction}},{key:"users",get:function(){return new UsersAction}}]),e}(),matter_client=MatterClient;return matter_client});
//# sourceMappingURL=matter-client.min.js.map