<!doctype html>
<html lang='en'>
<head>
  <meta charset='utf-8'>
  <title>Grout Tester</title>
  <script src="https://cdn.firebase.com/js/client/2.2.9/firebase.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.8.3/underscore-min.js"></script>
  <!-- Polyfill (required by Babel) -->
  <script src='../dist/grout.bundle.js'></script>
  <script>
    var grout = new Grout();
    console.log('grout:', grout);
    document.addEventListener("DOMContentLoaded", function(event) { 
      if(grout.getAuthToken()){
        document.getElementById("status").innerHTML = "True";
      }
    });
    
    function login(){
      console.log('login called');
      grout.login({username:'test', password:'test'}).then(function(loginInfo){
        console.log('successful login:', loginInfo);
        document.getElementById("status").innerHTML = "True";
      });   
    }
    function logout(){
      console.log('logout called');
      grout.logout().then(function(){
        console.log('successful logout');
        document.getElementById("status").innerHTML = "False";
      });   
    }
    function getApps(){
      console.log('getApps called');
      grout.apps.get().then(function(appsList){
        console.log('apps list loaded:', appsList);
        var outHtml = '<ul>';
        appsList.forEach(function(app){
        	outHtml += '<li>' + app.name + '</li></br>'
        });
        outHtml += '</ul>';
        document.getElementById("output").innerHTML = outHtml;
      });   
    }
    function getStructure(){
      console.log('getStructure called');
      grout.app('exampleApp').getStructure().then(function(app){
        console.log('apps list loaded:', app);
        document.getElementById("output").innerHTML = JSON.stringify(app);
      });
    }
    function getUsers(){
      console.log('getUsers called');
      grout.users.get().then(function(app){
        console.log('apps list loaded:', app);
        document.getElementById("output").innerHTML = JSON.stringify(app);
      });
    }
    function searchUsers(searchStr){
      console.log('getUsers called');
      grout.users.search(searchStr).then(function(users){
        console.log('search users loaded:', users);
        document.getElementById("output").innerHTML = JSON.stringify(users);
      });
    }
  </script>

</head>
<body>
  <div style="text-align:center;">
    <h2>Grout Library Tester</h2>
    <h4>Logged In: <span id='status'>False</span></h4>
      <p class="submit">
        <button onclick="login()">Login As Test User</button>
        <button onclick="logout()">Logout</button>
      </p>
      <p>
        <button onclick="getApps()">Get Apps</button>
        <button onclick="getStructure()">Get Structure</button>
        <button onclick="searchUsers('sprue')">Search Users</button>
      </p>
      <p>
        <span id="output"></span>
      </p>
  </div>

</body>
</html>
